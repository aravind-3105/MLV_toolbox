<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of segmentContoursAtJunctions</title>
  <meta name="keywords" content="segmentContoursAtJunctions">
  <meta name="description" content="newLD = segmentContoursAtJunctions(vecLD)">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../index.html">Home</a> &gt;  <a href="index.html">MLVcode</a> &gt; segmentContoursAtJunctions.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../index.html"><img alt="<" border="0" src="../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for MLVcode&nbsp;<img alt=">" border="0" src="../right.png"></a></td></tr></table>-->

<h1>segmentContoursAtJunctions
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>newLD = segmentContoursAtJunctions(vecLD)</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>function newLD = segmentContoursAtJunctions(vecLD) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre class="comment"> newLD = segmentContoursAtJunctions(vecLD)
   Creates a new line drawing with the contours segmented into separate 
   contours  at junctions. That is, the new contours will terminate at 
   junction points and not run through them. Otherwise, the new drawing 
   is identical to the old one.

 Input:
   vecLD - a vectorized line drawings with Junctions already computed. If
           there is no field called &quot;junctions&quot;, they will be computed.

 Output:
   newLD - the new line drawing with contours split att eh junctions.</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="computeJunctions.html" class="code" title="function vecLD = computeJunctions(vecLD)">computeJunctions</a>	vecLD = computeJunctions(vecLD)</li></ul>
This function is called by:
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="splitLDmiddleSegmentsVsJunctions.html" class="code" title="function [middleLD, junctionLD] = splitLDmiddleSegmentsVsJunctions(vecLD)">splitLDmiddleSegmentsVsJunctions</a>	[middleLD, junctionLD] = splitLDmiddleSegmentsVsJunctions(vecLD)</li></ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function newLD = segmentContoursAtJunctions(vecLD)</a>
0002 <span class="comment">% newLD = segmentContoursAtJunctions(vecLD)</span>
0003 <span class="comment">%   Creates a new line drawing with the contours segmented into separate</span>
0004 <span class="comment">%   contours  at junctions. That is, the new contours will terminate at</span>
0005 <span class="comment">%   junction points and not run through them. Otherwise, the new drawing</span>
0006 <span class="comment">%   is identical to the old one.</span>
0007 <span class="comment">%</span>
0008 <span class="comment">% Input:</span>
0009 <span class="comment">%   vecLD - a vectorized line drawings with Junctions already computed. If</span>
0010 <span class="comment">%           there is no field called &quot;junctions&quot;, they will be computed.</span>
0011 <span class="comment">%</span>
0012 <span class="comment">% Output:</span>
0013 <span class="comment">%   newLD - the new line drawing with contours split att eh junctions.</span>
0014 
0015 <span class="keyword">if</span> ~isfield(vecLD,<span class="string">'junctions'</span>)
0016     vecLD = <a href="computeJunctions.html" class="code" title="function vecLD = computeJunctions(vecLD)">computeJunctions</a>(vecLD);
0017 <span class="keyword">end</span>
0018 
0019 <span class="comment">% prepare the new data structure</span>
0020 newLD.originalImage = vecLD.originalImage;
0021 newLD.imsize = vecLD.imsize;
0022 newLD.lineMethod = vecLD.lineMethod;
0023 newLD.numContours = 0;
0024 newLD.contours = {};
0025 
0026 <span class="comment">% loop over the contours of the old</span>
0027 <span class="keyword">for</span> c = 1:vecLD.numContours
0028     <span class="comment">% find all junctions for this contour</span>
0029     thisJunctions = [];
0030     thisSegments = [];
0031     <span class="keyword">for</span> jj = 1:numel(vecLD.junctions)
0032         thisCidx= find(vecLD.junctions(jj).contourIDs == c);
0033         <span class="keyword">if</span> ~isempty(thisCidx)
0034             thisSegments = [thisSegments,vecLD.junctions(jj).segmentIDs(thisCidx)];
0035             thisJunctions = [thisJunctions,repmat(jj,1,numel(thisCidx))];
0036         <span class="keyword">end</span>
0037     <span class="keyword">end</span>
0038 
0039     <span class="comment">% no junctions? Just copy the contour and be done.</span>
0040     <span class="keyword">if</span> isempty(thisJunctions)
0041         newLD.numContours = newLD.numContours + 1;
0042         newLD.contours{newLD.numContours} = vecLD.contours{c};
0043         <span class="keyword">continue</span>;
0044     <span class="keyword">end</span>
0045 
0046     <span class="comment">% sort the segments</span>
0047     [sortedSeg,segIdx] = sort(thisSegments,<span class="string">'ascend'</span>);
0048 
0049     <span class="comment">% loop over the junction points, and deal with the special case of</span>
0050     <span class="comment">% multiple junctions within the same segment</span>
0051     points = [];
0052     uniqueSeg = unique(sortedSeg);
0053     <span class="keyword">for</span> u = 1:numel(uniqueSeg)
0054         currSeg = find(sortedSeg == uniqueSeg(u));
0055 
0056         <span class="comment">% just one junction in this segment? Easy</span>
0057         <span class="keyword">if</span> numel(currSeg) == 1
0058             <span class="comment">% just one junction in this segment? Easy</span>
0059             points = [points;vecLD.junctions(thisJunctions(segIdx(currSeg))).position];
0060         <span class="keyword">else</span>
0061             <span class="comment">% multiple junctions? Need to figure which ones are clsoest to</span>
0062             <span class="comment">% the start point of this semgent</span>
0063             startPoint = vecLD.contours{c}(uniqueSeg(u),1:2);
0064             distances = NaN(1,numel(currSeg));
0065 
0066             <span class="comment">% compute the distances</span>
0067             thisPoints = [];
0068             <span class="keyword">for</span> j = 1:numel(currSeg)
0069                 thisPoints = [thisPoints;vecLD.junctions(thisJunctions(segIdx(currSeg(j)))).position];
0070                 distances(j) = sum((startPoint - thisPoints(j,:)).^2);
0071             <span class="keyword">end</span>
0072 
0073             <span class="comment">% sort by distance, and store points</span>
0074             [~,distIdx] = sort(distances,<span class="string">'ascend'</span>);
0075             points = [points;thisPoints(distIdx,:)];
0076         <span class="keyword">end</span>
0077     <span class="keyword">end</span>
0078 
0079     <span class="comment">% add the end point of the last segment, unless it's already the last point</span>
0080     endpoint = vecLD.contours{c}(<span class="keyword">end</span>,3:4);
0081     dist = sqrt(sum((endpoint - points(<span class="keyword">end</span>,:)).^2));
0082     <span class="keyword">if</span> dist &gt; 0.01
0083         points = [points;endpoint];
0084         sortedSeg = [sortedSeg,size(vecLD.contours{c},1)];
0085     <span class="keyword">end</span>
0086 
0087     <span class="comment">% set the start point to the start point of the first segment</span>
0088     prevSeg = 1;
0089     prevPoint = vecLD.contours{c}(1,1:2);
0090     newContour = [];
0091 
0092     <span class="comment">% loop over all junciton points and cut and assign segments as needed</span>
0093     <span class="keyword">for</span> s = 1:numel(sortedSeg)
0094         seg = sortedSeg(s);
0095 
0096         <span class="comment">% special case if we stay within the same segment</span>
0097         <span class="keyword">if</span> seg == prevSeg
0098             newContour = [prevPoint,points(s,:)];
0099             prevPoint = points(s,:);
0100         <span class="keyword">else</span>
0101             <span class="comment">% add the remaining bit from the previous segment</span>
0102             newContour = [prevPoint,vecLD.contours{c}(prevSeg,3:4)];
0103             prevSeg = prevSeg + 1;
0104 
0105             <span class="comment">% now add whole segments until we hit the segment with the next junction</span>
0106             <span class="keyword">if</span> prevSeg &lt; seg
0107                 newContour = [newContour; vecLD.contours{c}(prevSeg:seg-1,:)];
0108             <span class="keyword">end</span>
0109 
0110             <span class="comment">% now add the bit of the current segment until the junction</span>
0111             newContour = [newContour; [vecLD.contours{c}(seg,1:2),points(s,:)]];
0112             prevSeg = seg;
0113             prevPoint = points(s,:);
0114         <span class="keyword">end</span>
0115 
0116         <span class="comment">% add the newly constructed contour to the new LD</span>
0117         newLD.numContours = newLD.numContours + 1;
0118         newLD.contours{newLD.numContours} = newContour;
0119     <span class="keyword">end</span>
0120 
0121     <span class="comment">% that's it for this old contour</span>
0122 <span class="keyword">end</span></pre></div>
<hr><address>Generated on Thu 05-May-2022 14:52:24 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>