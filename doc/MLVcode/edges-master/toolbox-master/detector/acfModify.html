<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of acfModify</title>
  <meta name="keywords" content="acfModify">
  <meta name="description" content="Modify aggregate channel features object detector.">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../../../index.html">Home</a> &gt;  <a href="../../../index.html">MLVcode</a> &gt; <a href="../../index.html">edges-master</a> &gt; <a href="#">toolbox-master</a> &gt; <a href="index.html">detector</a> &gt; acfModify.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../../../index.html"><img alt="<" border="0" src="../../../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for MLVcode\edges-master\toolbox-master\detector&nbsp;<img alt=">" border="0" src="../../../../right.png"></a></td></tr></table>-->

<h1>acfModify
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<div class="box"><strong>Modify aggregate channel features object detector.</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<div class="box"><strong>function detector = acfModify( detector, varargin ) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<div class="fragment"><pre class="comment"> Modify aggregate channel features object detector.

 Takes an object detector trained by acfTrain() and modifies it. Only
 certain modifications are allowed to the detector and the detector should
 never be modified directly (this may cause the detector to be invalid and
 cause segmentation faults). Any valid modification to a detector after it
 is trained should be performed using acfModify().

 The parameters 'nPerOct', 'nOctUp', 'nApprox', 'lambdas', 'pad', 'minDs'
 modify the channel feature pyramid created (see help of chnsPyramid.m for
 more details) and primarily control the scales used. The parameters
 'pNms', 'stride', 'cascThr' and 'cascCal' modify the detector behavior
 (see help of acfTrain.m for more details). Finally, 'rescale' can be
 used to rescale the trained detector (this change is irreversible).

 USAGE
  detector = acfModify( detector, pModify )

 INPUTS
  detector   - detector trained via acfTrain
  pModify    - parameters (struct or name/value pairs)
   .nPerOct    - [] number of scales per octave
   .nOctUp     - [] number of upsampled octaves to compute
   .nApprox    - [] number of approx. scales to use
   .lambdas    - [] coefficients for power law scaling (see BMVC10)
   .pad        - [] amount to pad channels (along T/B and L/R)
   .minDs      - [] minimum image size for channel computation
   .pNms       - [] params for non-maximal suppression (see bbNms.m)
   .stride     - [] spatial stride between detection windows
   .cascThr    - [] constant cascade threshold (affects speed/accuracy)
   .cascCal    - [] cascade calibration (affects speed/accuracy)
   .rescale    - [] rescale entire detector by given ratio

 OUTPUTS
  detector   - modified object detector

 EXAMPLE

 See also chnsPyramid, <a href="bbNms.html" class="code" title="function bbs = bbNms( bbs, varargin )">bbNms</a>, <a href="acfTrain.html" class="code" title="function detector = acfTrain( varargin )">acfTrain</a>, <a href="acfDetect.html" class="code" title="function bbs = acfDetect( I, detector, fileName )">acfDetect</a>

 Piotr's Computer Vision Matlab Toolbox      Version 3.20
 Copyright 2014 Piotr Dollar.  [pdollar-at-gmail.com]
 Licensed under the Simplified BSD License [see external/bsd.txt]</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../../matlabicon.gif)">
</ul>
This function is called by:
<ul style="list-style-image:url(../../../../matlabicon.gif)">
<li><a href="acfDemoCal.html" class="code" title="">acfDemoCal</a>	Demo for aggregate channel features object detector on Caltech dataset.</li><li><a href="acfDemoInria.html" class="code" title="">acfDemoInria</a>	Demo for aggregate channel features object detector on Inria dataset.</li><li><a href="acfTest.html" class="code" title="function [miss,roc,gt,dt] = acfTest( varargin )">acfTest</a>	Test aggregate channel features object detector given ground truth.</li></ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<ul style="list-style-image:url(../../../../matlabicon.gif)">
<li><a href="#_sub1" class="code">function detector = detectorRescale( detector, rescale )</a></li></ul>

<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function detector = acfModify( detector, varargin )</a>
0002 <span class="comment">% Modify aggregate channel features object detector.</span>
0003 <span class="comment">%</span>
0004 <span class="comment">% Takes an object detector trained by acfTrain() and modifies it. Only</span>
0005 <span class="comment">% certain modifications are allowed to the detector and the detector should</span>
0006 <span class="comment">% never be modified directly (this may cause the detector to be invalid and</span>
0007 <span class="comment">% cause segmentation faults). Any valid modification to a detector after it</span>
0008 <span class="comment">% is trained should be performed using acfModify().</span>
0009 <span class="comment">%</span>
0010 <span class="comment">% The parameters 'nPerOct', 'nOctUp', 'nApprox', 'lambdas', 'pad', 'minDs'</span>
0011 <span class="comment">% modify the channel feature pyramid created (see help of chnsPyramid.m for</span>
0012 <span class="comment">% more details) and primarily control the scales used. The parameters</span>
0013 <span class="comment">% 'pNms', 'stride', 'cascThr' and 'cascCal' modify the detector behavior</span>
0014 <span class="comment">% (see help of acfTrain.m for more details). Finally, 'rescale' can be</span>
0015 <span class="comment">% used to rescale the trained detector (this change is irreversible).</span>
0016 <span class="comment">%</span>
0017 <span class="comment">% USAGE</span>
0018 <span class="comment">%  detector = acfModify( detector, pModify )</span>
0019 <span class="comment">%</span>
0020 <span class="comment">% INPUTS</span>
0021 <span class="comment">%  detector   - detector trained via acfTrain</span>
0022 <span class="comment">%  pModify    - parameters (struct or name/value pairs)</span>
0023 <span class="comment">%   .nPerOct    - [] number of scales per octave</span>
0024 <span class="comment">%   .nOctUp     - [] number of upsampled octaves to compute</span>
0025 <span class="comment">%   .nApprox    - [] number of approx. scales to use</span>
0026 <span class="comment">%   .lambdas    - [] coefficients for power law scaling (see BMVC10)</span>
0027 <span class="comment">%   .pad        - [] amount to pad channels (along T/B and L/R)</span>
0028 <span class="comment">%   .minDs      - [] minimum image size for channel computation</span>
0029 <span class="comment">%   .pNms       - [] params for non-maximal suppression (see bbNms.m)</span>
0030 <span class="comment">%   .stride     - [] spatial stride between detection windows</span>
0031 <span class="comment">%   .cascThr    - [] constant cascade threshold (affects speed/accuracy)</span>
0032 <span class="comment">%   .cascCal    - [] cascade calibration (affects speed/accuracy)</span>
0033 <span class="comment">%   .rescale    - [] rescale entire detector by given ratio</span>
0034 <span class="comment">%</span>
0035 <span class="comment">% OUTPUTS</span>
0036 <span class="comment">%  detector   - modified object detector</span>
0037 <span class="comment">%</span>
0038 <span class="comment">% EXAMPLE</span>
0039 <span class="comment">%</span>
0040 <span class="comment">% See also chnsPyramid, bbNms, acfTrain, acfDetect</span>
0041 <span class="comment">%</span>
0042 <span class="comment">% Piotr's Computer Vision Matlab Toolbox      Version 3.20</span>
0043 <span class="comment">% Copyright 2014 Piotr Dollar.  [pdollar-at-gmail.com]</span>
0044 <span class="comment">% Licensed under the Simplified BSD License [see external/bsd.txt]</span>
0045 
0046 <span class="comment">% get parameters (and copy to detector and pPyramid structs)</span>
0047 opts=detector.opts; p=opts.pPyramid;
0048 dfs={ <span class="string">'nPerOct'</span>,p.nPerOct, <span class="string">'nOctUp'</span>,p.nOctUp, <span class="string">'nApprox'</span>,p.nApprox, <span class="keyword">...</span>
0049   <span class="string">'lambdas'</span>,p.lambdas, <span class="string">'pad'</span>,p.pad, <span class="string">'minDs'</span>,p.minDs, <span class="string">'pNms'</span>,opts.pNms, <span class="keyword">...</span>
0050   <span class="string">'stride'</span>,opts.stride,<span class="string">'cascThr'</span>,opts.cascThr,<span class="string">'cascCal'</span>,0,<span class="string">'rescale'</span>,1 };
0051 [p.nPerOct,p.nOctUp,p.nApprox,p.lambdas,p.pad,p.minDs,opts.pNms,<span class="keyword">...</span>
0052   opts.stride,opts.cascThr,cascCal,rescale] = getPrmDflt(varargin,dfs,1);
0053 
0054 <span class="comment">% finalize pPyramid and opts</span>
0055 p.complete=0; p.pChns.complete=0; p=chnsPyramid([],p); p=p.pPyramid;
0056 p.complete=1; p.pChns.complete=1; shrink=p.pChns.shrink;
0057 opts.stride=max(1,round(opts.stride/shrink))*shrink;
0058 opts.pPyramid=p; detector.opts=opts;
0059 
0060 <span class="comment">% calibrate and rescale detector</span>
0061 detector.clf.hs = detector.clf.hs+cascCal;
0062 <span class="keyword">if</span>(rescale~=1), detector=<a href="#_sub1" class="code" title="subfunction detector = detectorRescale( detector, rescale )">detectorRescale</a>(detector,rescale); <span class="keyword">end</span>
0063 
0064 <span class="keyword">end</span>
0065 
0066 <a name="_sub1" href="#_subfunctions" class="code">function detector = detectorRescale( detector, rescale )</a>
0067 <span class="comment">% Rescale detector by ratio rescale.</span>
0068 opts=detector.opts; shrink=opts.pPyramid.pChns.shrink;
0069 bh=opts.modelDsPad(1)/shrink; bw=opts.modelDsPad(2)/shrink;
0070 opts.stride=max(1,round(opts.stride*rescale/shrink))*shrink;
0071 modelDsPad=round(opts.modelDsPad*rescale/shrink)*shrink;
0072 rescale=modelDsPad./opts.modelDsPad; opts.modelDsPad=modelDsPad;
0073 opts.modelDs=round(opts.modelDs.*rescale); detector.opts=opts;
0074 bh1=opts.modelDsPad(1)/shrink; bw1=opts.modelDsPad(2)/shrink;
0075 <span class="comment">% move 0-indexed (x,y) location of each lookup feature</span>
0076 clf=detector.clf; fids=clf.fids; is=find(clf.child&gt;0);
0077 fids=double(fids(is)); n=length(fids); loc=zeros(n,3);
0078 loc(:,3)=floor(fids/bh/bw); fids=fids-loc(:,3)*bh*bw;
0079 loc(:,2)=floor(fids/bh); fids=fids-loc(:,2)*bh; loc(:,1)=fids;
0080 loc(:,1)=min(bh1-1,round(loc(:,1)*rescale(1)));
0081 loc(:,2)=min(bw1-1,round(loc(:,2)*rescale(2)));
0082 fids = loc(:,3)*bh1*bw1 + loc(:,2)*bh1 + loc(:,1);
0083 clf.fids(is)=int32(fids);
0084 <span class="comment">% rescale thrs for all features (fpdw trick)</span>
0085 nChns=[detector.info.nChns]; assert(max(loc(:,3))&lt;sum(nChns));
0086 k=[]; <span class="keyword">for</span> i=1:length(nChns), k=[k ones(1,nChns(i))*i]; <span class="keyword">end</span> <span class="comment">%#ok&lt;AGROW&gt;</span>
0087 lambdas=opts.pPyramid.lambdas; lambdas=sqrt(prod(rescale)).^-lambdas(k);
0088 clf.thrs(is)=clf.thrs(is).*lambdas(loc(:,3)+1)'; detector.clf=clf;
0089 <span class="keyword">end</span></pre></div>
<hr><address>Generated on Thu 05-May-2022 15:20:21 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>