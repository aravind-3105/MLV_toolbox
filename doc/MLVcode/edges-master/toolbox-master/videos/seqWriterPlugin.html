<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of seqWriterPlugin</title>
  <meta name="keywords" content="seqWriterPlugin">
  <meta name="description" content="Plugin for seqIo and videoIO to allow writing of seq files.">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../../../index.html">Home</a> &gt;  <a href="../../../index.html">MLVcode</a> &gt; <a href="../../index.html">edges-master</a> &gt; <a href="#">toolbox-master</a> &gt; <a href="index.html">videos</a> &gt; seqWriterPlugin.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../../../index.html"><img alt="<" border="0" src="../../../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for MLVcode\edges-master\toolbox-master\videos&nbsp;<img alt=">" border="0" src="../../../../right.png"></a></td></tr></table>-->

<h1>seqWriterPlugin
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<div class="box"><strong>Plugin for seqIo and videoIO to allow writing of seq files.</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<div class="box"><strong>function varargout = seqWriterPlugin( cmd, h, varargin ) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<div class="fragment"><pre class="comment"> Plugin for seqIo and videoIO to allow writing of seq files.

 Do not call directly, use as plugin for seqIo or videoIO instead.
 The following is a list of commands available (swp=seqWriterPlugin):
  h=swp('open',h,fName,info) % Open a seq file for writing (h ignored).
  h=swp('close',h)           % Close seq file (output h is -1).
  swp('addframe',h,I,[ts])   % Writes video frame (and timestamp).
  swp('addframeb',h,I,[ts])  % Writes video frame with no encoding.
  info = swp('getinfo',h)    % Return struct with info about video.

 The following params must be specified in struct 'info' upon opening:
  width          - frame width
  height         - frame height
  fps            - frames per second
  quality        - [80] compression quality (0 to 100)
  codec          - string representing codec, options include:
   'monoraw'/'imageFormat100'      - black/white uncompressed
   'raw'/'imageFormat200'          - color (BGR) uncompressed
   'monojpg'/'imageFormat102'      - black/white jpg compressed
   'jpg'/'imageFormat201'          - color jpg compressed
   'monopng'/'imageFormat001'      - black/white png compressed
   'png'/'imageFormat002'          - color png compressed

 USAGE
  varargout = seqWriterPlugin( cmd, h, varargin )

 INPUTS
  cmd        - string indicating operation to perform
  h          - unique identifier for open seq file
  varargin   - additional options (vary according to cmd)

 OUTPUTS
  varargout  - output (varies according to cmd)

 EXAMPLE

 See also <a href="seqIo.html" class="code" title="function out = seqIo( fName, action, varargin )">SEQIO</a>, <a href="seqReaderPlugin.html" class="code" title="function varargout = seqReaderPlugin( cmd, h, varargin )">SEQREADERPLUGIN</a>

 Piotr's Computer Vision Matlab Toolbox      Version 2.66
 Copyright 2014 Piotr Dollar.  [pdollar-at-gmail.com]
 Licensed under the Simplified BSD License [see external/bsd.txt]</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../../matlabicon.gif)">
</ul>
This function is called by:
<ul style="list-style-image:url(../../../../matlabicon.gif)">
<li><a href="seqIo.html" class="code" title="function out = seqIo( fName, action, varargin )">seqIo</a>	Utilities for reading and writing seq files.</li></ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<ul style="list-style-image:url(../../../../matlabicon.gif)">
<li><a href="#_sub1" class="code">function chk(nIn,nMin,nMax)</a></li><li><a href="#_sub2" class="code">function success = getImgFile( fName )</a></li><li><a href="#_sub3" class="code">function [info, fid, tNm] = open( fName, info )</a></li><li><a href="#_sub4" class="code">function info = addFrame( fid, info, tNm, encode, I, ts )</a></li><li><a href="#_sub5" class="code">function writeHeader( fid, info )</a></li></ul>

<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function varargout = seqWriterPlugin( cmd, h, varargin )</a>
0002 <span class="comment">% Plugin for seqIo and videoIO to allow writing of seq files.</span>
0003 <span class="comment">%</span>
0004 <span class="comment">% Do not call directly, use as plugin for seqIo or videoIO instead.</span>
0005 <span class="comment">% The following is a list of commands available (swp=seqWriterPlugin):</span>
0006 <span class="comment">%  h=swp('open',h,fName,info) % Open a seq file for writing (h ignored).</span>
0007 <span class="comment">%  h=swp('close',h)           % Close seq file (output h is -1).</span>
0008 <span class="comment">%  swp('addframe',h,I,[ts])   % Writes video frame (and timestamp).</span>
0009 <span class="comment">%  swp('addframeb',h,I,[ts])  % Writes video frame with no encoding.</span>
0010 <span class="comment">%  info = swp('getinfo',h)    % Return struct with info about video.</span>
0011 <span class="comment">%</span>
0012 <span class="comment">% The following params must be specified in struct 'info' upon opening:</span>
0013 <span class="comment">%  width          - frame width</span>
0014 <span class="comment">%  height         - frame height</span>
0015 <span class="comment">%  fps            - frames per second</span>
0016 <span class="comment">%  quality        - [80] compression quality (0 to 100)</span>
0017 <span class="comment">%  codec          - string representing codec, options include:</span>
0018 <span class="comment">%   'monoraw'/'imageFormat100'      - black/white uncompressed</span>
0019 <span class="comment">%   'raw'/'imageFormat200'          - color (BGR) uncompressed</span>
0020 <span class="comment">%   'monojpg'/'imageFormat102'      - black/white jpg compressed</span>
0021 <span class="comment">%   'jpg'/'imageFormat201'          - color jpg compressed</span>
0022 <span class="comment">%   'monopng'/'imageFormat001'      - black/white png compressed</span>
0023 <span class="comment">%   'png'/'imageFormat002'          - color png compressed</span>
0024 <span class="comment">%</span>
0025 <span class="comment">% USAGE</span>
0026 <span class="comment">%  varargout = seqWriterPlugin( cmd, h, varargin )</span>
0027 <span class="comment">%</span>
0028 <span class="comment">% INPUTS</span>
0029 <span class="comment">%  cmd        - string indicating operation to perform</span>
0030 <span class="comment">%  h          - unique identifier for open seq file</span>
0031 <span class="comment">%  varargin   - additional options (vary according to cmd)</span>
0032 <span class="comment">%</span>
0033 <span class="comment">% OUTPUTS</span>
0034 <span class="comment">%  varargout  - output (varies according to cmd)</span>
0035 <span class="comment">%</span>
0036 <span class="comment">% EXAMPLE</span>
0037 <span class="comment">%</span>
0038 <span class="comment">% See also SEQIO, SEQREADERPLUGIN</span>
0039 <span class="comment">%</span>
0040 <span class="comment">% Piotr's Computer Vision Matlab Toolbox      Version 2.66</span>
0041 <span class="comment">% Copyright 2014 Piotr Dollar.  [pdollar-at-gmail.com]</span>
0042 <span class="comment">% Licensed under the Simplified BSD License [see external/bsd.txt]</span>
0043 
0044 <span class="comment">% persistent variables to keep track of all loaded .seq files</span>
0045 <span class="keyword">persistent</span> h1 hs fids infos tNms;
0046 <span class="keyword">if</span>(isempty(h1)), h1=int32(now); hs=int32([]); infos={}; tNms={}; <span class="keyword">end</span>
0047 nIn=nargin-2; in=varargin; o1=[]; cmd=lower(cmd);
0048 
0049 <span class="comment">% open seq file</span>
0050 <span class="keyword">if</span>(strcmp(cmd,<span class="string">'open'</span>))
0051   <a href="#_sub1" class="code" title="subfunction chk(nIn,nMin,nMax)">chk</a>(nIn,2); h=length(hs)+1; hs(h)=h1; varargout={h1}; h1=h1+1;
0052   [pth,name]=fileparts(in{1}); <span class="keyword">if</span>(isempty(pth)), pth=<span class="string">'.'</span>; <span class="keyword">end</span>
0053   fName=[pth filesep name];
0054   [infos{h},fids(h),tNms{h}]=<a href="#_sub3" class="code" title="subfunction [info, fid, tNm] = open( fName, info )">open</a>(fName,in{2}); <span class="keyword">return</span>;
0055 <span class="keyword">end</span>
0056 
0057 <span class="comment">% Get the handle for this instance</span>
0058 [v,h]=ismember(h,hs); <span class="keyword">if</span>(~v), error(<span class="string">'Invalid load plugin handle'</span>); <span class="keyword">end</span>
0059 fid=fids(h); info=infos{h}; tNm=tNms{h};
0060 
0061 <span class="comment">% close seq file</span>
0062 <span class="keyword">if</span>(strcmp(cmd,<span class="string">'close'</span>))
0063   <a href="#_sub5" class="code" title="subfunction writeHeader( fid, info )">writeHeader</a>(fid,info);
0064   <a href="#_sub1" class="code" title="subfunction chk(nIn,nMin,nMax)">chk</a>(nIn,0); varargout={-1}; fclose(fid); kp=[1:h-1 h+1:length(hs)];
0065   hs=hs(kp); fids=fids(kp); infos=infos(kp);
0066   tNms=tNms(kp); <span class="keyword">if</span>(exist(tNm,<span class="string">'file'</span>)), delete(tNm); <span class="keyword">end</span>; <span class="keyword">return</span>;
0067 <span class="keyword">end</span>
0068 
0069 <span class="comment">% perform appropriate operation</span>
0070 <span class="keyword">switch</span>( cmd )
0071   <span class="keyword">case</span> <span class="string">'addframe'</span>,  <a href="#_sub1" class="code" title="subfunction chk(nIn,nMin,nMax)">chk</a>(nIn,1,2); info=<a href="#_sub4" class="code" title="subfunction info = addFrame( fid, info, tNm, encode, I, ts )">addFrame</a>(fid,info,tNm,1,in{:});
0072   <span class="keyword">case</span> <span class="string">'addframeb'</span>, <a href="#_sub1" class="code" title="subfunction chk(nIn,nMin,nMax)">chk</a>(nIn,1,2); info=<a href="#_sub4" class="code" title="subfunction info = addFrame( fid, info, tNm, encode, I, ts )">addFrame</a>(fid,info,tNm,0,in{:});
0073   <span class="keyword">case</span> <span class="string">'getinfo'</span>,   <a href="#_sub1" class="code" title="subfunction chk(nIn,nMin,nMax)">chk</a>(nIn,0); o1=info;
0074   <span class="keyword">otherwise</span>,        error([<span class="string">'Unrecognized command: &quot;'</span> cmd <span class="string">'&quot;'</span>]);
0075 <span class="keyword">end</span>
0076 infos{h}=info; varargout={o1};
0077 
0078 <span class="keyword">end</span>
0079 
0080 <a name="_sub1" href="#_subfunctions" class="code">function chk(nIn,nMin,nMax)</a>
0081 <span class="keyword">if</span>(nargin&lt;3), nMax=nMin; <span class="keyword">end</span>
0082 <span class="keyword">if</span>(nIn&gt;0 &amp;&amp; nMin==0 &amp;&amp; nMax==0), error([<span class="string">'&quot;'</span> cmd <span class="string">'&quot; takes no args.'</span>]); <span class="keyword">end</span>
0083 <span class="keyword">if</span>(nIn&lt;nMin||nIn&gt;nMax), error([<span class="string">'Incorrect num args for &quot;'</span> cmd <span class="string">'&quot;.'</span>]); <span class="keyword">end</span>
0084 <span class="keyword">end</span>
0085 
0086 <a name="_sub2" href="#_subfunctions" class="code">function success = getImgFile( fName )</a>
0087 <span class="comment">% create local copy of fName which is in a imagesci/private</span>
0088 fName = [fName <span class="string">'.'</span> mexext]; s = filesep; success = 1;
0089 sName = [fileparts(which(<span class="string">'imread.m'</span>)) s <span class="string">'private'</span> s fName];
0090 tName = [fileparts(mfilename(<span class="string">'fullpath'</span>)) s <span class="string">'private'</span> s fName];
0091 <span class="keyword">if</span>(~exist(tName,<span class="string">'file'</span>)), success=copyfile(sName,tName); <span class="keyword">end</span>
0092 <span class="keyword">end</span>
0093 
0094 <a name="_sub3" href="#_subfunctions" class="code">function [info, fid, tNm] = open( fName, info )</a>
0095 <span class="comment">% open video for writing, create space for header</span>
0096 t=[fName <span class="string">'.seq'</span>]; <span class="keyword">if</span>(exist(t,<span class="string">'file'</span>)), delete(t); <span class="keyword">end</span>
0097 t=[fName <span class="string">'-seek.mat'</span>]; <span class="keyword">if</span>(exist(t,<span class="string">'file'</span>)), delete(t); <span class="keyword">end</span>
0098 fid=fopen([fName <span class="string">'.seq'</span>],<span class="string">'w'</span>,<span class="string">'l'</span>); assert(fid~=-1);
0099 fwrite(fid,zeros(1,1024),<span class="string">'uint8'</span>);
0100 <span class="comment">% initialize info struct (w all fields necessary for writeHeader)</span>
0101 assert(isfield2(info,{<span class="string">'width'</span>,<span class="string">'height'</span>,<span class="string">'fps'</span>,<span class="string">'codec'</span>},1));
0102 <span class="keyword">switch</span>(info.codec)
0103   <span class="keyword">case</span> {<span class="string">'monoraw'</span>, <span class="string">'imageFormat100'</span>}, frmt=100; nCh=1; ext=<span class="string">'raw'</span>;
0104   <span class="keyword">case</span> {<span class="string">'raw'</span>, <span class="string">'imageFormat200'</span>},     frmt=200; nCh=3; ext=<span class="string">'raw'</span>;
0105   <span class="keyword">case</span> {<span class="string">'monojpg'</span>, <span class="string">'imageFormat102'</span>}, frmt=102; nCh=1; ext=<span class="string">'jpg'</span>;
0106   <span class="keyword">case</span> {<span class="string">'jpg'</span>, <span class="string">'imageFormat201'</span>},     frmt=201; nCh=3; ext=<span class="string">'jpg'</span>;
0107   <span class="keyword">case</span> {<span class="string">'monopng'</span>, <span class="string">'imageFormat001'</span>}, frmt=001; nCh=1; ext=<span class="string">'png'</span>;
0108   <span class="keyword">case</span> {<span class="string">'png'</span>, <span class="string">'imageFormat002'</span>},     frmt=002; nCh=3; ext=<span class="string">'png'</span>;
0109   <span class="keyword">otherwise</span>, error(<span class="string">'unknown format'</span>);
0110 <span class="keyword">end</span>; s=1;
0111 <span class="keyword">if</span>(strcmp(ext,<span class="string">'jpg'</span>)), s=<a href="#_sub2" class="code" title="subfunction success = getImgFile( fName )">getImgFile</a>(<span class="string">'wjpg8c'</span>); <span class="keyword">end</span>
0112 <span class="keyword">if</span>(strcmp(ext,<span class="string">'png'</span>)), s=<a href="#_sub2" class="code" title="subfunction success = getImgFile( fName )">getImgFile</a>(<span class="string">'png'</span>);
0113   <span class="keyword">if</span>(s), info.writeImg=@(p) png(<span class="string">'write'</span>,p{:}); <span class="keyword">end</span>; <span class="keyword">end</span>
0114 <span class="keyword">if</span>(strcmp(ext,<span class="string">'png'</span>) &amp;&amp; ~s), s=<a href="#_sub2" class="code" title="subfunction success = getImgFile( fName )">getImgFile</a>(<span class="string">'pngwritec'</span>);
0115   <span class="keyword">if</span>(s), info.writeImg=@(p) pngwritec(p{:}); <span class="keyword">end</span>; <span class="keyword">end</span>
0116 <span class="keyword">if</span>(~s), error(<span class="string">'Cannot find Matlab''s source image writer'</span>); <span class="keyword">end</span>
0117 info.imageFormat=frmt; info.ext=ext;
0118 <span class="keyword">if</span>(any(strcmp(ext,{<span class="string">'jpg'</span>,<span class="string">'png'</span>}))), info.seek=1024; info.seekNm=t; <span class="keyword">end</span>
0119 <span class="keyword">if</span>(~isfield2(info,<span class="string">'quality'</span>)), info.quality=80; <span class="keyword">end</span>
0120 info.imageBitDepth=8*nCh; info.imageBitDepthReal=8;
0121 nByte=info.width*info.height*nCh; info.imageSizeBytes=nByte;
0122 info.numFrames=0; info.trueImageSize=nByte+6+512-mod(nByte+6,512);
0123 <span class="comment">% generate unique temporary name</span>
0124 [~,tNm]=fileparts(fName); t=clock; t=mod(t(end),1);
0125 tNm=sprintf(<span class="string">'tmp_%s_%15i.%s'</span>,tNm,round((t+rand)/2*1e15),ext);
0126 <span class="keyword">end</span>
0127 
0128 <a name="_sub4" href="#_subfunctions" class="code">function info = addFrame( fid, info, tNm, encode, I, ts )</a>
0129 <span class="comment">% write frame</span>
0130 nCh=info.imageBitDepth/8; ext=info.ext; c=info.numFrames+1;
0131 <span class="keyword">if</span>( encode )
0132   siz = [info.height info.width nCh];
0133   assert(size(I,1)==siz(1) &amp;&amp; size(I,2)==siz(2) &amp;&amp; size(I,3)==siz(3));
0134 <span class="keyword">end</span>
0135 <span class="keyword">switch</span> ext
0136   <span class="keyword">case</span> <span class="string">'raw'</span>
0137     <span class="comment">% write an uncompressed image (assume imageBitDepthReal==8)</span>
0138     <span class="keyword">if</span>( ~encode ), assert(numel(I)==info.imageSizeBytes); <span class="keyword">else</span>
0139       <span class="keyword">if</span>(nCh==3), t=I(:,:,3); I(:,:,3)=I(:,:,1); I(:,:,1)=t; <span class="keyword">end</span>
0140       <span class="keyword">if</span>(nCh==1), I=I'; <span class="keyword">else</span> I=permute(I,[3,2,1]); <span class="keyword">end</span>
0141     <span class="keyword">end</span>
0142     fwrite(fid,I(:),<span class="string">'uint8'</span>); pad=info.trueImageSize-info.imageSizeBytes-6;
0143   <span class="keyword">case</span> <span class="string">'jpg'</span>
0144     <span class="keyword">if</span>( encode )
0145       <span class="comment">% write/read to/from temporary .jpg (not that much overhead)</span>
0146       p=struct(<span class="string">'quality'</span>,info.quality,<span class="string">'comment'</span>,{{}},<span class="string">'mode'</span>,<span class="string">'lossy'</span>);
0147       <span class="keyword">for</span> t=0:99, <span class="keyword">try</span> wjpg8c(I,tNm,p); fr=fopen(tNm,<span class="string">'r'</span>); assert(fr&gt;0);
0148           <span class="keyword">break</span>; <span class="keyword">catch</span>, pause(.01); fr=-1; <span class="keyword">end</span>; <span class="keyword">end</span> <span class="comment">%#ok&lt;CTCH&gt;</span>
0149       <span class="keyword">if</span>(fr&lt;0), error([<span class="string">'write fail: '</span> tNm]); <span class="keyword">end</span>; I=fread(fr); fclose(fr);
0150     <span class="keyword">end</span>
0151     assert(I(1)==255 &amp;&amp; I(2)==216 &amp;&amp; I(end-1)==255 &amp;&amp; I(end)==217); <span class="comment">% JPG</span>
0152     fwrite(fid,numel(I)+4,<span class="string">'uint32'</span>); fwrite(fid,I); pad=10;
0153   <span class="keyword">case</span> <span class="string">'png'</span>
0154     <span class="keyword">if</span>( encode )
0155       <span class="comment">% write/read to/from temporary .png (not that much overhead)</span>
0156       p=cell(1,17); <span class="keyword">if</span>(nCh==1), p{4}=0; <span class="keyword">else</span> p{4}=2; <span class="keyword">end</span>
0157       p{1}=I; p{3}=tNm; p{5}=8; p{8}=<span class="string">'none'</span>; p{16}=cell(0,2);
0158       <span class="keyword">for</span> t=0:99, <span class="keyword">try</span> info.writeImg(p); fr=fopen(tNm,<span class="string">'r'</span>); assert(fr&gt;0);
0159           <span class="keyword">break</span>; <span class="keyword">catch</span>, pause(.01); fr=-1; <span class="keyword">end</span>; <span class="keyword">end</span> <span class="comment">%#ok&lt;CTCH&gt;</span>
0160       <span class="keyword">if</span>(fr&lt;0), error([<span class="string">'write fail: '</span> tNm]); <span class="keyword">end</span>; I=fread(fr); fclose(fr);
0161     <span class="keyword">end</span>
0162     fwrite(fid,numel(I)+4,<span class="string">'uint32'</span>); fwrite(fid,I); pad=10;
0163   <span class="keyword">otherwise</span>, assert(false);
0164 <span class="keyword">end</span>
0165 <span class="comment">% store seek info</span>
0166 <span class="keyword">if</span>(any(strcmp(ext,{<span class="string">'jpg'</span>,<span class="string">'png'</span>})))
0167   <span class="keyword">if</span>(length(info.seek)&lt;c+1), info.seek=[info.seek; zeros(c,1)]; <span class="keyword">end</span>
0168   info.seek(c+1)=info.seek(c)+numel(I)+10+pad;
0169 <span class="keyword">end</span>
0170 <span class="comment">% write timestamp</span>
0171 <span class="keyword">if</span>(nargin&lt;6),ts=(c-1)/info.fps; <span class="keyword">end</span>; s=floor(ts); ms=round(mod(ts,1)*1000);
0172 fwrite(fid,s,<span class="string">'int32'</span>); fwrite(fid,ms,<span class="string">'uint16'</span>); info.numFrames=c;
0173 <span class="comment">% pad with zeros</span>
0174 <span class="keyword">if</span>(pad&gt;0), fwrite(fid,zeros(1,pad),<span class="string">'uint8'</span>); <span class="keyword">end</span>
0175 <span class="keyword">end</span>
0176 
0177 <a name="_sub5" href="#_subfunctions" class="code">function writeHeader( fid, info )</a>
0178 fseek(fid,0,<span class="string">'bof'</span>);
0179 <span class="comment">% first 4 bytes store OxFEED, next 24 store 'Norpix seq  '</span>
0180 fwrite(fid,hex2dec(<span class="string">'FEED'</span>),<span class="string">'uint32'</span>);
0181 fwrite(fid,[<span class="string">'Norpix seq'</span> 0 0],<span class="string">'uint16'</span>);
0182 <span class="comment">% next 8 bytes for version (3) and header size (1024), then 512 for descr</span>
0183 fwrite(fid,[3 1024],<span class="string">'int32'</span>);
0184 <span class="keyword">if</span>(isfield(info,<span class="string">'descr'</span>)), d=info.descr(:); <span class="keyword">else</span> d=(<span class="string">'No Description'</span>)'; <span class="keyword">end</span>
0185 d=[d(1:min(256,end)); zeros(256-length(d),1)]; fwrite(fid,d,<span class="string">'uint16'</span>);
0186 <span class="comment">% write remaining info</span>
0187 vals=[info.width info.height info.imageBitDepth info.imageBitDepthReal <span class="keyword">...</span>
0188   info.imageSizeBytes info.imageFormat info.numFrames 0 <span class="keyword">...</span>
0189   info.trueImageSize];
0190 fwrite(fid,vals,<span class="string">'uint32'</span>);
0191 <span class="comment">% store frame rate and pad with 0's</span>
0192 fwrite(fid,info.fps,<span class="string">'float64'</span>); fwrite(fid,zeros(1,432),<span class="string">'uint8'</span>);
0193 <span class="comment">% write seek info for compressed images to disk</span>
0194 <span class="keyword">if</span>(any(strcmp(info.ext,{<span class="string">'jpg'</span>,<span class="string">'png'</span>})))
0195   seek=info.seek(1:info.numFrames); <span class="comment">%#ok&lt;NASGU&gt;</span>
0196   <span class="keyword">try</span> save(info.seekNm,<span class="string">'seek'</span>); <span class="keyword">catch</span>; <span class="keyword">end</span> <span class="comment">%#ok&lt;CTCH&gt;</span>
0197 <span class="keyword">end</span>
0198 <span class="keyword">end</span></pre></div>
<hr><address>Generated on Thu 05-May-2022 14:52:24 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>