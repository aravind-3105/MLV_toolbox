<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of simpleCache</title>
  <meta name="keywords" content="simpleCache">
  <meta name="description" content="A simple cache that can be used to store results of computations.">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../../../index.html">Home</a> &gt;  <a href="../../../index.html">MLVcode</a> &gt; <a href="../../index.html">edges-master</a> &gt; <a href="#">toolbox-master</a> &gt; <a href="index.html">matlab</a> &gt; simpleCache.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../../../index.html"><img alt="<" border="0" src="../../../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for MLVcode\edges-master\toolbox-master\matlab&nbsp;<img alt=">" border="0" src="../../../../right.png"></a></td></tr></table>-->

<h1>simpleCache
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<div class="box"><strong>A simple cache that can be used to store results of computations.</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<div class="box"><strong>function varargout = simpleCache( op, cache, varargin ) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<div class="fragment"><pre class="comment"> A simple cache that can be used to store results of computations.

 Can save and retrieve arbitrary values using a vector (includnig char
 vectors) as a key. Especially useful if a function must perform heavy
 computation but is often called with the same inputs (for which it will
 give the same outputs).  Note that the current implementation does a
 linear search for the key (a more refined implementation would use a hash
 table), so it is not meant for large scale usage.

 To use inside a function, make the cache persistent:
  persistent cache; if( isempty(cache) ) cache=simpleCache('init'); end;
 The following line, when placed inside a function, means the cache will
 stay in memory until the matlab environment changes.  For an example
 usage see maskGaussians.

 USAGE - 'init': initialize a cache object
  cache = simpleCache('init');

 USAGE - 'put': put something in cache.  key must be a numeric vector
  cache = simpleCache( 'put', cache, key, val );

 USAGE - 'get': retrieve from cache.  found==1 if obj was found
  [found,val] = simpleCache( 'get', cache, key );

 USAGE - 'remove': free key
  [cache,found] = simpleCache( 'remove', cache, key );

 INPUTS
  op         - 'init', 'put', 'get', 'remove'
  cache      - the cache object being operated on
  varargin   - see USAGE above

 OUTPUTS
  varargout  - see USAGE above

 EXAMPLE
  cache = simpleCache('init');
  hellokey=rand(1,3); worldkey=rand(1,11);
  cache = simpleCache( 'put', cache, hellokey, 'hello' );
  cache = simpleCache( 'put', cache, worldkey, 'world' );
  [f,v]=simpleCache( 'get', cache, hellokey ); disp(v);
  [f,v]=simpleCache( 'get', cache, worldkey ); disp(v);

 See also PERSISTENT, MASKGAUSSIANS

 Piotr's Computer Vision Matlab Toolbox      Version 2.61
 Copyright 2014 Piotr Dollar.  [pdollar-at-gmail.com]
 Licensed under the Simplified BSD License [see external/bsd.txt]</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../../matlabicon.gif)">
<li><a href="int2str2.html" class="code" title="function nstr = int2str2( n, nDigits )">int2str2</a>	Convert integer to string of given length; improved version of int2str.</li></ul>
This function is called by:
<ul style="list-style-image:url(../../../../matlabicon.gif)">
</ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<ul style="list-style-image:url(../../../../matlabicon.gif)">
<li><a href="#_sub1" class="code">function cache = cachegrow( cache )</a></li><li><a href="#_sub2" class="code">function cache = cacheput( cache, key, val )</a></li><li><a href="#_sub3" class="code">function [ind,val] = cacheget( cache, key )</a></li><li><a href="#_sub4" class="code">function [cache,found] = cacheremove( cache, key )</a></li></ul>

<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function varargout = simpleCache( op, cache, varargin )</a>
0002 <span class="comment">% A simple cache that can be used to store results of computations.</span>
0003 <span class="comment">%</span>
0004 <span class="comment">% Can save and retrieve arbitrary values using a vector (includnig char</span>
0005 <span class="comment">% vectors) as a key. Especially useful if a function must perform heavy</span>
0006 <span class="comment">% computation but is often called with the same inputs (for which it will</span>
0007 <span class="comment">% give the same outputs).  Note that the current implementation does a</span>
0008 <span class="comment">% linear search for the key (a more refined implementation would use a hash</span>
0009 <span class="comment">% table), so it is not meant for large scale usage.</span>
0010 <span class="comment">%</span>
0011 <span class="comment">% To use inside a function, make the cache persistent:</span>
0012 <span class="comment">%  persistent cache; if( isempty(cache) ) cache=simpleCache('init'); end;</span>
0013 <span class="comment">% The following line, when placed inside a function, means the cache will</span>
0014 <span class="comment">% stay in memory until the matlab environment changes.  For an example</span>
0015 <span class="comment">% usage see maskGaussians.</span>
0016 <span class="comment">%</span>
0017 <span class="comment">% USAGE - 'init': initialize a cache object</span>
0018 <span class="comment">%  cache = simpleCache('init');</span>
0019 <span class="comment">%</span>
0020 <span class="comment">% USAGE - 'put': put something in cache.  key must be a numeric vector</span>
0021 <span class="comment">%  cache = simpleCache( 'put', cache, key, val );</span>
0022 <span class="comment">%</span>
0023 <span class="comment">% USAGE - 'get': retrieve from cache.  found==1 if obj was found</span>
0024 <span class="comment">%  [found,val] = simpleCache( 'get', cache, key );</span>
0025 <span class="comment">%</span>
0026 <span class="comment">% USAGE - 'remove': free key</span>
0027 <span class="comment">%  [cache,found] = simpleCache( 'remove', cache, key );</span>
0028 <span class="comment">%</span>
0029 <span class="comment">% INPUTS</span>
0030 <span class="comment">%  op         - 'init', 'put', 'get', 'remove'</span>
0031 <span class="comment">%  cache      - the cache object being operated on</span>
0032 <span class="comment">%  varargin   - see USAGE above</span>
0033 <span class="comment">%</span>
0034 <span class="comment">% OUTPUTS</span>
0035 <span class="comment">%  varargout  - see USAGE above</span>
0036 <span class="comment">%</span>
0037 <span class="comment">% EXAMPLE</span>
0038 <span class="comment">%  cache = simpleCache('init');</span>
0039 <span class="comment">%  hellokey=rand(1,3); worldkey=rand(1,11);</span>
0040 <span class="comment">%  cache = simpleCache( 'put', cache, hellokey, 'hello' );</span>
0041 <span class="comment">%  cache = simpleCache( 'put', cache, worldkey, 'world' );</span>
0042 <span class="comment">%  [f,v]=simpleCache( 'get', cache, hellokey ); disp(v);</span>
0043 <span class="comment">%  [f,v]=simpleCache( 'get', cache, worldkey ); disp(v);</span>
0044 <span class="comment">%</span>
0045 <span class="comment">% See also PERSISTENT, MASKGAUSSIANS</span>
0046 <span class="comment">%</span>
0047 <span class="comment">% Piotr's Computer Vision Matlab Toolbox      Version 2.61</span>
0048 <span class="comment">% Copyright 2014 Piotr Dollar.  [pdollar-at-gmail.com]</span>
0049 <span class="comment">% Licensed under the Simplified BSD License [see external/bsd.txt]</span>
0050 
0051 <span class="keyword">switch</span> op
0052   <span class="keyword">case</span> <span class="string">'init'</span> <span class="comment">% init a cache</span>
0053     cacheSiz = 8;
0054     cache.freeinds = 1:cacheSiz;
0055     cache.keyns = -ones(1,cacheSiz);
0056     cache.keys = cell(1,cacheSiz);
0057     cache.vals = cell(1,cacheSiz);
0058     varargout = {cache};
0059     
0060   <span class="keyword">case</span> <span class="string">'put'</span> <span class="comment">% a put operation</span>
0061     key=varargin{1}; val=varargin{2};
0062     cache = <a href="#_sub2" class="code" title="subfunction cache = cacheput( cache, key, val )">cacheput</a>( cache, key, val );
0063     varargout = {cache};
0064     
0065   <span class="keyword">case</span> <span class="string">'get'</span> <span class="comment">% a get operation</span>
0066     key=varargin{1};
0067     [ind,val] = <a href="#_sub3" class="code" title="subfunction [ind,val] = cacheget( cache, key )">cacheget</a>( cache, key );
0068     found = ind&gt;0;
0069     varargout = {found,val};
0070     
0071   <span class="keyword">case</span> <span class="string">'remove'</span>  <span class="comment">% a remove operation</span>
0072     key=varargin{1};
0073     [cache,found] = <a href="#_sub4" class="code" title="subfunction [cache,found] = cacheremove( cache, key )">cacheremove</a>( cache, key );
0074     varargout = {cache,found};
0075     
0076   <span class="keyword">otherwise</span>
0077     error(<span class="string">'Unknown cache operation: %s'</span>,op);
0078 <span class="keyword">end</span>
0079 <span class="keyword">end</span>
0080 
0081 <a name="_sub1" href="#_subfunctions" class="code">function cache = cachegrow( cache )</a>
0082 <span class="comment">% double cache size</span>
0083 cacheSiz = length( cache.keyns );
0084 <span class="keyword">if</span>( cacheSiz&gt;64 ) <span class="comment">% warn if getting big</span>
0085   warning([<span class="string">'doubling cache size to: '</span> <a href="int2str2.html" class="code" title="function nstr = int2str2( n, nDigits )">int2str2</a>(cacheSiz*2)]);<span class="comment">%#ok&lt;WNTAG&gt;</span>
0086 <span class="keyword">end</span>
0087 cache.freeinds = [cache.freeinds (cacheSiz+1):(2*cacheSiz)];
0088 cache.keyns = [cache.keyns -ones(1,cacheSiz)];
0089 cache.keys  = [cache.keys cell(1,cacheSiz)];
0090 cache.vals  = [cache.vals cell(1,cacheSiz)];
0091 <span class="keyword">end</span>
0092 
0093 <a name="_sub2" href="#_subfunctions" class="code">function cache = cacheput( cache, key, val )</a>
0094 <span class="comment">% put something into the cache</span>
0095 
0096 <span class="comment">% get location to place</span>
0097 ind = <a href="#_sub3" class="code" title="subfunction [ind,val] = cacheget( cache, key )">cacheget</a>( cache, key ); <span class="comment">% see if already in cache</span>
0098 <span class="keyword">if</span>( ind==-1 )
0099   <span class="keyword">if</span>( isempty( cache.freeinds ) )
0100     cache = <a href="#_sub1" class="code" title="subfunction cache = cachegrow( cache )">cachegrow</a>( cache ); <span class="comment">%grow cache</span>
0101   <span class="keyword">end</span>
0102   ind = cache.freeinds(1); <span class="comment">% get new cache loc</span>
0103   cache.freeinds = cache.freeinds(2:end);
0104 <span class="keyword">end</span>
0105 
0106 <span class="comment">% now simply place in ind</span>
0107 cache.keyns(ind) = length(key);
0108 cache.keys{ind} = key;
0109 cache.vals{ind} = val;
0110 <span class="keyword">end</span>
0111 
0112 <a name="_sub3" href="#_subfunctions" class="code">function [ind,val] = cacheget( cache, key )</a>
0113 <span class="comment">% get cache element, or fail</span>
0114 cacheSiz = length( cache.keyns );
0115 keyn = length( key );
0116 <span class="keyword">for</span> i=1:cacheSiz
0117   <span class="keyword">if</span>(keyn==cache.keyns(i) &amp;&amp; all(key==cache.keys{i}))
0118     val = cache.vals{i}; ind = i; <span class="keyword">return</span>; <span class="keyword">end</span>
0119 <span class="keyword">end</span>
0120 ind=-1; val=-1;
0121 <span class="keyword">end</span>
0122 
0123 <a name="_sub4" href="#_subfunctions" class="code">function [cache,found] = cacheremove( cache, key )</a>
0124 <span class="comment">% get cache element, or fail</span>
0125 ind = <a href="#_sub3" class="code" title="subfunction [ind,val] = cacheget( cache, key )">cacheget</a>( cache, key );
0126 found = ind&gt;0;
0127 <span class="keyword">if</span>( found )
0128   cache.freeinds = [ind cache.freeinds];
0129   cache.keyns(ind) = -1;
0130   cache.keys{ind} = [];
0131   cache.vals{ind} = [];
0132 <span class="keyword">end</span>
0133 <span class="keyword">end</span></pre></div>
<hr><address>Generated on Thu 05-May-2022 15:20:21 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>