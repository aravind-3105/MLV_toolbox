<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of fernsClfTrain</title>
  <meta name="keywords" content="fernsClfTrain">
  <meta name="description" content="Train random fern classifier.">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../../../index.html">Home</a> &gt;  <a href="../../../index.html">MLVcode</a> &gt; <a href="../../index.html">edges-master</a> &gt; <a href="#">toolbox-master</a> &gt; <a href="index.html">classify</a> &gt; fernsClfTrain.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../../../index.html"><img alt="<" border="0" src="../../../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for MLVcode\edges-master\toolbox-master\classify&nbsp;<img alt=">" border="0" src="../../../../right.png"></a></td></tr></table>-->

<h1>fernsClfTrain
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<div class="box"><strong>Train random fern classifier.</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<div class="box"><strong>function [ferns,hsPr] = fernsClfTrain( data, hs, varargin ) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<div class="fragment"><pre class="comment"> Train random fern classifier.

 See &quot;Fast Keypoint Recognition in Ten Lines of Code&quot; by Mustafa Ozuysal,
 Pascal Fua and Vincent Lepetit, CVPR07.

 Dimensions:
  M - number ferns
  S - fern depth
  F - number features
  N - number input vectors
  H - number classes

 USAGE
  [ferns,hsPr] = fernsClfTrain( data, hs, [varargin] )

 INPUTS
  data     - [NxF] N length F feature vectors
  hs       - [Nx1] target output labels in [1,H]
  varargin - additional params (struct or name/value pairs)
   .S        - [10] fern depth (ferns are exponential in S)
   .M        - [50] number of ferns to train
   .thrr     - [0 1] range for randomly generated thresholds
   .bayes    - [1] if true combine probs using bayes assumption
   .ferns    - [] if given reuse previous ferns (recompute pFern)

 OUTPUTS
  ferns    - learned fern model w the following fields
   .fids     - [MxS] feature ids for each fern for each depth
   .thrs     - [MxS] threshold corresponding to each fid
   .pFern    - [2^SxHxM] learned log probs at fern leaves
   .bayes    - if true combine probs using bayes assumption
   .inds     - [NxM] cached indices for original training data
   .H        - number classes
  hsPr     - [Nx1] predicted output labels

 EXAMPLE
  N=5000; H=5; d=2; [xs0,hs0,xs1,hs1]=demoGenData(N,N,H,d,1,1);
  fernPrm=struct('S',4,'M',50,'thrr',[-1 1],'bayes',1);
  tic, [ferns,hsPr0]=fernsClfTrain(xs0,hs0,fernPrm); toc
  tic, hsPr1 = fernsClfApply( xs1, ferns ); toc
  e0=mean(hsPr0~=hs0); e1=mean(hsPr1~=hs1);
  fprintf('errors trn=%f tst=%f\n',e0,e1); figure(1);
  subplot(2,2,1); visualizeData(xs0,2,hs0);
  subplot(2,2,2); visualizeData(xs0,2,hsPr0);
  subplot(2,2,3); visualizeData(xs1,2,hs1);
  subplot(2,2,4); visualizeData(xs1,2,hsPr1);

 See also <a href="fernsClfApply.html" class="code" title="function [hs,probs] = fernsClfApply( data, ferns, inds )">fernsClfApply</a>, <a href="fernsInds.html" class="code" title="function inds = fernsInds( data, fids, thrs )">fernsInds</a>

 Piotr's Computer Vision Matlab Toolbox      Version 2.61
 Copyright 2014 Piotr Dollar.  [pdollar-at-gmail.com]
 Licensed under the Simplified BSD License [see external/bsd.txt]</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../../matlabicon.gif)">
<li><a href="fernsClfApply.html" class="code" title="function [hs,probs] = fernsClfApply( data, ferns, inds )">fernsClfApply</a>	Apply learned fern classifier.</li><li><a href="fernsInds.html" class="code" title="function inds = fernsInds( data, fids, thrs )">fernsInds</a>	Compute indices for each input by each fern.</li></ul>
This function is called by:
<ul style="list-style-image:url(../../../../matlabicon.gif)">
</ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function [ferns,hsPr] = fernsClfTrain( data, hs, varargin )</a>
0002 <span class="comment">% Train random fern classifier.</span>
0003 <span class="comment">%</span>
0004 <span class="comment">% See &quot;Fast Keypoint Recognition in Ten Lines of Code&quot; by Mustafa Ozuysal,</span>
0005 <span class="comment">% Pascal Fua and Vincent Lepetit, CVPR07.</span>
0006 <span class="comment">%</span>
0007 <span class="comment">% Dimensions:</span>
0008 <span class="comment">%  M - number ferns</span>
0009 <span class="comment">%  S - fern depth</span>
0010 <span class="comment">%  F - number features</span>
0011 <span class="comment">%  N - number input vectors</span>
0012 <span class="comment">%  H - number classes</span>
0013 <span class="comment">%</span>
0014 <span class="comment">% USAGE</span>
0015 <span class="comment">%  [ferns,hsPr] = fernsClfTrain( data, hs, [varargin] )</span>
0016 <span class="comment">%</span>
0017 <span class="comment">% INPUTS</span>
0018 <span class="comment">%  data     - [NxF] N length F feature vectors</span>
0019 <span class="comment">%  hs       - [Nx1] target output labels in [1,H]</span>
0020 <span class="comment">%  varargin - additional params (struct or name/value pairs)</span>
0021 <span class="comment">%   .S        - [10] fern depth (ferns are exponential in S)</span>
0022 <span class="comment">%   .M        - [50] number of ferns to train</span>
0023 <span class="comment">%   .thrr     - [0 1] range for randomly generated thresholds</span>
0024 <span class="comment">%   .bayes    - [1] if true combine probs using bayes assumption</span>
0025 <span class="comment">%   .ferns    - [] if given reuse previous ferns (recompute pFern)</span>
0026 <span class="comment">%</span>
0027 <span class="comment">% OUTPUTS</span>
0028 <span class="comment">%  ferns    - learned fern model w the following fields</span>
0029 <span class="comment">%   .fids     - [MxS] feature ids for each fern for each depth</span>
0030 <span class="comment">%   .thrs     - [MxS] threshold corresponding to each fid</span>
0031 <span class="comment">%   .pFern    - [2^SxHxM] learned log probs at fern leaves</span>
0032 <span class="comment">%   .bayes    - if true combine probs using bayes assumption</span>
0033 <span class="comment">%   .inds     - [NxM] cached indices for original training data</span>
0034 <span class="comment">%   .H        - number classes</span>
0035 <span class="comment">%  hsPr     - [Nx1] predicted output labels</span>
0036 <span class="comment">%</span>
0037 <span class="comment">% EXAMPLE</span>
0038 <span class="comment">%  N=5000; H=5; d=2; [xs0,hs0,xs1,hs1]=demoGenData(N,N,H,d,1,1);</span>
0039 <span class="comment">%  fernPrm=struct('S',4,'M',50,'thrr',[-1 1],'bayes',1);</span>
0040 <span class="comment">%  tic, [ferns,hsPr0]=fernsClfTrain(xs0,hs0,fernPrm); toc</span>
0041 <span class="comment">%  tic, hsPr1 = fernsClfApply( xs1, ferns ); toc</span>
0042 <span class="comment">%  e0=mean(hsPr0~=hs0); e1=mean(hsPr1~=hs1);</span>
0043 <span class="comment">%  fprintf('errors trn=%f tst=%f\n',e0,e1); figure(1);</span>
0044 <span class="comment">%  subplot(2,2,1); visualizeData(xs0,2,hs0);</span>
0045 <span class="comment">%  subplot(2,2,2); visualizeData(xs0,2,hsPr0);</span>
0046 <span class="comment">%  subplot(2,2,3); visualizeData(xs1,2,hs1);</span>
0047 <span class="comment">%  subplot(2,2,4); visualizeData(xs1,2,hsPr1);</span>
0048 <span class="comment">%</span>
0049 <span class="comment">% See also fernsClfApply, fernsInds</span>
0050 <span class="comment">%</span>
0051 <span class="comment">% Piotr's Computer Vision Matlab Toolbox      Version 2.61</span>
0052 <span class="comment">% Copyright 2014 Piotr Dollar.  [pdollar-at-gmail.com]</span>
0053 <span class="comment">% Licensed under the Simplified BSD License [see external/bsd.txt]</span>
0054 
0055 <span class="comment">% get additional parameters and check dimensions</span>
0056 dfs={<span class="string">'S'</span>,10,<span class="string">'M'</span>,50,<span class="string">'thrr'</span>,[0 1],<span class="string">'bayes'</span>,1,<span class="string">'ferns'</span>,[]};
0057 [S,M,thrr,bayes,ferns]=getPrmDflt(varargin,dfs,1);
0058 [N,F]=size(data); assert(length(hs)==N);
0059 H=max(hs); assert(all(hs&gt;0)); assert(S&lt;=20);
0060 
0061 <span class="keyword">if</span>( isempty(ferns) )
0062   <span class="comment">% create ferns model and compute inds (w/o field pFern)</span>
0063   thrs=rand(M,S)*(thrr(2)-thrr(1))+thrr(1);
0064   fids=uint32(floor(rand(M,S)*F+1)); inds=<a href="fernsInds.html" class="code" title="function inds = fernsInds( data, fids, thrs )">fernsInds</a>(data,fids,thrs);
0065   ferns=struct(<span class="string">'fids'</span>,fids,<span class="string">'thrs'</span>,thrs,<span class="string">'bayes'</span>,bayes,<span class="string">'H'</span>,H,<span class="string">'inds'</span>,inds);
0066 <span class="keyword">else</span>
0067   <span class="comment">% re-use cached model (will need to recompute pFern)</span>
0068   ferns.H=H; ferns.pFern=[]; inds=ferns.inds; assert(size(inds,1)==N);
0069 <span class="keyword">end</span>
0070 
0071 <span class="comment">% get counts for each leaf for each class for each fern</span>
0072 pFern = zeros(2^S,H,M); edges = 1:2^S;
0073 <span class="keyword">for</span> h=1:H, inds1=inds(hs==h,:);
0074   <span class="keyword">for</span> m=1:M, pFern(:,h,m)=histc(inds1(:,m),edges); <span class="keyword">end</span>
0075 <span class="keyword">end</span>
0076 pFern = pFern + bayes;
0077 
0078 <span class="comment">% convert fern leaf class counts into probabilities</span>
0079 <span class="keyword">if</span>( bayes&lt;=0 )
0080   norm = 1./sum(pFern,2);
0081   pFern = bsxfun(@times,pFern,norm);
0082 <span class="keyword">else</span>
0083   norm = 1./sum(pFern,1);
0084   pFern = bsxfun(@times,pFern,norm);
0085   pFern=log(pFern);
0086 <span class="keyword">end</span>
0087 
0088 <span class="comment">% store pFern and compute output values</span>
0089 ferns.pFern=pFern; clear pFern;
0090 <span class="keyword">if</span>(nargout==2), hsPr=<a href="fernsClfApply.html" class="code" title="function [hs,probs] = fernsClfApply( data, ferns, inds )">fernsClfApply</a>([],ferns,inds); <span class="keyword">end</span>
0091 
0092 <span class="keyword">end</span></pre></div>
<hr><address>Generated on Thu 05-May-2022 15:20:21 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>