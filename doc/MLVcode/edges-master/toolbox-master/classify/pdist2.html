<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of pdist2</title>
  <meta name="keywords" content="pdist2">
  <meta name="description" content="Calculates the distance between sets of vectors.">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../../../index.html">Home</a> &gt;  <a href="../../../index.html">MLVcode</a> &gt; <a href="../../index.html">edges-master</a> &gt; <a href="#">toolbox-master</a> &gt; <a href="index.html">classify</a> &gt; pdist2.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../../../index.html"><img alt="<" border="0" src="../../../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for MLVcode\edges-master\toolbox-master\classify&nbsp;<img alt=">" border="0" src="../../../../right.png"></a></td></tr></table>-->

<h1>pdist2
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<div class="box"><strong>Calculates the distance between sets of vectors.</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<div class="box"><strong>function D = pdist2( X, Y, metric ) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<div class="fragment"><pre class="comment"> Calculates the distance between sets of vectors.

 Let X be an m-by-p matrix representing m points in p-dimensional space
 and Y be an n-by-p matrix representing another set of points in the same
 space. This function computes the m-by-n distance matrix D where D(i,j)
 is the distance between X(i,:) and Y(j,:).  This function has been
 optimized where possible, with most of the distance computations
 requiring few or no loops.

 The metric can be one of the following:

 'euclidean' / 'sqeuclidean':
   Euclidean / SQUARED Euclidean distance.  Note that 'sqeuclidean'
   is significantly faster.

 'chisq'
   The chi-squared distance between two vectors is defined as:
    d(x,y) = sum( (xi-yi)^2 / (xi+yi) ) / 2;
   The chi-squared distance is useful when comparing histograms.

 'cosine'
   Distance is defined as the cosine of the angle between two vectors.

 'emd'
   Earth Mover's Distance (EMD) between positive vectors (histograms).
   Note for 1D, with all histograms having equal weight, there is a simple
   closed form for the calculation of the EMD.  The EMD between histograms
   x and y is given by the sum(abs(cdf(x)-cdf(y))), where cdf is the
   cumulative distribution function (computed simply by cumsum).

 'L1'
   The L1 distance between two vectors is defined as:  sum(abs(x-y));


 USAGE
  D = pdist2( X, Y, [metric] )

 INPUTS
  X        - [m x p] matrix of m p-dimensional vectors
  Y        - [n x p] matrix of n p-dimensional vectors
  metric   - ['sqeuclidean'], 'chisq', 'cosine', 'emd', 'euclidean', 'L1'

 OUTPUTS
  D        - [m x n] distance matrix

 EXAMPLE
  % simple example where points cluster well
  [X,IDX] = demoGenData(100,0,5,4,10,2,0);
  D = pdist2( X, X, 'sqeuclidean' );
  distMatrixShow( D, IDX );
  % comparison to pdist
  n=500; d=200; r=100; X=rand(n,d);
  tic, for i=1:r, D1 = pdist( X, 'euclidean' ); end, toc
  tic, for i=1:r, D2 = pdist2( X, X, 'euclidean' ); end, toc
  D1=squareform(D1); del=D1-D2; sum(abs(del(:)))
 
 See also pdist, <a href="distMatrixShow.html" class="code" title="function [D, Dsm] = distMatrixShow( D, IDX, show )">distMatrixShow</a>

 Piotr's Computer Vision Matlab Toolbox      Version 2.52
 Copyright 2014 Piotr Dollar.  [pdollar-at-gmail.com]
 Licensed under the Simplified BSD License [see external/bsd.txt]</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../../matlabicon.gif)">
</ul>
This function is called by:
<ul style="list-style-image:url(../../../../matlabicon.gif)">
<li><a href="demoCluster.html" class="code" title="">demoCluster</a>	Clustering demo.</li><li><a href="demoGenData.html" class="code" title="function [X0,H0,X1,H1] = demoGenData1(n0,n1,k,d,sep,ecc,frc)">demoGenData</a>	Generate data drawn form a mixture of Gaussians.</li><li><a href="kmeans2.html" class="code" title="function [ IDX, C, d ] = kmeans2( X, k, varargin )">kmeans2</a>	Fast version of kmeans clustering.</li><li><a href="meanShiftImExplore.html" class="code" title="function meanShiftImExplore( I, X, sigSpt, sigRng, show )">meanShiftImExplore</a>	Visualization to help choose sigmas for meanShiftIm.</li><li><a href="rbfComputeBasis.html" class="code" title="function rbfBasis = rbfComputeBasis( X, k, cluster, scale, show )">rbfComputeBasis</a>	Get locations and sizes of radial basis functions for use in rbf network.</li><li><a href="rbfComputeFtrs.html" class="code" title="function Xrbf = rbfComputeFtrs( X, rbfBasis )">rbfComputeFtrs</a>	Evaluate features of X given a set of radial basis functions.</li></ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<ul style="list-style-image:url(../../../../matlabicon.gif)">
<li><a href="#_sub1" class="code">function D = distL1( X, Y )</a></li><li><a href="#_sub2" class="code">function D = distCosine( X, Y )</a></li><li><a href="#_sub3" class="code">function D = distEmd( X, Y )</a></li><li><a href="#_sub4" class="code">function D = distChiSq( X, Y )</a></li><li><a href="#_sub5" class="code">function D = distEucSq( X, Y )</a></li></ul>

<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function D = pdist2( X, Y, metric )</a>
0002 <span class="comment">% Calculates the distance between sets of vectors.</span>
0003 <span class="comment">%</span>
0004 <span class="comment">% Let X be an m-by-p matrix representing m points in p-dimensional space</span>
0005 <span class="comment">% and Y be an n-by-p matrix representing another set of points in the same</span>
0006 <span class="comment">% space. This function computes the m-by-n distance matrix D where D(i,j)</span>
0007 <span class="comment">% is the distance between X(i,:) and Y(j,:).  This function has been</span>
0008 <span class="comment">% optimized where possible, with most of the distance computations</span>
0009 <span class="comment">% requiring few or no loops.</span>
0010 <span class="comment">%</span>
0011 <span class="comment">% The metric can be one of the following:</span>
0012 <span class="comment">%</span>
0013 <span class="comment">% 'euclidean' / 'sqeuclidean':</span>
0014 <span class="comment">%   Euclidean / SQUARED Euclidean distance.  Note that 'sqeuclidean'</span>
0015 <span class="comment">%   is significantly faster.</span>
0016 <span class="comment">%</span>
0017 <span class="comment">% 'chisq'</span>
0018 <span class="comment">%   The chi-squared distance between two vectors is defined as:</span>
0019 <span class="comment">%    d(x,y) = sum( (xi-yi)^2 / (xi+yi) ) / 2;</span>
0020 <span class="comment">%   The chi-squared distance is useful when comparing histograms.</span>
0021 <span class="comment">%</span>
0022 <span class="comment">% 'cosine'</span>
0023 <span class="comment">%   Distance is defined as the cosine of the angle between two vectors.</span>
0024 <span class="comment">%</span>
0025 <span class="comment">% 'emd'</span>
0026 <span class="comment">%   Earth Mover's Distance (EMD) between positive vectors (histograms).</span>
0027 <span class="comment">%   Note for 1D, with all histograms having equal weight, there is a simple</span>
0028 <span class="comment">%   closed form for the calculation of the EMD.  The EMD between histograms</span>
0029 <span class="comment">%   x and y is given by the sum(abs(cdf(x)-cdf(y))), where cdf is the</span>
0030 <span class="comment">%   cumulative distribution function (computed simply by cumsum).</span>
0031 <span class="comment">%</span>
0032 <span class="comment">% 'L1'</span>
0033 <span class="comment">%   The L1 distance between two vectors is defined as:  sum(abs(x-y));</span>
0034 <span class="comment">%</span>
0035 <span class="comment">%</span>
0036 <span class="comment">% USAGE</span>
0037 <span class="comment">%  D = pdist2( X, Y, [metric] )</span>
0038 <span class="comment">%</span>
0039 <span class="comment">% INPUTS</span>
0040 <span class="comment">%  X        - [m x p] matrix of m p-dimensional vectors</span>
0041 <span class="comment">%  Y        - [n x p] matrix of n p-dimensional vectors</span>
0042 <span class="comment">%  metric   - ['sqeuclidean'], 'chisq', 'cosine', 'emd', 'euclidean', 'L1'</span>
0043 <span class="comment">%</span>
0044 <span class="comment">% OUTPUTS</span>
0045 <span class="comment">%  D        - [m x n] distance matrix</span>
0046 <span class="comment">%</span>
0047 <span class="comment">% EXAMPLE</span>
0048 <span class="comment">%  % simple example where points cluster well</span>
0049 <span class="comment">%  [X,IDX] = demoGenData(100,0,5,4,10,2,0);</span>
0050 <span class="comment">%  D = pdist2( X, X, 'sqeuclidean' );</span>
0051 <span class="comment">%  distMatrixShow( D, IDX );</span>
0052 <span class="comment">%  % comparison to pdist</span>
0053 <span class="comment">%  n=500; d=200; r=100; X=rand(n,d);</span>
0054 <span class="comment">%  tic, for i=1:r, D1 = pdist( X, 'euclidean' ); end, toc</span>
0055 <span class="comment">%  tic, for i=1:r, D2 = pdist2( X, X, 'euclidean' ); end, toc</span>
0056 <span class="comment">%  D1=squareform(D1); del=D1-D2; sum(abs(del(:)))</span>
0057 <span class="comment">%</span>
0058 <span class="comment">% See also pdist, distMatrixShow</span>
0059 <span class="comment">%</span>
0060 <span class="comment">% Piotr's Computer Vision Matlab Toolbox      Version 2.52</span>
0061 <span class="comment">% Copyright 2014 Piotr Dollar.  [pdollar-at-gmail.com]</span>
0062 <span class="comment">% Licensed under the Simplified BSD License [see external/bsd.txt]</span>
0063 
0064 <span class="keyword">if</span>( nargin&lt;3 || isempty(metric) ); metric=0; <span class="keyword">end</span>;
0065 
0066 <span class="keyword">switch</span> metric
0067   <span class="keyword">case</span> {0,<span class="string">'sqeuclidean'</span>}
0068     D = <a href="#_sub5" class="code" title="subfunction D = distEucSq( X, Y )">distEucSq</a>( X, Y );
0069   <span class="keyword">case</span> <span class="string">'euclidean'</span>
0070     D = sqrt(<a href="#_sub5" class="code" title="subfunction D = distEucSq( X, Y )">distEucSq</a>( X, Y ));
0071   <span class="keyword">case</span> <span class="string">'L1'</span>
0072     D = <a href="#_sub1" class="code" title="subfunction D = distL1( X, Y )">distL1</a>( X, Y );
0073   <span class="keyword">case</span> <span class="string">'cosine'</span>
0074     D = <a href="#_sub2" class="code" title="subfunction D = distCosine( X, Y )">distCosine</a>( X, Y );
0075   <span class="keyword">case</span> <span class="string">'emd'</span>
0076     D = <a href="#_sub3" class="code" title="subfunction D = distEmd( X, Y )">distEmd</a>( X, Y );
0077   <span class="keyword">case</span> <span class="string">'chisq'</span>
0078     D = <a href="#_sub4" class="code" title="subfunction D = distChiSq( X, Y )">distChiSq</a>( X, Y );
0079   <span class="keyword">otherwise</span>
0080     error([<span class="string">'pdist2 - unknown metric: '</span> metric]);
0081 <span class="keyword">end</span>
0082 D = max(0,D);
0083 <span class="keyword">end</span>
0084 
0085 <a name="_sub1" href="#_subfunctions" class="code">function D = distL1( X, Y )</a>
0086 m = size(X,1);  n = size(Y,1);
0087 mOnes = ones(1,m); D = zeros(m,n);
0088 <span class="keyword">for</span> i=1:n
0089   yi = Y(i,:);  yi = yi( mOnes, : );
0090   D(:,i) = sum( abs( X-yi),2 );
0091 <span class="keyword">end</span>
0092 <span class="keyword">end</span>
0093 
0094 <a name="_sub2" href="#_subfunctions" class="code">function D = distCosine( X, Y )</a>
0095 p=size(X,2);
0096 XX = sqrt(sum(X.*X,2)); X = X ./ XX(:,ones(1,p));
0097 YY = sqrt(sum(Y.*Y,2)); Y = Y ./ YY(:,ones(1,p));
0098 D = 1 - X*Y';
0099 <span class="keyword">end</span>
0100 
0101 <a name="_sub3" href="#_subfunctions" class="code">function D = distEmd( X, Y )</a>
0102 Xcdf = cumsum(X,2);
0103 Ycdf = cumsum(Y,2);
0104 m = size(X,1);  n = size(Y,1);
0105 mOnes = ones(1,m); D = zeros(m,n);
0106 <span class="keyword">for</span> i=1:n
0107   ycdf = Ycdf(i,:);
0108   ycdfRep = ycdf( mOnes, : );
0109   D(:,i) = sum(abs(Xcdf - ycdfRep),2);
0110 <span class="keyword">end</span>
0111 <span class="keyword">end</span>
0112 
0113 <a name="_sub4" href="#_subfunctions" class="code">function D = distChiSq( X, Y )</a>
0114 <span class="comment">% note: supposedly it's possible to implement this without a loop!</span>
0115 m = size(X,1);  n = size(Y,1);
0116 mOnes = ones(1,m); D = zeros(m,n);
0117 <span class="keyword">for</span> i=1:n
0118   yi = Y(i,:);  yiRep = yi( mOnes, : );
0119   s = yiRep + X;    d = yiRep - X;
0120   D(:,i) = sum( d.^2 ./ (s+eps), 2 );
0121 <span class="keyword">end</span>
0122 D = D/2;
0123 <span class="keyword">end</span>
0124 
0125 <a name="_sub5" href="#_subfunctions" class="code">function D = distEucSq( X, Y )</a>
0126 Yt = Y';
0127 XX = sum(X.*X,2);
0128 YY = sum(Yt.*Yt,1);
0129 D = bsxfun(@plus,XX,YY)-2*X*Yt;
0130 <span class="keyword">end</span>
0131 
0132 <span class="comment">%%%% code from Charles Elkan with variables renamed</span>
0133 <span class="comment">% function D = distEucSq( X, Y )</span>
0134 <span class="comment">% m = size(X,1); n = size(Y,1);</span>
0135 <span class="comment">% D = sum(X.^2, 2) * ones(1,n) + ones(m,1) * sum(Y.^2, 2)' - 2.*X*Y';</span>
0136 <span class="comment">% end</span>
0137 
0138 <span class="comment">%%% LOOP METHOD - SLOW</span>
0139 <span class="comment">% [m p] = size(X);</span>
0140 <span class="comment">% [n p] = size(Y);</span>
0141 <span class="comment">% D = zeros(m,n);</span>
0142 <span class="comment">% onesM = ones(m,1);</span>
0143 <span class="comment">% for i=1:n</span>
0144 <span class="comment">%   y = Y(i,:);</span>
0145 <span class="comment">%   d = X - y(onesM,:);</span>
0146 <span class="comment">%   D(:,i) = sum( d.*d, 2 );</span>
0147 <span class="comment">% end</span>
0148 
0149 <span class="comment">%%% PARALLEL METHOD THAT IS SUPER SLOW (slower than loop)!</span>
0150 <span class="comment">% % From &quot;MATLAB array manipulation tips and tricks&quot; by Peter J. Acklam</span>
0151 <span class="comment">% Xb = permute(X, [1 3 2]);</span>
0152 <span class="comment">% Yb = permute(Y, [3 1 2]);</span>
0153 <span class="comment">% D = sum( (Xb(:,ones(1,n),:) - Yb(ones(1,m),:,:)).^2, 3);</span>
0154 
0155 <span class="comment">%%% USELESS FOR EVEN VERY LARGE ARRAYS X=16000x1000!! and Y=100x1000</span>
0156 <span class="comment">% call recursively to save memory</span>
0157 <span class="comment">% if( (m+n)*p &gt; 10^5 &amp;&amp; (m&gt;1 || n&gt;1))</span>
0158 <span class="comment">%   if( m&gt;n )</span>
0159 <span class="comment">%     X1 = X(1:floor(end/2),:);</span>
0160 <span class="comment">%     X2 = X((floor(end/2)+1):end,:);</span>
0161 <span class="comment">%     D1 = distEucSq( X1, Y );</span>
0162 <span class="comment">%     D2 = distEucSq( X2, Y );</span>
0163 <span class="comment">%     D = cat( 1, D1, D2 );</span>
0164 <span class="comment">%   else</span>
0165 <span class="comment">%     Y1 = Y(1:floor(end/2),:);</span>
0166 <span class="comment">%     Y2 = Y((floor(end/2)+1):end,:);</span>
0167 <span class="comment">%     D1 = distEucSq( X, Y1 );</span>
0168 <span class="comment">%     D2 = distEucSq( X, Y2 );</span>
0169 <span class="comment">%     D = cat( 2, D1, D2 );</span>
0170 <span class="comment">%   end</span>
0171 <span class="comment">%   return;</span>
0172 <span class="comment">% end</span>
0173 
0174 <span class="comment">%%% L1 COMPUTATION WITH LOOP OVER p, FAST FOR SMALL p.</span>
0175 <span class="comment">% function D = distL1( X, Y )</span>
0176 <span class="comment">%</span>
0177 <span class="comment">% m = size(X,1); n = size(Y,1); p = size(X,2);</span>
0178 <span class="comment">% mOnes = ones(1,m); nOnes = ones(1,n); D = zeros(m,n);</span>
0179 <span class="comment">% for i=1:p</span>
0180 <span class="comment">%   yi = Y(:,i);  yi = yi( :, mOnes );</span>
0181 <span class="comment">%   xi = X(:,i);  xi = xi( :, nOnes );</span>
0182 <span class="comment">%   D = D + abs( xi-yi' );</span>
0183 <span class="comment">% end</span></pre></div>
<hr><address>Generated on Thu 05-May-2022 14:52:24 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>