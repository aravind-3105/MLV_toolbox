<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of m2html</title>
  <meta name="keywords" content="m2html">
  <meta name="description" content="M2HTML - Documentation Generator for Matlab M-files and Toolboxes in HTML">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../../../../index.html">Home</a> &gt;  <a href="../../../../index.html">MLVcode</a> &gt; <a href="../../../index.html">edges-master</a> &gt; <a href="#">toolbox-master</a> &gt; <a href="../index.html">external</a> &gt; <a href="index.html">m2html</a> &gt; m2html.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../../../../index.html"><img alt="<" border="0" src="../../../../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for MLVcode\edges-master\toolbox-master\external\m2html&nbsp;<img alt=">" border="0" src="../../../../../right.png"></a></td></tr></table>-->

<h1>m2html
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../../../up.png"></a></h2>
<div class="box"><strong>M2HTML - Documentation Generator for Matlab M-files and Toolboxes in HTML</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../../../up.png"></a></h2>
<div class="box"><strong>function m2html(varargin) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../../../up.png"></a></h2>
<div class="fragment"><pre class="comment">M2HTML - Documentation Generator for Matlab M-files and Toolboxes in HTML
  M2HTML by itself generates an HTML documentation of the Matlab M-files found
  in the direct subdirectories of the current directory. HTML files are 
  written in a 'doc' directory (created if necessary). All the others options
  are set to default (in brackets in the following).
  M2HTML('PropertyName1',PropertyValue1,'PropertyName2',PropertyValue2,...)
  sets multiple option values. The list of option names and default values is:
    o mFiles - Cell array of strings or character array containing the
       list of M-files and/or directories of M-files for which an HTML
       documentation will be built (use relative paths without backtracking).
       Launch M2HTML one directory above the directory your wanting to
       generate documentation for  [ &lt;all direct subdirectories&gt; ]
    o htmlDir - Top level directory for generated HTML files [ 'doc' ]
    o recursive - Process subdirectories recursively [ on | {off} ]
    o source - Include Matlab source code in the generated documentation
                               [ {on} | off ]
    o download - Add a link to download each M-file separately [ on | {off} ]
    o syntaxHighlighting - Source Code Syntax Highlighting [ {on} | off ]
    o tabs - Replace '\t' (horizontal tab) in source code by n white space
        characters [ 0 ... {4} ... n ]
    o globalHypertextLinks - Hypertext links among separate Matlab 
        directories [ on | {off} ]
    o todo - Create a TODO list in each directory summarizing all the
        '% TODO %' lines found in Matlab code [ on | {off}]
    o graph - Compute a dependency graph using GraphViz [ on | {off}]
        'dot' required, see &lt;http://www.graphviz.org/&gt;
    o indexFile - Basename of the HTML index file [ 'index' ]
    o extension - Extension of generated HTML files [ '.html' ]
    o template - HTML template name to use [ {'blue'} | 'frame' | ... ]
    o search - Add a PHP search engine [ on | {off}] - beta version!
    o save - Save current state after M-files parsing in 'm2html.mat' 
        in directory htmlDir [ on | {off}]
    o load - Load a previously saved '.mat' M2HTML state to generate HTML 
        files once again with possibly other options [ &lt;none&gt; ]
    o verbose - Verbose mode [ {on} | off ]

  For more information, please read the M2HTML tutorial and FAQ at:
    &lt;http://www.artefact.tk/software/matlab/m2html/&gt;

  Examples:
    &gt;&gt; m2html('mfiles','matlab', 'htmldir','doc');
    &gt;&gt; m2html('mfiles',{'matlab/signal' 'matlab/image'}, 'htmldir','doc');
    &gt;&gt; m2html('mfiles','matlab', 'htmldir','doc', 'recursive','on');
    &gt;&gt; m2html('mfiles','mytoolbox', 'htmldir','doc', 'source','off');
    &gt;&gt; m2html('mfiles','matlab', 'htmldir','doc', 'global','on');
    &gt;&gt; m2html( ... , 'template','frame', 'index','menu');

  See also <a href="mwizard.html" class="code" title="function mwizard(file)">MWIZARD</a>, <a href="mdot.html" class="code" title="function mdot(mmat, dotfile,f)">MDOT</a>, TEMPLATE.</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../../../matlabicon.gif)">
<li><a href="mdot.html" class="code" title="function mdot(mmat, dotfile,f)">mdot</a>	MDOT - Export a dependency graph into DOT language</li></ul>
This function is called by:
<ul style="list-style-image:url(../../../../../matlabicon.gif)">
<li><a href="mwizard.html" class="code" title="function mwizard(file)">mwizard</a>	MWIZARD - M2HTML Graphical User Interface</li><li><a href="mwizard2.html" class="code" title="function mwizard(file)">mwizard2</a>	MWIZARD - M2HTML Graphical User Interface</li></ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../../../../../up.png"></a></h2>
<ul style="list-style-image:url(../../../../../matlabicon.gif)">
<li><a href="#_sub1" class="code">function mfiles = getmfiles(mdirs, mfiles, recursive)</a></li><li><a href="#_sub2" class="code">function calldot(dotexec, mdotfile, mapfile, pngfile, opt)</a></li><li><a href="#_sub3" class="code">function s = backtomaster(mdir)</a></li><li><a href="#_sub4" class="code">function ldir = splitpath(p)</a></li><li><a href="#_sub5" class="code">function name = extractname(synopsis)</a></li><li><a href="#_sub6" class="code">function f = fullurl(varargin)</a></li><li><a href="#_sub7" class="code">function str = escapeblank(str)</a></li><li><a href="#_sub8" class="code">function str = entity(str)</a></li><li><a href="#_sub9" class="code">function str = horztab(str,n)</a></li></ul>

<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function m2html(varargin)</a>
0002 <span class="comment">%M2HTML - Documentation Generator for Matlab M-files and Toolboxes in HTML</span>
0003 <span class="comment">%  M2HTML by itself generates an HTML documentation of the Matlab M-files found</span>
0004 <span class="comment">%  in the direct subdirectories of the current directory. HTML files are</span>
0005 <span class="comment">%  written in a 'doc' directory (created if necessary). All the others options</span>
0006 <span class="comment">%  are set to default (in brackets in the following).</span>
0007 <span class="comment">%  M2HTML('PropertyName1',PropertyValue1,'PropertyName2',PropertyValue2,...)</span>
0008 <span class="comment">%  sets multiple option values. The list of option names and default values is:</span>
0009 <span class="comment">%    o mFiles - Cell array of strings or character array containing the</span>
0010 <span class="comment">%       list of M-files and/or directories of M-files for which an HTML</span>
0011 <span class="comment">%       documentation will be built (use relative paths without backtracking).</span>
0012 <span class="comment">%       Launch M2HTML one directory above the directory your wanting to</span>
0013 <span class="comment">%       generate documentation for  [ &lt;all direct subdirectories&gt; ]</span>
0014 <span class="comment">%    o htmlDir - Top level directory for generated HTML files [ 'doc' ]</span>
0015 <span class="comment">%    o recursive - Process subdirectories recursively [ on | {off} ]</span>
0016 <span class="comment">%    o source - Include Matlab source code in the generated documentation</span>
0017 <span class="comment">%                               [ {on} | off ]</span>
0018 <span class="comment">%    o download - Add a link to download each M-file separately [ on | {off} ]</span>
0019 <span class="comment">%    o syntaxHighlighting - Source Code Syntax Highlighting [ {on} | off ]</span>
0020 <span class="comment">%    o tabs - Replace '\t' (horizontal tab) in source code by n white space</span>
0021 <span class="comment">%        characters [ 0 ... {4} ... n ]</span>
0022 <span class="comment">%    o globalHypertextLinks - Hypertext links among separate Matlab</span>
0023 <span class="comment">%        directories [ on | {off} ]</span>
0024 <span class="comment">%    o todo - Create a TODO list in each directory summarizing all the</span>
0025 <span class="comment">%        '% TODO %' lines found in Matlab code [ on | {off}]</span>
0026 <span class="comment">%    o graph - Compute a dependency graph using GraphViz [ on | {off}]</span>
0027 <span class="comment">%        'dot' required, see &lt;http://www.graphviz.org/&gt;</span>
0028 <span class="comment">%    o indexFile - Basename of the HTML index file [ 'index' ]</span>
0029 <span class="comment">%    o extension - Extension of generated HTML files [ '.html' ]</span>
0030 <span class="comment">%    o template - HTML template name to use [ {'blue'} | 'frame' | ... ]</span>
0031 <span class="comment">%    o search - Add a PHP search engine [ on | {off}] - beta version!</span>
0032 <span class="comment">%    o save - Save current state after M-files parsing in 'm2html.mat'</span>
0033 <span class="comment">%        in directory htmlDir [ on | {off}]</span>
0034 <span class="comment">%    o load - Load a previously saved '.mat' M2HTML state to generate HTML</span>
0035 <span class="comment">%        files once again with possibly other options [ &lt;none&gt; ]</span>
0036 <span class="comment">%    o verbose - Verbose mode [ {on} | off ]</span>
0037 <span class="comment">%</span>
0038 <span class="comment">%  For more information, please read the M2HTML tutorial and FAQ at:</span>
0039 <span class="comment">%    &lt;http://www.artefact.tk/software/matlab/m2html/&gt;</span>
0040 <span class="comment">%</span>
0041 <span class="comment">%  Examples:</span>
0042 <span class="comment">%    &gt;&gt; m2html('mfiles','matlab', 'htmldir','doc');</span>
0043 <span class="comment">%    &gt;&gt; m2html('mfiles',{'matlab/signal' 'matlab/image'}, 'htmldir','doc');</span>
0044 <span class="comment">%    &gt;&gt; m2html('mfiles','matlab', 'htmldir','doc', 'recursive','on');</span>
0045 <span class="comment">%    &gt;&gt; m2html('mfiles','mytoolbox', 'htmldir','doc', 'source','off');</span>
0046 <span class="comment">%    &gt;&gt; m2html('mfiles','matlab', 'htmldir','doc', 'global','on');</span>
0047 <span class="comment">%    &gt;&gt; m2html( ... , 'template','frame', 'index','menu');</span>
0048 <span class="comment">%</span>
0049 <span class="comment">%  See also MWIZARD, MDOT, TEMPLATE.</span>
0050 
0051 <span class="comment">%  Copyright (C) 2005 Guillaume Flandin &lt;Guillaume@artefact.tk&gt;</span>
0052 <span class="comment">%  $Revision: 1.5 $Date: 2005/04/29 16:04:17 $</span>
0053 
0054 <span class="comment">%  This program is free software; you can redistribute it and/or</span>
0055 <span class="comment">%  modify it under the terms of the GNU General Public License</span>
0056 <span class="comment">%  as published by the Free Software Foundation; either version 2</span>
0057 <span class="comment">%  of the License, or any later version.</span>
0058 <span class="comment">%</span>
0059 <span class="comment">%  This program is distributed in the hope that it will be useful,</span>
0060 <span class="comment">%  but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
0061 <span class="comment">%  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
0062 <span class="comment">%  GNU General Public License for more details.</span>
0063 <span class="comment">%</span>
0064 <span class="comment">%  You should have received a copy of the GNU General Public License</span>
0065 <span class="comment">%  along with this program; if not, write to the Free Software</span>
0066 <span class="comment">%  Foundation Inc, 59 Temple Pl. - Suite 330, Boston, MA 02111-1307, USA.</span>
0067 
0068 <span class="comment">%  Suggestions for improvement and fixes are always welcome, although no</span>
0069 <span class="comment">%  guarantee is made whether and when they will be implemented.</span>
0070 <span class="comment">%  Send requests to Guillaume@artefact.tk</span>
0071 
0072 <span class="comment">%  For tips on how to write Matlab code, see:</span>
0073 <span class="comment">%     * MATLAB Programming Style Guidelines, by R. Johnson:</span>
0074 <span class="comment">%       &lt;http://www.datatool.com/prod02.htm&gt;</span>
0075 <span class="comment">%     * For tips on creating help for your m-files 'type help.m'.</span>
0076 <span class="comment">%     * Matlab documentation on M-file Programming:</span>
0077 <span class="comment">%  &lt;http://www.mathworks.com/access/helpdesk/help/techdoc/matlab_prog/ch_funh8.html&gt;</span>
0078 
0079 <span class="comment">%  This function uses the Template class so that you can fully customize</span>
0080 <span class="comment">%  the output. You can modify .tpl files in templates/blue/ or create new</span>
0081 <span class="comment">%  templates in a new directory.</span>
0082 <span class="comment">%  See the template class documentation for more details.</span>
0083 <span class="comment">%  &lt;http://www.artefact.tk/software/matlab/template/&gt;</span>
0084 
0085 <span class="comment">%  Latest information on M2HTML is available on the web through:</span>
0086 <span class="comment">%  &lt;http://www.artefact.tk/software/matlab/m2html/&gt;</span>
0087 
0088 <span class="comment">%  Other Matlab to HTML converters available on the web:</span>
0089 <span class="comment">%  1/ mat2html.pl, J.C. Kantor, in Perl, 1995:</span>
0090 <span class="comment">%     &lt;http://fresh.t-systems-sfr.com/unix/src/www/mat2html&gt;</span>
0091 <span class="comment">%  2/ htmltools, B. Alsberg, in Matlab, 1997:</span>
0092 <span class="comment">%     &lt;http://www.mathworks.com/matlabcentral/fileexchange/loadFile.do?objectId=175&gt;</span>
0093 <span class="comment">%  3/ mtree2html2001, H. Pohlheim, in Perl, 1996, 2001:</span>
0094 <span class="comment">%     &lt;http://www.pohlheim.com/perl_main.html#matlabdocu&gt;</span>
0095 <span class="comment">%  4/ MatlabToHTML, T. Kristjansson, binary, 2001:</span>
0096 <span class="comment">%     &lt;http://www.psi.utoronto.ca/~trausti/MatlabToHTML/MatlabToHTML.html&gt;</span>
0097 <span class="comment">%  5/ Highlight, G. Flandin, in Matlab, 2003:</span>
0098 <span class="comment">%     &lt;http://www.artefact.tk/software/matlab/highlight/&gt;</span>
0099 <span class="comment">%  6/ mdoc, P. Brinkmann, in Matlab, 2003:</span>
0100 <span class="comment">%     &lt;http://www.math.uiuc.edu/~brinkman/software/mdoc/&gt;</span>
0101 <span class="comment">%  7/ Ocamaweb, Miriad Technologies, in Ocaml, 2002:</span>
0102 <span class="comment">%     &lt;http://ocamaweb.sourceforge.net/&gt;</span>
0103 <span class="comment">%  8/ Matdoc, M. Kaminsky, in Perl, 2003:</span>
0104 <span class="comment">%     &lt;http://www.mathworks.com/matlabcentral/fileexchange/loadFile.do?objectId=3498&gt;</span>
0105 <span class="comment">%  9/ Matlab itself, The Mathworks Inc, with HELPWIN, DOC and PUBLISH (R14)</span>
0106 
0107 <span class="comment">%-------------------------------------------------------------------------------</span>
0108 <span class="comment">%- Set up options and default parameters</span>
0109 <span class="comment">%-------------------------------------------------------------------------------</span>
0110 t0 = clock; <span class="comment">% for statistics</span>
0111 msgInvalidPair = <span class="string">'Bad value for argument: ''%s'''</span>;
0112 
0113 options = struct(<span class="string">'verbose'</span>, 1,<span class="keyword">...</span>
0114                  <span class="string">'mFiles'</span>, {{<span class="string">'.'</span>}},<span class="keyword">...</span>
0115                  <span class="string">'htmlDir'</span>, <span class="string">'doc'</span>,<span class="keyword">...</span>
0116                  <span class="string">'recursive'</span>, 0,<span class="keyword">...</span>
0117                  <span class="string">'source'</span>, 1,<span class="keyword">...</span>
0118                  <span class="string">'download'</span>,0,<span class="keyword">...</span>
0119                  <span class="string">'syntaxHighlighting'</span>, 1,<span class="keyword">...</span>
0120                  <span class="string">'tabs'</span>, 4,<span class="keyword">...</span>
0121                  <span class="string">'globalHypertextLinks'</span>, 0,<span class="keyword">...</span>
0122                  <span class="string">'graph'</span>, 0,<span class="keyword">...</span>
0123                  <span class="string">'todo'</span>, 0,<span class="keyword">...</span>
0124                  <span class="string">'load'</span>, 0,<span class="keyword">...</span>
0125                  <span class="string">'save'</span>, 0,<span class="keyword">...</span>
0126                  <span class="string">'search'</span>, 0,<span class="keyword">...</span>
0127                  <span class="string">'helptocxml'</span>, 0,<span class="keyword">...</span>
0128                  <span class="string">'indexFile'</span>, <span class="string">'index'</span>,<span class="keyword">...</span>
0129                  <span class="string">'extension'</span>, <span class="string">'.html'</span>,<span class="keyword">...</span>
0130                  <span class="string">'template'</span>, <span class="string">'blue'</span>,<span class="keyword">...</span>
0131                  <span class="string">'rootdir'</span>, pwd,<span class="keyword">...</span>
0132                  <span class="string">'language'</span>, <span class="string">'english'</span>);
0133 
0134 <span class="keyword">if</span> nargin == 1 &amp; isstruct(varargin{1})
0135     paramlist = [ fieldnames(varargin{1}) <span class="keyword">...</span>
0136                   struct2cell(varargin{1}) ]';
0137     paramlist = { paramlist{:} };
0138 <span class="keyword">else</span>
0139     <span class="keyword">if</span> mod(nargin,2)
0140         error(<span class="string">'Invalid parameter/value pair arguments.'</span>);
0141     <span class="keyword">end</span>
0142     paramlist = varargin;
0143 <span class="keyword">end</span>
0144 
0145 optionsnames = lower(fieldnames(options));
0146 <span class="keyword">for</span> i=1:2:length(paramlist)
0147     pname = paramlist{i};
0148     pvalue = paramlist{i+1};
0149     ind = strmatch(lower(pname),optionsnames);
0150     <span class="keyword">if</span> isempty(ind)
0151         error([<span class="string">'Invalid parameter: '''</span> pname <span class="string">'''.'</span>]);
0152     <span class="keyword">elseif</span> length(ind) &gt; 1
0153         error([<span class="string">'Ambiguous parameter: '''</span> pname <span class="string">'''.'</span>]);
0154     <span class="keyword">end</span>
0155     <span class="keyword">switch</span>(optionsnames{ind})
0156         <span class="keyword">case</span> <span class="string">'verbose'</span>
0157             <span class="keyword">if</span> strcmpi(pvalue,<span class="string">'on'</span>)
0158                 options.verbose = 1;
0159             <span class="keyword">elseif</span> strcmpi(pvalue,<span class="string">'off'</span>)
0160                 options.verbose = 0;
0161             <span class="keyword">else</span>
0162                 error(sprintf(msgInvalidPair,pname));
0163             <span class="keyword">end</span>
0164         <span class="keyword">case</span> <span class="string">'mfiles'</span>
0165             <span class="keyword">if</span> iscellstr(pvalue)
0166                 options.mFiles = pvalue;
0167             <span class="keyword">elseif</span> ischar(pvalue)
0168                 options.mFiles = cellstr(pvalue);
0169             <span class="keyword">else</span>
0170                 error(sprintf(msgInvalidPair,pname));
0171             <span class="keyword">end</span>
0172             options.load = 0;
0173         <span class="keyword">case</span> <span class="string">'htmldir'</span>
0174             <span class="keyword">if</span> ischar(pvalue)
0175                 <span class="keyword">if</span> isempty(pvalue),
0176                     options.htmlDir = <span class="string">'.'</span>;
0177                 <span class="keyword">else</span>
0178                     options.htmlDir = pvalue;
0179                 <span class="keyword">end</span>
0180             <span class="keyword">else</span>
0181                 error(sprintf(msgInvalidPair,pname));
0182             <span class="keyword">end</span>
0183         <span class="keyword">case</span> <span class="string">'recursive'</span>
0184             <span class="keyword">if</span> strcmpi(pvalue,<span class="string">'on'</span>)
0185                 options.recursive = 1;
0186             <span class="keyword">elseif</span> strcmpi(pvalue,<span class="string">'off'</span>)
0187                 options.recursive = 0;
0188             <span class="keyword">else</span>
0189                 error(sprintf(msgInvalidPair,pname));
0190             <span class="keyword">end</span>
0191             options.load = 0;
0192         <span class="keyword">case</span> <span class="string">'source'</span>
0193             <span class="keyword">if</span> strcmpi(pvalue,<span class="string">'on'</span>)
0194                 options.source = 1;
0195             <span class="keyword">elseif</span> strcmpi(pvalue,<span class="string">'off'</span>)
0196                 options.source = 0;
0197             <span class="keyword">else</span>
0198                 error(sprintf(msgInvalidPair,pname));
0199             <span class="keyword">end</span>
0200         <span class="keyword">case</span> <span class="string">'download'</span>
0201             <span class="keyword">if</span> strcmpi(pvalue,<span class="string">'on'</span>)
0202                 options.download = 1;
0203             <span class="keyword">elseif</span> strcmpi(pvalue,<span class="string">'off'</span>)
0204                 options.download = 0;
0205             <span class="keyword">else</span>
0206                 error(sprintf(msgInvalidPair,pname));
0207             <span class="keyword">end</span>
0208         <span class="keyword">case</span> <span class="string">'syntaxhighlighting'</span>
0209             <span class="keyword">if</span> strcmpi(pvalue,<span class="string">'on'</span>)
0210                 options.syntaxHighlighting = 1;
0211             <span class="keyword">elseif</span> strcmpi(pvalue,<span class="string">'off'</span>)
0212                 options.syntaxHighlighting = 0;
0213             <span class="keyword">else</span>
0214                 error(sprintf(msgInvalidPair,pname));
0215             <span class="keyword">end</span>
0216         <span class="keyword">case</span> <span class="string">'tabs'</span>
0217             <span class="keyword">if</span> pvalue &gt;= 0
0218                 options.tabs = pvalue;
0219             <span class="keyword">else</span>
0220                 error(sprintf(msgInvalidPair,pname));
0221             <span class="keyword">end</span>
0222         <span class="keyword">case</span> <span class="string">'globalhypertextlinks'</span>
0223             <span class="keyword">if</span> strcmpi(pvalue,<span class="string">'on'</span>)
0224                 options.globalHypertextLinks = 1;
0225             <span class="keyword">elseif</span> strcmpi(pvalue,<span class="string">'off'</span>)
0226                 options.globalHypertextLinks = 0;
0227             <span class="keyword">else</span>
0228                 error(sprintf(msgInvalidPair,pname));
0229             <span class="keyword">end</span>
0230             options.load = 0;
0231         <span class="keyword">case</span> <span class="string">'graph'</span>
0232             <span class="keyword">if</span> strcmpi(pvalue,<span class="string">'on'</span>)
0233                 options.graph = 1;
0234             <span class="keyword">elseif</span> strcmpi(pvalue,<span class="string">'off'</span>)
0235                 options.graph = 0;
0236             <span class="keyword">else</span>
0237                 error(sprintf(msgInvalidPair,pname));
0238             <span class="keyword">end</span>
0239         <span class="keyword">case</span> <span class="string">'todo'</span>
0240             <span class="keyword">if</span> strcmpi(pvalue,<span class="string">'on'</span>)
0241                 options.todo = 1;
0242             <span class="keyword">elseif</span> strcmpi(pvalue,<span class="string">'off'</span>)
0243                 options.todo = 0;
0244             <span class="keyword">else</span>
0245                 error(sprintf(msgInvalidPair,pname));
0246             <span class="keyword">end</span>
0247         <span class="keyword">case</span> <span class="string">'load'</span>
0248             <span class="keyword">if</span> ischar(pvalue)
0249                 <span class="keyword">if</span> exist(pvalue) == 7 <span class="comment">% directory provided</span>
0250                     pvalue = fullfile(pvalue,<span class="string">'m2html.mat'</span>);
0251                 <span class="keyword">end</span>         
0252                 <span class="keyword">try</span>
0253                     load(pvalue);
0254                 <span class="keyword">catch</span>
0255                     error(sprintf(<span class="string">'Unable to load %s.'</span>, pvalue));
0256                 <span class="keyword">end</span>
0257                 options.load = 1;
0258                 [dummy options.template] = fileparts(options.template);
0259             <span class="keyword">else</span>
0260                 error(sprintf(msgInvalidPair,pname));
0261             <span class="keyword">end</span>
0262         <span class="keyword">case</span> <span class="string">'save'</span>
0263             <span class="keyword">if</span> strcmpi(pvalue,<span class="string">'on'</span>)
0264                 options.save = 1;
0265             <span class="keyword">elseif</span> strcmpi(pvalue,<span class="string">'off'</span>)
0266                 options.save = 0;
0267             <span class="keyword">else</span>
0268                 error(sprintf(msgInvalidPair,pname));
0269             <span class="keyword">end</span>
0270         <span class="keyword">case</span> <span class="string">'search'</span>
0271             <span class="keyword">if</span> strcmpi(pvalue,<span class="string">'on'</span>)
0272                 options.search = 1;
0273             <span class="keyword">elseif</span> strcmpi(pvalue,<span class="string">'off'</span>)
0274                 options.search = 0;
0275             <span class="keyword">else</span>
0276                 error(sprintf(msgInvalidPair,pname));
0277             <span class="keyword">end</span>
0278         <span class="keyword">case</span> <span class="string">'helptocxml'</span>
0279             <span class="keyword">if</span> strcmpi(pvalue,<span class="string">'on'</span>)
0280                 options.helptocxml = 1;
0281             <span class="keyword">elseif</span> strcmpi(pvalue,<span class="string">'off'</span>)
0282                 options.helptocxml = 0;
0283             <span class="keyword">else</span>
0284                 error(sprintf(msgInvalidPair,pname));
0285             <span class="keyword">end</span>
0286         <span class="keyword">case</span> <span class="string">'indexfile'</span>
0287             <span class="keyword">if</span> ischar(pvalue)
0288                 options.indexFile = pvalue;
0289             <span class="keyword">else</span>
0290                 error(sprintf(msgInvalidPair,pname));
0291             <span class="keyword">end</span>
0292         <span class="keyword">case</span> <span class="string">'extension'</span>
0293             <span class="keyword">if</span> ischar(pvalue) &amp; pvalue(1) == <span class="string">'.'</span>
0294                 options.extension = pvalue;
0295             <span class="keyword">else</span>
0296                 error(sprintf(msgInvalidPair,pname));
0297             <span class="keyword">end</span>
0298         <span class="keyword">case</span> <span class="string">'template'</span>
0299             <span class="keyword">if</span> ischar(pvalue)
0300                 options.template = pvalue;
0301             <span class="keyword">else</span>
0302                 error(sprintf(msgInvalidPair,pname));
0303             <span class="keyword">end</span>
0304         <span class="keyword">case</span> <span class="string">'language'</span>
0305             <span class="keyword">if</span> ischar(pvalue)
0306                 options.language = pvalue;
0307             <span class="keyword">else</span>
0308                 error(sprintf(msgInvalidPair,pname));
0309             <span class="keyword">end</span>
0310         <span class="keyword">otherwise</span>
0311             error([<span class="string">'Invalid parameter: '''</span> pname <span class="string">'''.'</span>]);
0312     <span class="keyword">end</span>
0313 <span class="keyword">end</span>
0314 
0315 <span class="comment">%-------------------------------------------------------------------------------</span>
0316 <span class="comment">%- Get template files location</span>
0317 <span class="comment">%-------------------------------------------------------------------------------</span>
0318 s = fileparts(which(mfilename));
0319 options.template = fullfile(s,<span class="string">'templates'</span>,options.template);
0320 <span class="keyword">if</span> exist(options.template) ~= 7
0321     error(<span class="string">'[Template] Unknown template.'</span>);
0322 <span class="keyword">end</span>
0323 
0324 <span class="comment">%-------------------------------------------------------------------------------</span>
0325 <span class="comment">%- Get list of M-files</span>
0326 <span class="comment">%-------------------------------------------------------------------------------</span>
0327 <span class="keyword">if</span> ~options.load
0328     <span class="keyword">if</span> strcmp(options.mFiles,<span class="string">'.'</span>)
0329         d = dir(pwd); d = {d([d.isdir]).name};
0330         options.mFiles = {d{~ismember(d,{<span class="string">'.'</span> <span class="string">'..'</span>})}};
0331     <span class="keyword">end</span>
0332     mfiles = <a href="#_sub1" class="code" title="subfunction mfiles = getmfiles(mdirs, mfiles, recursive)">getmfiles</a>(options.mFiles,{},options.recursive);
0333     <span class="keyword">if</span> ~length(mfiles), fprintf(<span class="string">'Nothing to be done.\n'</span>); <span class="keyword">return</span>; <span class="keyword">end</span>
0334     <span class="keyword">if</span> options.verbose,
0335         fprintf(<span class="string">'Found %d M-files.\n'</span>,length(mfiles));
0336     <span class="keyword">end</span>
0337     mfiles = sort(mfiles); <span class="comment">% sort list of M-files in dictionary order</span>
0338 <span class="keyword">end</span>
0339 
0340 <span class="comment">%-------------------------------------------------------------------------------</span>
0341 <span class="comment">%- Get list of (unique) directories and (unique) names</span>
0342 <span class="comment">%-------------------------------------------------------------------------------</span>
0343 <span class="keyword">if</span> ~options.load
0344     mdirs = {};
0345     names = {};
0346     <span class="keyword">for</span> i=1:length(mfiles)
0347         [mdirs{i}, names{i}] = fileparts(mfiles{i});
0348         <span class="keyword">if</span> isempty(mdirs{i}), mdirs{i} = <span class="string">'.'</span>; <span class="keyword">end</span>
0349     <span class="keyword">end</span>
0350 
0351     mdir = unique(mdirs);
0352     <span class="keyword">if</span> options.verbose,
0353         fprintf(<span class="string">'Found %d unique Matlab directories.\n'</span>,length(mdir));
0354     <span class="keyword">end</span>
0355 
0356     name = names;
0357     <span class="comment">%name = unique(names); % output is sorted</span>
0358     <span class="comment">%if options.verbose,</span>
0359     <span class="comment">%    fprintf('Found %d unique Matlab files.\n',length(name));</span>
0360     <span class="comment">%end</span>
0361 <span class="keyword">end</span>
0362 
0363 <span class="comment">%-------------------------------------------------------------------------------</span>
0364 <span class="comment">%- Create output directory, if necessary</span>
0365 <span class="comment">%-------------------------------------------------------------------------------</span>
0366 <span class="keyword">if</span> isempty(dir(options.htmlDir))                                               
0367     <span class="comment">%- Create the top level output directory</span>
0368     <span class="keyword">if</span> options.verbose                                                         
0369         fprintf(<span class="string">'Creating directory %s...\n'</span>,options.htmlDir);                 
0370     <span class="keyword">end</span>                                                                        
0371     <span class="keyword">if</span> options.htmlDir(end) == filesep,                                        
0372         options.htmlDir(end) = [];                                             
0373     <span class="keyword">end</span>                                                                        
0374     [pathdir, namedir] = fileparts(options.htmlDir);                           
0375     <span class="keyword">if</span> isempty(pathdir)                                                        
0376         [status, msg] = mkdir(<a href="#_sub7" class="code" title="subfunction str = escapeblank(str)">escapeblank</a>(namedir));                                        
0377     <span class="keyword">else</span>                                                                       
0378         [status, msg] = mkdir(<a href="#_sub7" class="code" title="subfunction str = escapeblank(str)">escapeblank</a>(pathdir), <a href="#_sub7" class="code" title="subfunction str = escapeblank(str)">escapeblank</a>(namedir));                               
0379     <span class="keyword">end</span>                                                                        
0380     <span class="keyword">if</span> ~status, error(msg); <span class="keyword">end</span>                                                                
0381 <span class="keyword">end</span>                                                                            
0382 
0383 <span class="comment">%-------------------------------------------------------------------------------</span>
0384 <span class="comment">%- Get synopsis, H1 line, script/function, subroutines, cross-references, todo</span>
0385 <span class="comment">%-------------------------------------------------------------------------------</span>
0386 <span class="keyword">if</span> ~options.load
0387     synopsis   = cell(size(mfiles));
0388     h1line     = cell(size(mfiles));
0389     subroutine = cell(size(mfiles));
0390     hrefs      = sparse(length(mfiles), length(mfiles));
0391     todo       = struct(<span class="string">'mfile'</span>,[], <span class="string">'line'</span>,[], <span class="string">'comment'</span>,{{}});
0392     ismex      = zeros(length(mfiles), length(mexexts));
0393     statlist   = {};
0394     statinfo   = sparse(1,length(mfiles));
0395     kw         = cell(size(mfiles));
0396     freq       = cell(size(mfiles));
0397 
0398     <span class="keyword">for</span> i=1:length(mfiles)
0399         <span class="keyword">if</span> options.verbose
0400             fprintf(<span class="string">'Processing file %s...'</span>,mfiles{i});
0401         <span class="keyword">end</span>
0402         s = mfileparse(mfiles{i}, mdirs, names, options);
0403         synopsis{i}   = s.synopsis;
0404         h1line{i}     = s.h1line;
0405         subroutine{i} = s.subroutine;
0406         hrefs(i,:)    = s.hrefs;
0407         todo.mfile    = [todo.mfile repmat(i,1,length(s.todo.line))];
0408         todo.line     = [todo.line s.todo.line];
0409         todo.comment  = {todo.comment{:} s.todo.comment{:}};
0410         ismex(i,:)    = s.ismex;
0411         <span class="keyword">if</span> options.search
0412             <span class="keyword">if</span> options.verbose, fprintf(<span class="string">'search...'</span>); <span class="keyword">end</span>
0413             [kw{i}, freq{i}] = searchindex(mfiles{i});
0414             statlist = union(statlist, kw{i});
0415         <span class="keyword">end</span>
0416         <span class="keyword">if</span> options.verbose, fprintf(<span class="string">'\n'</span>); <span class="keyword">end</span>
0417     <span class="keyword">end</span>
0418     hrefs = hrefs &gt; 0;
0419     <span class="keyword">if</span> options.search
0420         <span class="keyword">if</span> options.verbose
0421             fprintf(<span class="string">'Creating the search index...'</span>);
0422         <span class="keyword">end</span>
0423         statinfo = sparse(length(statlist),length(mfiles));
0424         <span class="keyword">for</span> i=1:length(mfiles)
0425             i1 = find(ismember(statlist, kw{i}));
0426             i2 = repmat(i,1,length(i1));
0427             <span class="keyword">if</span> ~isempty(i1)
0428                 statinfo(sub2ind(size(statinfo),i1,i2)) = freq{i};
0429             <span class="keyword">end</span>
0430             <span class="keyword">if</span> options.verbose, fprintf(<span class="string">'.'</span>); <span class="keyword">end</span>
0431         <span class="keyword">end</span>
0432         clear kw freq;
0433         <span class="keyword">if</span> options.verbose, fprintf(<span class="string">'\n'</span>); <span class="keyword">end</span>
0434     <span class="keyword">end</span>
0435 <span class="keyword">end</span>
0436 
0437 <span class="comment">%-------------------------------------------------------------------------------</span>
0438 <span class="comment">%- Save M-filenames and cross-references for further analysis</span>
0439 <span class="comment">%-------------------------------------------------------------------------------</span>
0440 matfilesave = <span class="string">'m2html.mat'</span>;
0441 
0442 <span class="keyword">if</span> options.save
0443     <span class="keyword">if</span> options.verbose
0444         fprintf(<span class="string">'Saving MAT file %s...\n'</span>,matfilesave);
0445     <span class="keyword">end</span>
0446     save(fullfile(options.htmlDir,matfilesave), <span class="keyword">...</span>
0447         <span class="string">'mfiles'</span>, <span class="string">'names'</span>, <span class="string">'mdirs'</span>, <span class="string">'name'</span>, <span class="string">'mdir'</span>, <span class="string">'options'</span>, <span class="keyword">...</span>
0448         <span class="string">'hrefs'</span>, <span class="string">'synopsis'</span>, <span class="string">'h1line'</span>, <span class="string">'subroutine'</span>, <span class="string">'todo'</span>, <span class="string">'ismex'</span>, <span class="keyword">...</span>
0449         <span class="string">'statlist'</span>, <span class="string">'statinfo'</span>);
0450 <span class="keyword">end</span>
0451 
0452 <span class="comment">%-------------------------------------------------------------------------------</span>
0453 <span class="comment">%- Setup the output directories</span>
0454 <span class="comment">%-------------------------------------------------------------------------------</span>
0455 <span class="keyword">for</span> i=1:length(mdir)
0456     <span class="keyword">if</span> exist(fullfile(options.htmlDir,mdir{i})) ~= 7
0457         ldir = <a href="#_sub4" class="code" title="subfunction ldir = splitpath(p)">splitpath</a>(mdir{i});
0458         <span class="keyword">for</span> j=1:length(ldir)
0459             <span class="keyword">if</span> exist(fullfile(options.htmlDir,ldir{1:j})) ~= 7
0460                 <span class="comment">%- Create the output directory</span>
0461                 <span class="keyword">if</span> options.verbose
0462                     fprintf(<span class="string">'Creating directory %s...\n'</span>,<span class="keyword">...</span>
0463                             fullfile(options.htmlDir,ldir{1:j}));
0464                 <span class="keyword">end</span>
0465                 <span class="keyword">if</span> j == 1
0466                     [status, msg] = mkdir(<a href="#_sub7" class="code" title="subfunction str = escapeblank(str)">escapeblank</a>(options.htmlDir), <span class="keyword">...</span>
0467                         <a href="#_sub7" class="code" title="subfunction str = escapeblank(str)">escapeblank</a>(ldir{1}));
0468                 <span class="keyword">else</span>
0469                     [status, msg] = mkdir(<a href="#_sub7" class="code" title="subfunction str = escapeblank(str)">escapeblank</a>(options.htmlDir), <span class="keyword">...</span>
0470                         <a href="#_sub7" class="code" title="subfunction str = escapeblank(str)">escapeblank</a>(fullfile(ldir{1:j})));
0471                 <span class="keyword">end</span>
0472                 error(msg);
0473             <span class="keyword">end</span>
0474         <span class="keyword">end</span>
0475     <span class="keyword">end</span>
0476 <span class="keyword">end</span>
0477 
0478 <span class="comment">%-------------------------------------------------------------------------------</span>
0479 <span class="comment">%- Write the master index file</span>
0480 <span class="comment">%-------------------------------------------------------------------------------</span>
0481 tpl_master = <span class="string">'master.tpl'</span>;
0482 tpl_master_identifier_nbyline = 4;
0483 php_search = <span class="string">'search.php'</span>;
0484 dotbase = <span class="string">'graph'</span>;
0485 
0486 <span class="comment">%- Create the HTML template</span>
0487 tpl = template(options.template,<span class="string">'remove'</span>);
0488 tpl = set(tpl,<span class="string">'file'</span>,<span class="string">'TPL_MASTER'</span>,tpl_master);
0489 tpl = set(tpl,<span class="string">'block'</span>,<span class="string">'TPL_MASTER'</span>,<span class="string">'rowdir'</span>,<span class="string">'rowdirs'</span>);
0490 tpl = set(tpl,<span class="string">'block'</span>,<span class="string">'TPL_MASTER'</span>,<span class="string">'idrow'</span>,<span class="string">'idrows'</span>);
0491 tpl = set(tpl,<span class="string">'block'</span>,<span class="string">'idrow'</span>,<span class="string">'idcolumn'</span>,<span class="string">'idcolumns'</span>);
0492 tpl = set(tpl,<span class="string">'block'</span>,<span class="string">'TPL_MASTER'</span>,<span class="string">'search'</span>,<span class="string">'searchs'</span>);
0493 tpl = set(tpl,<span class="string">'block'</span>,<span class="string">'TPL_MASTER'</span>,<span class="string">'graph'</span>,<span class="string">'graphs'</span>);
0494 
0495 <span class="comment">%- Open for writing the HTML master index file</span>
0496 curfile = fullfile(options.htmlDir,[options.indexFile options.extension]);
0497 <span class="keyword">if</span> options.verbose
0498     fprintf(<span class="string">'Creating HTML file %s...\n'</span>,curfile);
0499 <span class="keyword">end</span>
0500 fid = openfile(curfile,<span class="string">'w'</span>);
0501 
0502 <span class="comment">%- Set some template variables</span>
0503 tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'DATE'</span>,[datestr(now,8) <span class="string">' '</span> datestr(now,1) <span class="string">' '</span> <span class="keyword">...</span>
0504                             datestr(now,13)]);
0505 tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'MASTERPATH'</span>, <span class="string">'./'</span>);
0506 tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'DIRS'</span>, sprintf(<span class="string">'%s '</span>,mdir{:}));
0507 
0508 <span class="comment">%- Print list of unique directories</span>
0509 <span class="keyword">for</span> i=1:length(mdir)
0510     tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'L_DIR'</span>,<span class="keyword">...</span>
0511               <a href="#_sub6" class="code" title="subfunction f = fullurl(varargin)">fullurl</a>(mdir{i},[options.indexFile options.extension]));
0512     tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'DIR'</span>,mdir{i});
0513     tpl = parse(tpl,<span class="string">'rowdirs'</span>,<span class="string">'rowdir'</span>,1);
0514 <span class="keyword">end</span>
0515 
0516 <span class="comment">%- Print full list of M-files (sorted by column)</span>
0517 [sortnames, ind] = sort(names);
0518 m_mod = mod(length(sortnames), tpl_master_identifier_nbyline);
0519 ind = [ind zeros(1,tpl_master_identifier_nbyline-m_mod)];
0520 m_floor = floor(length(ind) / tpl_master_identifier_nbyline);
0521 ind = reshape(ind,m_floor,tpl_master_identifier_nbyline)';
0522 
0523 <span class="keyword">for</span> i=1:prod(size(ind))
0524     <span class="keyword">if</span> ind(i)
0525         tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'L_IDNAME'</span>,<span class="keyword">...</span>
0526             <a href="#_sub6" class="code" title="subfunction f = fullurl(varargin)">fullurl</a>(mdirs{ind(i)},[names{ind(i)} options.extension]));
0527         tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'T_IDNAME'</span>,mdirs{ind(i)});
0528         tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'IDNAME'</span>,names{ind(i)});
0529         tpl = parse(tpl,<span class="string">'idcolumns'</span>,<span class="string">'idcolumn'</span>,1);
0530     <span class="keyword">else</span>
0531         tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'L_IDNAME'</span>,<span class="string">''</span>);
0532         tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'T_IDNAME'</span>,<span class="string">''</span>);
0533         tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'IDNAME'</span>,<span class="string">''</span>);
0534         tpl = parse(tpl,<span class="string">'idcolumns'</span>,<span class="string">'idcolumn'</span>,1);
0535     <span class="keyword">end</span>
0536     <span class="keyword">if</span> mod(i,tpl_master_identifier_nbyline) == 0
0537         tpl = parse(tpl,<span class="string">'idrows'</span>,<span class="string">'idrow'</span>,1);
0538         tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'idcolumns'</span>,<span class="string">''</span>);
0539     <span class="keyword">end</span>
0540 <span class="keyword">end</span>
0541 
0542 <span class="comment">%- Add a search form if necessary</span>
0543 tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'searchs'</span>,<span class="string">''</span>);
0544 <span class="keyword">if</span> options.search
0545     tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'PHPFILE'</span>,php_search);
0546     tpl = parse(tpl,<span class="string">'searchs'</span>,<span class="string">'search'</span>,1);
0547 <span class="keyword">end</span>
0548 
0549 <span class="comment">%- Link to a full dependency graph, if necessary</span>
0550 tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'graphs'</span>,<span class="string">''</span>);
0551 <span class="keyword">if</span> options.graph &amp; options.globalHypertextLinks &amp; length(mdir) &gt; 1
0552     tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'LGRAPH'</span>,[dotbase options.extension]);
0553     tpl = parse(tpl,<span class="string">'graphs'</span>,<span class="string">'graph'</span>,1);
0554 <span class="keyword">end</span>
0555 
0556 <span class="comment">%- Print the template in the HTML file</span>
0557 tpl = parse(tpl,<span class="string">'OUT'</span>,<span class="string">'TPL_MASTER'</span>);
0558 fprintf(fid,<span class="string">'%s'</span>,get(tpl,<span class="string">'OUT'</span>));
0559 fclose(fid);
0560 
0561 <span class="comment">%-------------------------------------------------------------------------------</span>
0562 <span class="comment">%- Copy template files (CSS, images, ...)</span>
0563 <span class="comment">%-------------------------------------------------------------------------------</span>
0564 <span class="comment">% Get list of files</span>
0565 d = dir(options.template);
0566 d = {d(~[d.isdir]).name};
0567 <span class="comment">% Copy files</span>
0568 <span class="keyword">for</span> i=1:length(d)
0569     [p, n, ext] = fileparts(d{i});
0570     <span class="keyword">if</span> ~strcmp(ext,<span class="string">'.tpl'</span>) <span class="keyword">...</span><span class="comment"> % do not copy .tpl files</span>
0571        &amp; ~strcmp([n ext],<span class="string">'Thumbs.db'</span>) <span class="comment">% do not copy this Windows generated file</span>
0572         <span class="keyword">if</span> isempty(dir(fullfile(options.htmlDir,d{i})))
0573             <span class="keyword">if</span> options.verbose
0574                 fprintf(<span class="string">'Copying template file %s...\n'</span>,d{i});
0575             <span class="keyword">end</span>
0576             <span class="comment">%- there is a bug with &lt;copyfile&gt; in Matlab 6.5 :</span>
0577             <span class="comment">%   http://www.mathworks.com/support/solutions/data/1-1B5JY.html</span>
0578             <span class="comment">%- and &lt;copyfile&gt; does not overwrite files even if newer...</span>
0579             [status, errmsg] = copyfile(fullfile(options.template,d{i}),<span class="keyword">...</span>
0580                                         options.htmlDir);
0581             <span class="comment">%- If you encounter this bug, please uncomment one of the following lines</span>
0582             <span class="comment">% eval(['!cp -rf ' fullfile(options.template,d{i}) ' ' options.htmlDir]);</span>
0583             <span class="comment">% eval(['!copy ' fullfile(options.template,d{i}) ' ' options.htmlDir]);</span>
0584             <span class="comment">% status = 1;</span>
0585             <span class="keyword">if</span> ~status
0586                 <span class="keyword">if</span> ~isempty(errmsg)
0587                     error(errmsg)
0588                 <span class="keyword">else</span>
0589                     warning(sprintf([<span class="string">'&lt;copyfile&gt; failed to do its job...\n'</span> <span class="keyword">...</span>
0590                 <span class="string">'This is a known bug in Matlab 6.5 (R13).\n'</span> <span class="keyword">...</span>
0591                 <span class="string">'See http://www.mathworks.com/support/solutions/data/1-1B5JY.html'</span>]));
0592                 <span class="keyword">end</span>
0593             <span class="keyword">end</span>
0594         <span class="keyword">end</span>
0595     <span class="keyword">end</span>
0596 <span class="keyword">end</span>
0597 
0598 <span class="comment">%-------------------------------------------------------------------------------</span>
0599 <span class="comment">%- Search engine (index file and PHP script)</span>
0600 <span class="comment">%-------------------------------------------------------------------------------</span>
0601 tpl_search = <span class="string">'search.tpl'</span>;
0602 idx_search = <span class="string">'search.idx'</span>;
0603 
0604 <span class="comment">% TODO % improving the fill in of 'statlist' and 'statinfo'</span>
0605 <span class="comment">% TODO % improving the search template file and update the CSS file</span>
0606 
0607 <span class="keyword">if</span> options.search
0608     <span class="comment">%- Write the search index file in output directory</span>
0609     <span class="keyword">if</span> options.verbose
0610         fprintf(<span class="string">'Creating Search Index file %s...\n'</span>, idx_search);
0611     <span class="keyword">end</span>
0612     docinfo = cell(length(mfiles),2);
0613     <span class="keyword">for</span> i=1:length(mfiles)
0614         docinfo{i,1} = h1line{i};
0615         docinfo{i,2} = <a href="#_sub6" class="code" title="subfunction f = fullurl(varargin)">fullurl</a>(mdirs{i}, [names{i} options.extension]);
0616     <span class="keyword">end</span>
0617     doxywrite(fullfile(options.htmlDir,idx_search),statlist,statinfo,docinfo);
0618     
0619     <span class="comment">%- Create the PHP template</span>
0620     tpl = template(options.template,<span class="string">'remove'</span>);
0621     tpl = set(tpl,<span class="string">'file'</span>,<span class="string">'TPL_SEARCH'</span>,tpl_search);
0622     
0623     <span class="comment">%- Open for writing the PHP search script</span>
0624     curfile = fullfile(options.htmlDir, php_search); 
0625     <span class="keyword">if</span> options.verbose
0626         fprintf(<span class="string">'Creating PHP script %s...\n'</span>,curfile);
0627     <span class="keyword">end</span>
0628     fid = openfile(curfile,<span class="string">'w'</span>);
0629     
0630     <span class="comment">%- Set template fields</span>
0631     tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'INDEX'</span>,[options.indexFile options.extension]);
0632     tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'MASTERPATH'</span>,<span class="string">'./'</span>);
0633     tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'DATE'</span>,[datestr(now,8) <span class="string">' '</span> datestr(now,1) <span class="string">' '</span> <span class="keyword">...</span>
0634                                 datestr(now,13)]);
0635     tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'IDXFILE'</span>,idx_search);
0636     tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'PHPFILE'</span>,php_search);
0637     
0638     <span class="comment">%- Print the template in the HTML file</span>
0639     tpl = parse(tpl,<span class="string">'OUT'</span>,<span class="string">'TPL_SEARCH'</span>);
0640     fprintf(fid,<span class="string">'%s'</span>,get(tpl,<span class="string">'OUT'</span>));
0641     fclose(fid);
0642 <span class="keyword">end</span>
0643 
0644 <span class="comment">%-------------------------------------------------------------------------------</span>
0645 <span class="comment">%- Create &lt;helptoc.xml&gt; needed to display hierarchical entries in Contents panel</span>
0646 <span class="comment">%-------------------------------------------------------------------------------</span>
0647 <span class="comment">% See http://www.mathworks.com/access/helpdesk/help/techdoc/matlab_env/guiref16.html</span>
0648 <span class="comment">% and http://www.mathworks.com/support/solutions/data/1-18U6Q.html?solution=1-18U6Q</span>
0649 
0650 <span class="comment">% TODO % display directories in TOC hierarchically instead of linearly</span>
0651 <span class="keyword">if</span> options.helptocxml
0652     curfile = fullfile(options.htmlDir, <span class="string">'helptoc.xml'</span>);
0653     <span class="keyword">if</span> options.verbose
0654         fprintf(<span class="string">'Creating XML Table-Of-Content %s...\n'</span>,curfile);
0655     <span class="keyword">end</span>
0656     fid = openfile(curfile,<span class="string">'w'</span>);
0657     fprintf(fid,<span class="string">'&lt;?xml version=''1.0'' encoding=''ISO-8859-1'' ?&gt;\n'</span>);
0658     fprintf(fid,<span class="string">'&lt;!-- $Date: %s $ --&gt;\n\n'</span>, datestr(now,31));
0659     fprintf(fid,<span class="string">'&lt;toc version=&quot;1.0&quot;&gt;\n\n'</span>);
0660     fprintf(fid,[<span class="string">'&lt;tocitem target=&quot;%s&quot; '</span>,<span class="keyword">...</span>
0661         <span class="string">'image=&quot;$toolbox/matlab/icons/book_mat.gif&quot;&gt;%s\n'</span>], <span class="keyword">...</span>
0662         [options.indexFile options.extension],<span class="string">'Toolbox'</span>);
0663     <span class="keyword">for</span> i=1:length(mdir)
0664         fprintf(fid,[<span class="string">'&lt;tocitem target=&quot;%s&quot; '</span>,<span class="keyword">...</span>
0665             <span class="string">'image=&quot;$toolbox/matlab/icons/reficon.gif&quot;&gt;%s\n'</span>], <span class="keyword">...</span>
0666             fullfile(mdir{i}, <span class="keyword">...</span>
0667                 [options.indexFile options.extension]),mdir{i});
0668         <span class="keyword">if</span> options.graph
0669             fprintf(fid,[<span class="string">'\t&lt;tocitem target=&quot;%s&quot; '</span>,<span class="keyword">...</span>
0670             <span class="string">'image=&quot;$toolbox/matlab/icons/simulinkicon.gif&quot;&gt;%s&lt;/tocitem&gt;\n'</span>], <span class="keyword">...</span>
0671                 fullfile(mdir{i},<span class="keyword">...</span>
0672                 [dotbase options.extension]),<span class="string">'Dependency Graph'</span>);
0673         <span class="keyword">end</span>
0674         <span class="keyword">if</span> options.todo
0675             <span class="keyword">if</span> ~isempty(intersect(find(strcmp(mdir{i},mdirs)),todo.mfile))
0676                 fprintf(fid,[<span class="string">'\t&lt;tocitem target=&quot;%s&quot; '</span>,<span class="keyword">...</span>
0677                 <span class="string">'image=&quot;$toolbox/matlab/icons/demoicon.gif&quot;&gt;%s&lt;/tocitem&gt;\n'</span>], <span class="keyword">...</span>
0678                     fullfile(mdir{i},<span class="keyword">...</span>
0679                     [<span class="string">'todo'</span> options.extension]),<span class="string">'Todo list'</span>);
0680             <span class="keyword">end</span>
0681         <span class="keyword">end</span>
0682         <span class="keyword">for</span> j=1:length(mdirs)
0683             <span class="keyword">if</span> strcmp(mdirs{j},mdir{i})
0684                 curfile = fullfile(mdir{i},<span class="keyword">...</span>
0685                     [names{j} options.extension]);
0686                 fprintf(fid,<span class="string">'\t&lt;tocitem target=&quot;%s&quot;&gt;%s&lt;/tocitem&gt;\n'</span>, <span class="keyword">...</span>
0687                     curfile,names{j});
0688             <span class="keyword">end</span>
0689         <span class="keyword">end</span>
0690         fprintf(fid,<span class="string">'&lt;/tocitem&gt;\n'</span>);
0691     <span class="keyword">end</span>
0692     fprintf(fid,<span class="string">'&lt;/tocitem&gt;\n'</span>);
0693     fprintf(fid,<span class="string">'\n&lt;/toc&gt;\n'</span>);
0694     fclose(fid);
0695 <span class="keyword">end</span>
0696 
0697 <span class="comment">%-------------------------------------------------------------------------------</span>
0698 <span class="comment">%- Write an index for each output directory</span>
0699 <span class="comment">%-------------------------------------------------------------------------------</span>
0700 tpl_mdir = <span class="string">'mdir.tpl'</span>;
0701 tpl_mdir_link = <span class="string">'&lt;a href=&quot;%s&quot;&gt;%s&lt;/a&gt;'</span>;
0702 <span class="comment">%dotbase defined earlier</span>
0703 
0704 <span class="comment">%- Create the HTML template</span>
0705 tpl = template(options.template,<span class="string">'remove'</span>);
0706 tpl = set(tpl,<span class="string">'file'</span>,<span class="string">'TPL_MDIR'</span>,tpl_mdir);
0707 tpl = set(tpl,<span class="string">'block'</span>,<span class="string">'TPL_MDIR'</span>,<span class="string">'row-m'</span>,<span class="string">'rows-m'</span>);
0708 tpl = set(tpl,<span class="string">'block'</span>,<span class="string">'row-m'</span>,<span class="string">'mexfile'</span>,<span class="string">'mex'</span>);
0709 tpl = set(tpl,<span class="string">'block'</span>,<span class="string">'TPL_MDIR'</span>,<span class="string">'othermatlab'</span>,<span class="string">'other'</span>);
0710 tpl = set(tpl,<span class="string">'block'</span>,<span class="string">'othermatlab'</span>,<span class="string">'row-other'</span>,<span class="string">'rows-other'</span>);
0711 tpl = set(tpl,<span class="string">'block'</span>,<span class="string">'TPL_MDIR'</span>,<span class="string">'subfolder'</span>,<span class="string">'subfold'</span>);
0712 tpl = set(tpl,<span class="string">'block'</span>,<span class="string">'subfolder'</span>,<span class="string">'subdir'</span>,<span class="string">'subdirs'</span>);
0713 tpl = set(tpl,<span class="string">'block'</span>,<span class="string">'TPL_MDIR'</span>,<span class="string">'todolist'</span>,<span class="string">'todolists'</span>);
0714 tpl = set(tpl,<span class="string">'block'</span>,<span class="string">'TPL_MDIR'</span>,<span class="string">'graph'</span>,<span class="string">'graphs'</span>);
0715 tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'DATE'</span>,[datestr(now,8) <span class="string">' '</span> datestr(now,1) <span class="string">' '</span> <span class="keyword">...</span>
0716                             datestr(now,13)]);
0717 
0718 <span class="keyword">for</span> i=1:length(mdir)
0719     <span class="comment">%- Open for writing each output directory index file</span>
0720     curfile = fullfile(options.htmlDir,mdir{i},<span class="keyword">...</span>
0721                        [options.indexFile options.extension]);
0722     <span class="keyword">if</span> options.verbose
0723         fprintf(<span class="string">'Creating HTML file %s...\n'</span>,curfile);
0724     <span class="keyword">end</span>
0725     fid = openfile(curfile,<span class="string">'w'</span>);
0726 
0727     <span class="comment">%- Set template fields</span>
0728     tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'INDEX'</span>,     [options.indexFile options.extension]);
0729     tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'MASTERPATH'</span>,<a href="#_sub3" class="code" title="subfunction s = backtomaster(mdir)">backtomaster</a>(mdir{i}));
0730     tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'MDIR'</span>,      mdir{i});
0731     
0732     <span class="comment">%- Display Matlab m-files, their H1 line and their Mex status</span>
0733     tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'rows-m'</span>,<span class="string">''</span>);
0734     <span class="keyword">for</span> j=1:length(mdirs)
0735         <span class="keyword">if</span> strcmp(mdirs{j},mdir{i})
0736             tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'L_NAME'</span>, [names{j} options.extension]);
0737             tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'NAME'</span>,   names{j});
0738             tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'H1LINE'</span>, h1line{j});
0739             <span class="keyword">if</span> any(ismex(j,:))
0740                 tpl = parse(tpl,<span class="string">'mex'</span>,<span class="string">'mexfile'</span>);
0741             <span class="keyword">else</span>
0742                 tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'mex'</span>,<span class="string">''</span>);
0743             <span class="keyword">end</span>
0744             tpl = parse(tpl,<span class="string">'rows-m'</span>,<span class="string">'row-m'</span>,1);
0745         <span class="keyword">end</span>
0746     <span class="keyword">end</span>
0747     
0748     <span class="comment">%- Display other Matlab-specific files (.mat,.mdl,.p)</span>
0749     tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'other'</span>,<span class="string">''</span>);
0750     tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'rows-other'</span>,<span class="string">''</span>);
0751     w = what(mdir{i}); w = w(1);
0752     w = {w.mat{:} w.mdl{:} w.p{:}};
0753     <span class="keyword">for</span> j=1:length(w)
0754         tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'OTHERFILE'</span>,w{j});
0755         tpl = parse(tpl,<span class="string">'rows-other'</span>,<span class="string">'row-other'</span>,1);
0756     <span class="keyword">end</span>
0757     <span class="keyword">if</span> ~isempty(w)
0758         tpl = parse(tpl,<span class="string">'other'</span>,<span class="string">'othermatlab'</span>);
0759     <span class="keyword">end</span>
0760     
0761     <span class="comment">%- Display subsequent directories and classes</span>
0762     tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'subdirs'</span>,<span class="string">''</span>);
0763     tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'subfold'</span>,<span class="string">''</span>);
0764     d = dir(mdir{i});
0765     d = {d([d.isdir]).name};
0766     d = {d{~ismember(d,{<span class="string">'.'</span> <span class="string">'..'</span>})}};
0767     <span class="keyword">for</span> j=1:length(d)
0768         <span class="keyword">if</span> ismember(fullfile(mdir{i},d{j}),mdir)
0769             tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'SUBDIRECTORY'</span>,<span class="keyword">...</span>
0770                 sprintf(tpl_mdir_link,<span class="keyword">...</span>
0771                 <a href="#_sub6" class="code" title="subfunction f = fullurl(varargin)">fullurl</a>(d{j},[options.indexFile options.extension]),d{j}));
0772         <span class="keyword">else</span>
0773             tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'SUBDIRECTORY'</span>,d{j});
0774         <span class="keyword">end</span>
0775         tpl = parse(tpl,<span class="string">'subdirs'</span>,<span class="string">'subdir'</span>,1);
0776     <span class="keyword">end</span>
0777     <span class="keyword">if</span> ~isempty(d)
0778         tpl = parse(tpl,<span class="string">'subfold'</span>,<span class="string">'subfolder'</span>);
0779     <span class="keyword">end</span>
0780     
0781     <span class="comment">%- Link to the TODO list if necessary</span>
0782     tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'todolists'</span>,<span class="string">''</span>);
0783     <span class="keyword">if</span> options.todo
0784         <span class="keyword">if</span> ~isempty(intersect(find(strcmp(mdir{i},mdirs)),todo.mfile))
0785             tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'LTODOLIST'</span>,[<span class="string">'todo'</span> options.extension]);
0786             tpl = parse(tpl,<span class="string">'todolists'</span>,<span class="string">'todolist'</span>,1);
0787         <span class="keyword">end</span>
0788     <span class="keyword">end</span>
0789     
0790     <span class="comment">%- Link to the dependency graph if necessary</span>
0791     tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'graphs'</span>,<span class="string">''</span>);
0792     <span class="keyword">if</span> options.graph
0793         tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'LGRAPH'</span>,[dotbase options.extension]);
0794         tpl = parse(tpl,<span class="string">'graphs'</span>,<span class="string">'graph'</span>,1);
0795     <span class="keyword">end</span>
0796     
0797     <span class="comment">%- Print the template in the HTML file</span>
0798     tpl = parse(tpl,<span class="string">'OUT'</span>,<span class="string">'TPL_MDIR'</span>);
0799     fprintf(fid,<span class="string">'%s'</span>,get(tpl,<span class="string">'OUT'</span>));
0800     fclose(fid);
0801 <span class="keyword">end</span>
0802 
0803 <span class="comment">%-------------------------------------------------------------------------------</span>
0804 <span class="comment">%- Write a TODO list file for each output directory, if necessary</span>
0805 <span class="comment">%-------------------------------------------------------------------------------</span>
0806 tpl_todo = <span class="string">'todo.tpl'</span>;
0807 
0808 <span class="keyword">if</span> options.todo
0809     <span class="comment">%- Create the HTML template</span>
0810     tpl = template(options.template,<span class="string">'remove'</span>);
0811     tpl = set(tpl,<span class="string">'file'</span>,<span class="string">'TPL_TODO'</span>,tpl_todo);
0812     tpl = set(tpl,<span class="string">'block'</span>,<span class="string">'TPL_TODO'</span>,<span class="string">'filelist'</span>,<span class="string">'filelists'</span>);
0813     tpl = set(tpl,<span class="string">'block'</span>,<span class="string">'filelist'</span>,<span class="string">'row'</span>,<span class="string">'rows'</span>);
0814     tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'DATE'</span>,[datestr(now,8) <span class="string">' '</span> datestr(now,1) <span class="string">' '</span> <span class="keyword">...</span>
0815                                 datestr(now,13)]);
0816 
0817     <span class="keyword">for</span> i=1:length(mdir)
0818         mfilestodo = intersect(find(strcmp(mdir{i},mdirs)),todo.mfile);
0819         <span class="keyword">if</span> ~isempty(mfilestodo)
0820             <span class="comment">%- Open for writing each TODO list file</span>
0821             curfile = fullfile(options.htmlDir,mdir{i},<span class="keyword">...</span>
0822                                [<span class="string">'todo'</span> options.extension]);
0823             <span class="keyword">if</span> options.verbose
0824                 fprintf(<span class="string">'Creating HTML file %s...\n'</span>,curfile);
0825             <span class="keyword">end</span>
0826             fid = openfile(curfile,<span class="string">'w'</span>);
0827             
0828             <span class="comment">%- Set template fields</span>
0829             tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'INDEX'</span>,[options.indexFile options.extension]);
0830             tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'MASTERPATH'</span>, <a href="#_sub3" class="code" title="subfunction s = backtomaster(mdir)">backtomaster</a>(mdir{i}));
0831             tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'MDIR'</span>,       mdir{i});
0832             tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'filelists'</span>,  <span class="string">''</span>);
0833     
0834             <span class="keyword">for</span> k=1:length(mfilestodo)
0835                 tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'MFILE'</span>,names{mfilestodo(k)});
0836                 tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'rows'</span>,<span class="string">''</span>);
0837                 nbtodo = find(todo.mfile == mfilestodo(k));
0838                 <span class="keyword">for</span> l=1:length(nbtodo)
0839                     tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'L_NBLINE'</span>,<span class="keyword">...</span>
0840                         [names{mfilestodo(k)} <span class="keyword">...</span>
0841                             options.extension <span class="keyword">...</span>
0842                             <span class="string">'#l'</span> num2str(todo.line(nbtodo(l)))]);
0843                     tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'NBLINE'</span>,num2str(todo.line(nbtodo(l))));
0844                     tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'COMMENT'</span>,todo.comment{nbtodo(l)});
0845                     tpl = parse(tpl,<span class="string">'rows'</span>,<span class="string">'row'</span>,1);
0846                 <span class="keyword">end</span>
0847                 tpl = parse(tpl,<span class="string">'filelists'</span>,<span class="string">'filelist'</span>,1);
0848             <span class="keyword">end</span>
0849     
0850             <span class="comment">%- Print the template in the HTML file</span>
0851             tpl = parse(tpl,<span class="string">'OUT'</span>,<span class="string">'TPL_TODO'</span>);
0852             fprintf(fid,<span class="string">'%s'</span>,get(tpl,<span class="string">'OUT'</span>));
0853             fclose(fid);
0854         <span class="keyword">end</span>
0855     <span class="keyword">end</span>
0856 <span class="keyword">end</span>
0857 
0858 <span class="comment">%-------------------------------------------------------------------------------</span>
0859 <span class="comment">%- Create dependency graphs using GraphViz, if requested</span>
0860 <span class="comment">%-------------------------------------------------------------------------------</span>
0861 tpl_graph = <span class="string">'graph.tpl'</span>;
0862 <span class="comment">% You may have to modify the following line with Matlab7 (R14) to specify</span>
0863 <span class="comment">% the full path to where GraphViz is installed</span>
0864 dot_exec  = <span class="string">'dot'</span>;
0865 <span class="comment">%dotbase defined earlier</span>
0866 
0867 <span class="keyword">if</span> options.graph
0868     <span class="comment">%- Create the HTML template</span>
0869     tpl = template(options.template,<span class="string">'remove'</span>);
0870     tpl = set(tpl,<span class="string">'file'</span>,<span class="string">'TPL_GRAPH'</span>,tpl_graph);
0871     tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'DATE'</span>,[datestr(now,8) <span class="string">' '</span> datestr(now,1) <span class="string">' '</span> <span class="keyword">...</span>
0872                                 datestr(now,13)]);
0873     
0874     <span class="comment">%- Create a full dependency graph for all directories if possible</span>
0875     <span class="keyword">if</span> options.globalHypertextLinks &amp; length(mdir) &gt; 1
0876         mdotfile = fullfile(options.htmlDir,[dotbase <span class="string">'.dot'</span>]);
0877         <span class="keyword">if</span> options.verbose
0878             fprintf(<span class="string">'Creating full dependency graph %s...'</span>,mdotfile);
0879         <span class="keyword">end</span>
0880         <a href="mdot.html" class="code" title="function mdot(mmat, dotfile,f)">mdot</a>({hrefs, names, options, mdirs}, mdotfile); <span class="comment">%mfiles</span>
0881         <a href="#_sub2" class="code" title="subfunction calldot(dotexec, mdotfile, mapfile, pngfile, opt)">calldot</a>(dot_exec, mdotfile, <span class="keyword">...</span>
0882                 fullfile(options.htmlDir,[dotbase <span class="string">'.map'</span>]), <span class="keyword">...</span>
0883                 fullfile(options.htmlDir,[dotbase <span class="string">'.png'</span>]));
0884         <span class="keyword">if</span> options.verbose, fprintf(<span class="string">'\n'</span>); <span class="keyword">end</span>
0885         fid = openfile(fullfile(options.htmlDir, [dotbase options.extension]),<span class="string">'w'</span>);
0886         tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'INDEX'</span>,[options.indexFile options.extension]);
0887         tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'MASTERPATH'</span>, <span class="string">'./'</span>);
0888         tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'MDIR'</span>,       <span class="string">'the whole toolbox'</span>);
0889         tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'GRAPH_IMG'</span>,  [dotbase <span class="string">'.png'</span>]);
0890         <span class="keyword">try</span> <span class="comment">% if &lt;dot&gt; failed...</span>
0891             fmap = openfile(fullfile(options.htmlDir,[dotbase <span class="string">'.map'</span>]),<span class="string">'r'</span>);
0892             tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'GRAPH_MAP'</span>,  fscanf(fmap,<span class="string">'%c'</span>));
0893             fclose(fmap);
0894         <span class="keyword">end</span>
0895         tpl = parse(tpl,<span class="string">'OUT'</span>,<span class="string">'TPL_GRAPH'</span>);
0896         fprintf(fid,<span class="string">'%s'</span>, get(tpl,<span class="string">'OUT'</span>));
0897         fclose(fid);
0898     <span class="keyword">end</span>
0899     
0900     <span class="comment">%- Create a dependency graph for each output directory</span>
0901     <span class="keyword">for</span> i=1:length(mdir)
0902         mdotfile = fullfile(options.htmlDir,mdir{i},[dotbase <span class="string">'.dot'</span>]);
0903         <span class="keyword">if</span> options.verbose
0904             fprintf(<span class="string">'Creating dependency graph %s...'</span>,mdotfile);
0905         <span class="keyword">end</span>
0906         ind = find(strcmp(mdirs,mdir{i}));
0907         href1 = zeros(length(ind),length(hrefs));
0908         <span class="keyword">for</span> j=1:length(hrefs), href1(:,j) = hrefs(ind,j); <span class="keyword">end</span>
0909         href2 = zeros(length(ind));
0910         <span class="keyword">for</span> j=1:length(ind), href2(j,:) = href1(j,ind); <span class="keyword">end</span>
0911         <a href="mdot.html" class="code" title="function mdot(mmat, dotfile,f)">mdot</a>({href2, {names{ind}}, options}, mdotfile); <span class="comment">%{mfiles{ind}}</span>
0912         <a href="#_sub2" class="code" title="subfunction calldot(dotexec, mdotfile, mapfile, pngfile, opt)">calldot</a>(dot_exec, mdotfile, <span class="keyword">...</span>
0913                 fullfile(options.htmlDir,mdir{i},[dotbase <span class="string">'.map'</span>]), <span class="keyword">...</span>
0914                 fullfile(options.htmlDir,mdir{i},[dotbase <span class="string">'.png'</span>]));
0915         <span class="keyword">if</span> options.verbose, fprintf(<span class="string">'\n'</span>); <span class="keyword">end</span>
0916         fid = openfile(fullfile(options.htmlDir,mdir{i},<span class="keyword">...</span>
0917             [dotbase options.extension]),<span class="string">'w'</span>);
0918         tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'INDEX'</span>,[options.indexFile options.extension]);
0919         tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'MASTERPATH'</span>, <a href="#_sub3" class="code" title="subfunction s = backtomaster(mdir)">backtomaster</a>(mdir{i}));
0920         tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'MDIR'</span>,       mdir{i});
0921         tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'GRAPH_IMG'</span>,  [dotbase <span class="string">'.png'</span>]);
0922         <span class="keyword">try</span> <span class="comment">% if &lt;dot&gt; failed, no '.map' file has been created</span>
0923             fmap = openfile(fullfile(options.htmlDir,mdir{i},[dotbase <span class="string">'.map'</span>]),<span class="string">'r'</span>);
0924             tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'GRAPH_MAP'</span>,  fscanf(fmap,<span class="string">'%c'</span>));
0925             fclose(fmap);
0926         <span class="keyword">end</span>
0927         tpl = parse(tpl,<span class="string">'OUT'</span>,<span class="string">'TPL_GRAPH'</span>);
0928         fprintf(fid,<span class="string">'%s'</span>, get(tpl,<span class="string">'OUT'</span>));
0929         fclose(fid);
0930     <span class="keyword">end</span>
0931 <span class="keyword">end</span>
0932 
0933 <span class="comment">%-------------------------------------------------------------------------------</span>
0934 <span class="comment">%- Write an HTML file for each M-file</span>
0935 <span class="comment">%-------------------------------------------------------------------------------</span>
0936 <span class="comment">%- List of Matlab keywords (output from iskeyword)</span>
0937 matlabKeywords = {<span class="string">'break'</span>, <span class="string">'case'</span>, <span class="string">'catch'</span>, <span class="string">'continue'</span>, <span class="string">'elseif'</span>, <span class="string">'else'</span>, <span class="keyword">...</span>
0938                   <span class="string">'end'</span>, <span class="string">'for'</span>, <span class="string">'function'</span>, <span class="string">'global'</span>, <span class="string">'if'</span>, <span class="string">'otherwise'</span>, <span class="keyword">...</span>
0939                   <span class="string">'persistent'</span>, <span class="string">'return'</span>, <span class="string">'switch'</span>, <span class="string">'try'</span>, <span class="string">'while'</span>};
0940                   <span class="comment">%'keyboard', 'pause', 'eps', 'NaN', 'Inf'</span>
0941 
0942 tpl_mfile = <span class="string">'mfile.tpl'</span>;
0943 
0944 tpl_mfile_code     = <span class="string">'&lt;a href=&quot;%s&quot; class=&quot;code&quot; title=&quot;%s&quot;&gt;%s&lt;/a&gt;'</span>;
0945 tpl_mfile_keyword  = <span class="string">'&lt;span class=&quot;keyword&quot;&gt;%s&lt;/span&gt;'</span>;
0946 tpl_mfile_comment  = <span class="string">'&lt;span class=&quot;comment&quot;&gt;%s&lt;/span&gt;'</span>;
0947 tpl_mfile_string   = <span class="string">'&lt;span class=&quot;string&quot;&gt;%s&lt;/span&gt;'</span>;
0948 tpl_mfile_aname    = <span class="string">'&lt;a name=&quot;%s&quot; href=&quot;#_subfunctions&quot; class=&quot;code&quot;&gt;%s&lt;/a&gt;'</span>;
0949 tpl_mfile_line     = <span class="string">'%04d %s\n'</span>;
0950 
0951 <span class="comment">%- Delimiters used in strtok: some of them may be useless (% &quot; .), removed '.'</span>
0952 strtok_delim = sprintf(<span class="string">' \t\n\r(){}[]&lt;&gt;+-*~!|\\@&amp;/,:;=&quot;''%%'</span>);
0953 
0954 <span class="comment">%- Create the HTML template</span>
0955 tpl = template(options.template,<span class="string">'remove'</span>);
0956 tpl = set(tpl,<span class="string">'file'</span>,<span class="string">'TPL_MFILE'</span>,tpl_mfile);
0957 tpl = set(tpl,<span class="string">'block'</span>,<span class="string">'TPL_MFILE'</span>,<span class="string">'pathline'</span>,<span class="string">'pl'</span>);
0958 tpl = set(tpl,<span class="string">'block'</span>,<span class="string">'TPL_MFILE'</span>,<span class="string">'mexfile'</span>,<span class="string">'mex'</span>);
0959 tpl = set(tpl,<span class="string">'block'</span>,<span class="string">'TPL_MFILE'</span>,<span class="string">'script'</span>,<span class="string">'scriptfile'</span>);
0960 tpl = set(tpl,<span class="string">'block'</span>,<span class="string">'TPL_MFILE'</span>,<span class="string">'crossrefcall'</span>,<span class="string">'crossrefcalls'</span>);
0961 tpl = set(tpl,<span class="string">'block'</span>,<span class="string">'TPL_MFILE'</span>,<span class="string">'crossrefcalled'</span>,<span class="string">'crossrefcalleds'</span>);
0962 tpl = set(tpl,<span class="string">'block'</span>,<span class="string">'TPL_MFILE'</span>,<span class="string">'subfunction'</span>,<span class="string">'subf'</span>);
0963 tpl = set(tpl,<span class="string">'block'</span>,<span class="string">'subfunction'</span>,<span class="string">'onesubfunction'</span>,<span class="string">'onesubf'</span>);
0964 tpl = set(tpl,<span class="string">'block'</span>,<span class="string">'TPL_MFILE'</span>,<span class="string">'source'</span>,<span class="string">'thesource'</span>);
0965 tpl = set(tpl,<span class="string">'block'</span>,<span class="string">'TPL_MFILE'</span>,<span class="string">'download'</span>,<span class="string">'downloads'</span>);
0966 tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'DATE'</span>,[datestr(now,8) <span class="string">' '</span> datestr(now,1) <span class="string">' '</span> <span class="keyword">...</span>
0967                             datestr(now,13)]);
0968 
0969 nblinetot = 0;
0970 <span class="keyword">for</span> i=1:length(mdir)
0971     <span class="keyword">for</span> j=1:length(mdirs)
0972         <span class="keyword">if</span> strcmp(mdirs{j},mdir{i})
0973         
0974             curfile = fullfile(options.htmlDir,mdir{i},<span class="keyword">...</span>
0975                                [names{j} options.extension]);
0976                                
0977             <span class="comment">%- Copy M-file for download, if necessary</span>
0978             <span class="keyword">if</span> options.download
0979                 <span class="keyword">if</span> options.verbose
0980                     fprintf(<span class="string">'Copying M-file %s.m to %s...\n'</span>,names{j},<span class="keyword">...</span>
0981                         fullfile(options.htmlDir,mdir{i}));
0982                 <span class="keyword">end</span>
0983                 [status, errmsg] = copyfile(mfiles{j},<span class="keyword">...</span>
0984                     fullfile(options.htmlDir,mdir{i}));
0985                 error(errmsg);
0986             <span class="keyword">end</span>
0987             
0988             <span class="comment">%- Open for writing the HTML file</span>
0989             <span class="keyword">if</span> options.verbose
0990                 fprintf(<span class="string">'Creating HTML file %s...\n'</span>,curfile);
0991             <span class="keyword">end</span>
0992             fid = openfile(curfile,<span class="string">'w'</span>);
0993             <span class="keyword">if</span> strcmp(names{j},options.indexFile)
0994                 fprintf([<span class="string">'Warning: HTML index file %s will be '</span> <span class="keyword">...</span>
0995                         <span class="string">'overwritten by Matlab function %s.\n'</span>], <span class="keyword">...</span>
0996                         [options.indexFile options.extension], mfiles{j});
0997             <span class="keyword">end</span>
0998             
0999             <span class="comment">%- Open for reading the M-file</span>
1000             fid2 = openfile(mfiles{j},<span class="string">'r'</span>);
1001             
1002             <span class="comment">%- Set some template fields</span>
1003             tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'INDEX'</span>, [options.indexFile options.extension]);
1004             tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'MASTERPATH'</span>,       <a href="#_sub3" class="code" title="subfunction s = backtomaster(mdir)">backtomaster</a>(mdir{i}));
1005             tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'MDIR'</span>,             mdirs{j});
1006             tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'NAME'</span>,             names{j});
1007             tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'H1LINE'</span>,           <a href="#_sub8" class="code" title="subfunction str = entity(str)">entity</a>(h1line{j}));
1008             tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'scriptfile'</span>,       <span class="string">''</span>);
1009             <span class="keyword">if</span> isempty(synopsis{j})
1010                 tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'SYNOPSIS'</span>,get(tpl,<span class="string">'var'</span>,<span class="string">'script'</span>));
1011             <span class="keyword">else</span>
1012                 tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'SYNOPSIS'</span>, synopsis{j});
1013             <span class="keyword">end</span>
1014             s = <a href="#_sub4" class="code" title="subfunction ldir = splitpath(p)">splitpath</a>(mdir{i});
1015             tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'pl'</span>,<span class="string">''</span>);
1016             <span class="keyword">for</span> k=1:length(s)
1017                 c = cell(1,k); <span class="keyword">for</span> l=1:k, c{l} = filesep; <span class="keyword">end</span>
1018                 cpath = {s{1:k};c{:}}; cpath = [cpath{:}];
1019                 <span class="keyword">if</span> ~isempty(cpath), cpath = cpath(1:end-1); <span class="keyword">end</span>
1020                 <span class="keyword">if</span> ismember(cpath,mdir)
1021                     tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'LPATHDIR'</span>,[repmat(<span class="string">'../'</span>,<span class="keyword">...</span>
1022                         1,length(s)-k) options.indexFile options.extension]);
1023                 <span class="keyword">else</span>
1024                     tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'LPATHDIR'</span>,<span class="string">'#'</span>);
1025                 <span class="keyword">end</span>
1026                 tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'PATHDIR'</span>,s{k});
1027                 tpl = parse(tpl,<span class="string">'pl'</span>,<span class="string">'pathline'</span>,1);
1028             <span class="keyword">end</span>
1029             
1030             <span class="comment">%- Handle mex files</span>
1031             tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'mex'</span>, <span class="string">''</span>);
1032             samename = dir(fullfile(mdir{i},[names{j}    <span class="string">'.*'</span>]));
1033             samename = {samename.name};
1034             tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'MEXTYPE'</span>, <span class="string">'mex'</span>);
1035             <span class="keyword">for</span> k=1:length(samename)
1036                 [dummy, dummy, ext] = fileparts(samename{k});
1037                 <span class="keyword">switch</span> ext
1038                     <span class="keyword">case</span> <span class="string">'.c'</span>
1039                         tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'MEXTYPE'</span>, <span class="string">'c'</span>);
1040                     <span class="keyword">case</span> {<span class="string">'.cpp'</span> <span class="string">'.c++'</span> <span class="string">'.cxx'</span> <span class="string">'.C'</span>}
1041                         tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'MEXTYPE'</span>, <span class="string">'c++'</span>);
1042                     <span class="keyword">case</span> {<span class="string">'.for'</span> <span class="string">'.f'</span> <span class="string">'.FOR'</span> <span class="string">'.F'</span>}
1043                         tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'MEXTYPE'</span>, <span class="string">'fortran'</span>);
1044                     <span class="keyword">otherwise</span>
1045                         <span class="comment">%- Unknown mex file source</span>
1046                 <span class="keyword">end</span>
1047             <span class="keyword">end</span>
1048             [exts, platform] = mexexts;
1049             mexplatforms = sprintf(<span class="string">'%s, '</span>,platform{find(ismex(j,:))});
1050             <span class="keyword">if</span> ~isempty(mexplatforms)
1051                 tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'PLATFORMS'</span>, mexplatforms(1:end-2));
1052                 tpl = parse(tpl,<span class="string">'mex'</span>,<span class="string">'mexfile'</span>);
1053             <span class="keyword">end</span>
1054             
1055             <span class="comment">%- Set description template field</span>
1056             descr = <span class="string">''</span>;
1057             flagsynopcont = 0;
1058             flag_seealso  = 0;
1059             <span class="keyword">while</span> 1
1060                 tline = fgets(fid2);
1061                 <span class="keyword">if</span> ~ischar(tline), <span class="keyword">break</span>, <span class="keyword">end</span>
1062                 tline = <a href="#_sub8" class="code" title="subfunction str = entity(str)">entity</a>(fliplr(deblank(fliplr(tline))));
1063                 <span class="comment">%- Synopsis line</span>
1064                 <span class="keyword">if</span> ~isempty(strmatch(<span class="string">'function'</span>,tline))
1065                     <span class="keyword">if</span> ~isempty(strmatch(<span class="string">'...'</span>,fliplr(deblank(tline))))
1066                         flagsynopcont = 1;
1067                     <span class="keyword">end</span>
1068                 <span class="comment">%- H1 line and description</span>
1069                 <span class="keyword">elseif</span> ~isempty(strmatch(<span class="string">'%'</span>,tline))
1070                     <span class="comment">%- Hypertext links on the &quot;See also&quot; line</span>
1071                     ind = findstr(lower(tline),<span class="string">'see also'</span>);
1072                     <span class="keyword">if</span> ~isempty(ind) | flag_seealso
1073                         <span class="comment">%- &quot;See also&quot; only in files in the same directory</span>
1074                         indsamedir = find(strcmp(mdirs{j},mdirs));
1075                         hrefnames = {names{indsamedir}};
1076                         r = deblank(tline);
1077                         flag_seealso = 1; <span class="comment">%(r(end) == ',');</span>
1078                         tline = <span class="string">''</span>;
1079                         <span class="keyword">while</span> 1
1080                             [t,r,q] = strtok(r,sprintf(<span class="string">' \t\n\r.,;%%'</span>));
1081                             tline = [tline q];
1082                             <span class="keyword">if</span> isempty(t), <span class="keyword">break</span>, <span class="keyword">end</span>;
1083                             ii = strcmpi(hrefnames,t);
1084                             <span class="keyword">if</span> any(ii)
1085                                 jj = find(ii);
1086                                 tline = [tline sprintf(tpl_mfile_code,<span class="keyword">...</span>
1087                                     [hrefnames{jj(1)} options.extension],<span class="keyword">...</span>
1088                                     synopsis{indsamedir(jj(1))},t)];
1089                             <span class="keyword">else</span>
1090                                 tline = [tline t];
1091                             <span class="keyword">end</span>
1092                         <span class="keyword">end</span>
1093                         tline = sprintf(<span class="string">'%s\n'</span>,tline);
1094                     <span class="keyword">end</span>
1095                     descr = [descr tline(2:end)];
1096                 <span class="keyword">elseif</span> isempty(tline)
1097                     <span class="keyword">if</span> ~isempty(descr), <span class="keyword">break</span>, <span class="keyword">end</span>;
1098                 <span class="keyword">else</span>
1099                     <span class="keyword">if</span> flagsynopcont
1100                         <span class="keyword">if</span> isempty(strmatch(<span class="string">'...'</span>,fliplr(deblank(tline))))
1101                             flagsynopcont = 0;
1102                         <span class="keyword">end</span>
1103                     <span class="keyword">else</span>
1104                         <span class="keyword">break</span>;
1105                     <span class="keyword">end</span>
1106                 <span class="keyword">end</span>
1107             <span class="keyword">end</span>
1108             tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'DESCRIPTION'</span>,<span class="keyword">...</span>
1109                 <a href="#_sub9" class="code" title="subfunction str = horztab(str,n)">horztab</a>(descr,options.tabs));
1110             
1111             <span class="comment">%- Set cross-references template fields:</span>
1112             <span class="comment">%  Function called</span>
1113             ind = find(hrefs(j,:) == 1);
1114             tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'crossrefcalls'</span>,<span class="string">''</span>);
1115             <span class="keyword">for</span> k=1:length(ind)
1116                 <span class="keyword">if</span> strcmp(mdirs{j},mdirs{ind(k)})
1117                     tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'L_NAME_CALL'</span>, <span class="keyword">...</span>
1118                         [names{ind(k)} options.extension]);
1119                 <span class="keyword">else</span>
1120                     tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'L_NAME_CALL'</span>, <span class="keyword">...</span>
1121                               <a href="#_sub6" class="code" title="subfunction f = fullurl(varargin)">fullurl</a>(<a href="#_sub3" class="code" title="subfunction s = backtomaster(mdir)">backtomaster</a>(mdirs{j}), <span class="keyword">...</span>
1122                                          mdirs{ind(k)}, <span class="keyword">...</span>
1123                                        [names{ind(k)} options.extension]));
1124                 <span class="keyword">end</span>
1125                 tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'SYNOP_CALL'</span>,   synopsis{ind(k)});
1126                 tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'NAME_CALL'</span>,   names{ind(k)});
1127                 tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'H1LINE_CALL'</span>, h1line{ind(k)});
1128                 tpl = parse(tpl,<span class="string">'crossrefcalls'</span>,<span class="string">'crossrefcall'</span>,1);
1129             <span class="keyword">end</span>
1130             <span class="comment">%  Callers</span>
1131             ind = find(hrefs(:,j) == 1);
1132             tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'crossrefcalleds'</span>,<span class="string">''</span>);
1133             <span class="keyword">for</span> k=1:length(ind)
1134                 <span class="keyword">if</span> strcmp(mdirs{j},mdirs{ind(k)})
1135                     tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'L_NAME_CALLED'</span>, <span class="keyword">...</span>
1136                         [names{ind(k)} options.extension]);
1137                 <span class="keyword">else</span>
1138                     tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'L_NAME_CALLED'</span>, <span class="keyword">...</span>
1139                         <a href="#_sub6" class="code" title="subfunction f = fullurl(varargin)">fullurl</a>(<a href="#_sub3" class="code" title="subfunction s = backtomaster(mdir)">backtomaster</a>(mdirs{j}),<span class="keyword">...</span>
1140                             mdirs{ind(k)}, <span class="keyword">...</span>
1141                             [names{ind(k)} options.extension]));
1142                 <span class="keyword">end</span>
1143                 tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'SYNOP_CALLED'</span>,   synopsis{ind(k)});
1144                 tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'NAME_CALLED'</span>,   names{ind(k)});
1145                 tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'H1LINE_CALLED'</span>, h1line{ind(k)});
1146                 tpl = parse(tpl,<span class="string">'crossrefcalleds'</span>,<span class="string">'crossrefcalled'</span>,1);
1147             <span class="keyword">end</span>
1148             
1149             <span class="comment">%- Set subfunction template field</span>
1150             tpl = set(tpl,<span class="string">'var'</span>,{<span class="string">'subf'</span> <span class="string">'onesubf'</span>},{<span class="string">''</span> <span class="string">''</span>});
1151             <span class="keyword">if</span> ~isempty(subroutine{j}) &amp; options.source
1152                 <span class="keyword">for</span> k=1:length(subroutine{j})
1153                     tpl = set(tpl, <span class="string">'var'</span>, <span class="string">'L_SUB'</span>, [<span class="string">'#_sub'</span> num2str(k)]);
1154                     tpl = set(tpl, <span class="string">'var'</span>, <span class="string">'SUB'</span>,   subroutine{j}{k});
1155                     tpl = parse(tpl, <span class="string">'onesubf'</span>, <span class="string">'onesubfunction'</span>,1);
1156                 <span class="keyword">end</span>
1157                 tpl = parse(tpl,<span class="string">'subf'</span>,<span class="string">'subfunction'</span>);
1158             <span class="keyword">end</span>
1159             subname = <a href="#_sub5" class="code" title="subfunction name = extractname(synopsis)">extractname</a>(subroutine{j});
1160             
1161             <span class="comment">%- Link to M-file (for download)</span>
1162             tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'downloads'</span>,<span class="string">''</span>);
1163             <span class="keyword">if</span> options.download
1164                 tpl = parse(tpl,<span class="string">'downloads'</span>,<span class="string">'download'</span>,1);
1165             <span class="keyword">end</span>
1166             
1167             <span class="comment">%- Display source code with cross-references</span>
1168             <span class="keyword">if</span> options.source &amp; ~strcmpi(names{j},<span class="string">'contents'</span>)
1169                 fseek(fid2,0,-1);
1170                 it = 1;
1171                 matlabsource = <span class="string">''</span>;
1172                 nbsubroutine = 1;
1173                 <span class="comment">%- Get href function names of this file</span>
1174                 indhrefnames = find(hrefs(j,:) == 1);
1175                 hrefnames = {names{indhrefnames}};
1176                 <span class="comment">%- Loop over lines</span>
1177                 <span class="keyword">while</span> 1
1178                     tline = fgetl(fid2);
1179                     <span class="keyword">if</span> ~ischar(tline), <span class="keyword">break</span>, <span class="keyword">end</span>
1180                     myline = <span class="string">''</span>;
1181                     splitc = splitcode(<a href="#_sub8" class="code" title="subfunction str = entity(str)">entity</a>(tline));
1182                     <span class="keyword">for</span> k=1:length(splitc)
1183                         <span class="keyword">if</span> isempty(splitc{k})
1184                         <span class="keyword">elseif</span> ~isempty(strmatch(<span class="string">'function'</span>,splitc{k}))
1185                             <span class="comment">%- Subfunctions definition</span>
1186                             myline = [myline <span class="keyword">...</span>
1187                                 sprintf(tpl_mfile_aname,<span class="keyword">...</span>
1188                                     [<span class="string">'_sub'</span> num2str(nbsubroutine-1)],splitc{k})];
1189                             nbsubroutine = nbsubroutine + 1;
1190                         <span class="keyword">elseif</span> splitc{k}(1) == <span class="string">''''</span>
1191                             myline = [myline <span class="keyword">...</span>
1192                                 sprintf(tpl_mfile_string,splitc{k})];
1193                         <span class="keyword">elseif</span> splitc{k}(1) == <span class="string">'%'</span>
1194                             myline = [myline <span class="keyword">...</span>
1195                                 sprintf(tpl_mfile_comment,deblank(splitc{k}))];
1196                         <span class="keyword">elseif</span> ~isempty(strmatch(<span class="string">'...'</span>,splitc{k}))
1197                             myline = [myline sprintf(tpl_mfile_keyword,<span class="string">'...'</span>)];
1198                             <span class="keyword">if</span> ~isempty(splitc{k}(4:end))
1199                                 myline = [myline <span class="keyword">...</span>
1200                                     sprintf(tpl_mfile_comment,splitc{k}(4:end))];
1201                             <span class="keyword">end</span>
1202                         <span class="keyword">else</span>
1203                             <span class="comment">%- Look for keywords</span>
1204                             r = splitc{k};
1205                             <span class="keyword">while</span> 1
1206                                 [t,r,q] = strtok(r,strtok_delim);
1207                                 myline = [myline q];
1208                                 <span class="keyword">if</span> isempty(t), <span class="keyword">break</span>, <span class="keyword">end</span>;
1209                                 <span class="comment">%- Highlight Matlab keywords &amp;</span>
1210                                 <span class="comment">%  cross-references on known functions</span>
1211                                 <span class="keyword">if</span> options.syntaxHighlighting &amp; <span class="keyword">...</span>
1212                                         any(strcmp(matlabKeywords,t))
1213                                     <span class="keyword">if</span> strcmp(<span class="string">'end'</span>,t)
1214                                         rr = fliplr(deblank(fliplr(r)));
1215                                         icomma = strmatch(<span class="string">','</span>,rr);
1216                                         isemicolon = strmatch(<span class="string">';'</span>,rr);
1217                                         <span class="keyword">if</span> ~(isempty(rr) | ~isempty([icomma isemicolon]))
1218                                             myline = [myline t];
1219                                         <span class="keyword">else</span>
1220                                             myline = [myline sprintf(tpl_mfile_keyword,t)];
1221                                         <span class="keyword">end</span>
1222                                     <span class="keyword">else</span>
1223                                         myline = [myline sprintf(tpl_mfile_keyword,t)];
1224                                     <span class="keyword">end</span>
1225                                 <span class="keyword">elseif</span> any(strcmp(hrefnames,t))
1226                                     indt = indhrefnames(logical(strcmp(hrefnames,t)));
1227                                     flink = [t options.extension];
1228                                     ii = ismember({mdirs{indt}},mdirs{j});
1229                                     <span class="keyword">if</span> ~any(ii)
1230                                         <span class="comment">% take the first one...</span>
1231                                         flink = <a href="#_sub6" class="code" title="subfunction f = fullurl(varargin)">fullurl</a>(<a href="#_sub3" class="code" title="subfunction s = backtomaster(mdir)">backtomaster</a>(mdirs{j}),<span class="keyword">...</span>
1232                                                           mdirs{indt(1)}, flink);
1233                                     <span class="keyword">else</span>
1234                                         indt = indt(logical(ii));
1235                                     <span class="keyword">end</span>
1236                                     myline = [myline sprintf(tpl_mfile_code,<span class="keyword">...</span>
1237                                               flink, synopsis{indt(1)}, t)];
1238                                 <span class="keyword">elseif</span> any(strcmp(subname,t))
1239                                     ii = find(strcmp(subname,t));
1240                                     myline = [myline sprintf(tpl_mfile_code,<span class="keyword">...</span>
1241                                         [<span class="string">'#_sub'</span> num2str(ii)],<span class="keyword">...</span>
1242                                         [<span class="string">'sub'</span> subroutine{j}{ii}],t)];
1243                                 <span class="keyword">else</span>
1244                                     myline = [myline t];
1245                                 <span class="keyword">end</span>
1246                             <span class="keyword">end</span>
1247                         <span class="keyword">end</span>
1248                     <span class="keyword">end</span>
1249                     matlabsource = [matlabsource sprintf(tpl_mfile_line,it,myline)];
1250                     it = it + 1;
1251                 <span class="keyword">end</span>
1252                 nblinetot = nblinetot + it - 1;
1253                 tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'SOURCECODE'</span>,<span class="keyword">...</span>
1254                           <a href="#_sub9" class="code" title="subfunction str = horztab(str,n)">horztab</a>(matlabsource,options.tabs));
1255                 tpl = parse(tpl,<span class="string">'thesource'</span>,<span class="string">'source'</span>);
1256             <span class="keyword">else</span>
1257                 tpl = set(tpl,<span class="string">'var'</span>,<span class="string">'thesource'</span>,<span class="string">''</span>);
1258             <span class="keyword">end</span>
1259             tpl = parse(tpl,<span class="string">'OUT'</span>,<span class="string">'TPL_MFILE'</span>);
1260             fprintf(fid,<span class="string">'%s'</span>,get(tpl,<span class="string">'OUT'</span>));
1261             fclose(fid2);
1262             fclose(fid);
1263         <span class="keyword">end</span>
1264     <span class="keyword">end</span>
1265 <span class="keyword">end</span>
1266 
1267 <span class="comment">%-------------------------------------------------------------------------------</span>
1268 <span class="comment">%- Display Statistics</span>
1269 <span class="comment">%-------------------------------------------------------------------------------</span>
1270 <span class="keyword">if</span> options.verbose
1271     prnbline = <span class="string">''</span>;
1272     <span class="keyword">if</span> options.source
1273         prnbline = sprintf(<span class="string">'(%d lines) '</span>, nblinetot);
1274     <span class="keyword">end</span>
1275     fprintf(<span class="string">'Stats: %d M-files %sin %d directories documented in %d s.\n'</span>, <span class="keyword">...</span>
1276             length(mfiles), prnbline, length(mdir), round(etime(clock,t0)));
1277 <span class="keyword">end</span>
1278 
1279 <span class="comment">%===============================================================================</span>
1280 <a name="_sub1" href="#_subfunctions" class="code">function mfiles = getmfiles(mdirs, mfiles, recursive)</a>
1281     <span class="comment">%- Extract M-files from a list of directories and/or M-files</span>
1282 
1283     <span class="keyword">for</span> i=1:length(mdirs)
1284         currentdir = fullfile(pwd, mdirs{i});
1285         <span class="keyword">if</span> exist(currentdir) == 2 <span class="comment">% M-file</span>
1286             mfiles{end+1} = mdirs{i};
1287         <span class="keyword">elseif</span> exist(currentdir) == 7 <span class="comment">% Directory</span>
1288             d = dir(fullfile(currentdir, <span class="string">'*.m'</span>));
1289             d = {d(~[d.isdir]).name};
1290             <span class="keyword">for</span> j=1:length(d)
1291                 <span class="comment">%- don't take care of files containing ','</span>
1292                 <span class="comment">%  probably a sccs file...</span>
1293                 <span class="keyword">if</span> isempty(findstr(<span class="string">','</span>,d{j}))
1294                     mfiles{end+1} = fullfile(mdirs{i}, d{j});
1295                 <span class="keyword">end</span>
1296             <span class="keyword">end</span>
1297             <span class="keyword">if</span> recursive
1298                 d = dir(currentdir);
1299                 d = {d([d.isdir]).name};
1300                 d = {d{~ismember(d,{<span class="string">'.'</span> <span class="string">'..'</span>})}};
1301                 <span class="keyword">for</span> j=1:length(d)
1302                     mfiles = <a href="#_sub1" class="code" title="subfunction mfiles = getmfiles(mdirs, mfiles, recursive)">getmfiles</a>(cellstr(fullfile(mdirs{i},d{j})), <span class="keyword">...</span>
1303                                        mfiles, recursive);
1304                 <span class="keyword">end</span>
1305             <span class="keyword">end</span>
1306         <span class="keyword">else</span>
1307             fprintf(<span class="string">'Warning: Unprocessed file %s.\n'</span>,mdirs{i});
1308             <span class="keyword">if</span> ~isempty(strmatch(<span class="string">'/'</span>,mdirs{i})) | findstr(<span class="string">':'</span>,mdirs{i})
1309                 fprintf(<span class="string">'         Use relative paths in ''mfiles'' option\n'</span>);
1310             <span class="keyword">end</span> 
1311         <span class="keyword">end</span>
1312     <span class="keyword">end</span>
1313 
1314 <span class="comment">%===============================================================================</span>
1315 <a name="_sub2" href="#_subfunctions" class="code">function calldot(dotexec, mdotfile, mapfile, pngfile, opt)</a>
1316     <span class="comment">%- Draw a dependency graph in a PNG image using &lt;dot&gt; from GraphViz</span>
1317 
1318     <span class="keyword">if</span> nargin == 4, opt = <span class="string">''</span>; <span class="keyword">end</span>
1319     <span class="keyword">try</span>
1320         <span class="comment">%- See &lt;http://www.graphviz.org/&gt;</span>
1321         <span class="comment">%  &lt;dot&gt; must be in your system path, see M2HTML FAQ:</span>
1322         <span class="comment">%  &lt;http://www.artefact.tk/software/matlab/m2html/faq.php&gt;</span>
1323 
1324         eval([<span class="string">'!&quot;'</span> dotexec <span class="string">'&quot; '</span> opt <span class="string">' -Tcmap -Tpng &quot;'</span> mdotfile <span class="keyword">...</span>
1325               <span class="string">'&quot; -o &quot;'</span> mapfile <span class="keyword">...</span><span class="comment"> </span>
1326               <span class="string">'&quot; -o &quot;'</span> pngfile <span class="string">'&quot;'</span>]);
1327         <span class="comment">% use '!' rather than 'system' for backward compability with Matlab 5.3</span>
1328     <span class="keyword">catch</span> <span class="comment">% use of '!' prevents errors to be catched...</span>
1329         fprintf(<span class="string">'&lt;dot&gt; failed.'</span>);
1330     <span class="keyword">end</span>
1331     
1332 <span class="comment">%===============================================================================</span>
1333 <a name="_sub3" href="#_subfunctions" class="code">function s = backtomaster(mdir)</a>
1334     <span class="comment">%- Provide filesystem path to go back to the root folder</span>
1335 
1336     ldir = <a href="#_sub4" class="code" title="subfunction ldir = splitpath(p)">splitpath</a>(mdir);
1337     s = repmat(<span class="string">'../'</span>,1,length(ldir));
1338     
1339 <span class="comment">%===============================================================================</span>
1340 <a name="_sub4" href="#_subfunctions" class="code">function ldir = splitpath(p)</a>
1341     <span class="comment">%- Split a filesystem path into parts using filesep as separator</span>
1342 
1343     ldir = {};
1344     p = deblank(p);
1345     <span class="keyword">while</span> 1
1346         [t,p] = strtok(p,filesep);
1347         <span class="keyword">if</span> isempty(t), <span class="keyword">break</span>; <span class="keyword">end</span>
1348         <span class="keyword">if</span> ~strcmp(t,<span class="string">'.'</span>)
1349             ldir{end+1} = t;
1350         <span class="keyword">end</span>
1351     <span class="keyword">end</span>
1352     <span class="keyword">if</span> isempty(ldir)
1353         ldir{1} = <span class="string">'.'</span>; <span class="comment">% should be removed</span>
1354     <span class="keyword">end</span>
1355 
1356 <span class="comment">%===============================================================================</span>
1357 <a name="_sub5" href="#_subfunctions" class="code">function name = extractname(synopsis)</a>
1358     <span class="comment">%- Extract function name in a synopsis</span>
1359 
1360     <span class="keyword">if</span> ischar(synopsis), synopsis = {synopsis}; <span class="keyword">end</span>
1361     name = cell(size(synopsis));
1362     <span class="keyword">for</span> i=1:length(synopsis)
1363         ind = findstr(synopsis{i},<span class="string">'='</span>);
1364         <span class="keyword">if</span> isempty(ind)
1365             ind = findstr(synopsis{i},<span class="string">'function'</span>);
1366             s = synopsis{i}(ind(1)+8:end);
1367         <span class="keyword">else</span>
1368             s = synopsis{i}(ind(1)+1:end);
1369         <span class="keyword">end</span>
1370         name{i} = strtok(s,[9:13 32 40]); <span class="comment">% white space characters and '('</span>
1371     <span class="keyword">end</span>
1372     <span class="keyword">if</span> length(name) == 1, name = name{1}; <span class="keyword">end</span>
1373 
1374 <span class="comment">%===============================================================================</span>
1375 <a name="_sub6" href="#_subfunctions" class="code">function f = fullurl(varargin)</a>
1376     <span class="comment">%- Build full url from parts (using '/' and not filesep)</span>
1377     
1378     f = strrep(fullfile(varargin{:}),<span class="string">'\'</span>,<span class="string">'/'</span>);
1379 
1380 <span class="comment">%===============================================================================</span>
1381 <a name="_sub7" href="#_subfunctions" class="code">function str = escapeblank(str)</a>
1382     <span class="comment">%- Escape white spaces using '\'</span>
1383     
1384     str = deblank(fliplr(deblank(fliplr(str))));
1385     str = strrep(str,<span class="string">' '</span>,<span class="string">'\ '</span>);
1386 
1387 <span class="comment">%===============================================================================</span>
1388 <a name="_sub8" href="#_subfunctions" class="code">function str = entity(str)</a>
1389     <span class="comment">%- Escape HTML special characters</span>
1390     <span class="comment">%- See http://www.w3.org/TR/html4/charset.html#h-5.3.2</span>
1391     
1392     str = strrep(str,<span class="string">'&amp;'</span>,<span class="string">'&amp;amp;'</span>);
1393     str = strrep(str,<span class="string">'&lt;'</span>,<span class="string">'&amp;lt;'</span>);
1394     str = strrep(str,<span class="string">'&gt;'</span>,<span class="string">'&amp;gt;'</span>);
1395     str = strrep(str,<span class="string">'&quot;'</span>,<span class="string">'&amp;quot;'</span>);
1396     
1397 <span class="comment">%===============================================================================</span>
1398 <a name="_sub9" href="#_subfunctions" class="code">function str = horztab(str,n)</a>
1399     <span class="comment">%- For browsers, the horizontal tab character is the smallest non-zero</span>
1400     <span class="comment">%- number of spaces necessary to line characters up along tab stops that are</span>
1401     <span class="comment">%- every 8 characters: behaviour obtained when n = 0.</span>
1402     
1403     <span class="keyword">if</span> n &gt; 0
1404         str = strrep(str,sprintf(<span class="string">'\t'</span>),blanks(n));
1405     <span class="keyword">end</span></pre></div>
<hr><address>Generated on Thu 05-May-2022 15:20:21 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>