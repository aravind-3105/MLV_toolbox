<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of apply_homography</title>
  <meta name="keywords" content="apply_homography">
  <meta name="description" content="Applies the homography defined by H on the image I.">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../../../../index.html">Home</a> &gt;  <a href="../../../../index.html">MLVcode</a> &gt; <a href="../../../index.html">edges-master</a> &gt; <a href="#">toolbox-master</a> &gt; <a href="../index.html">external</a> &gt; <a href="index.html">deprecated</a> &gt; apply_homography.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../../../../index.html"><img alt="<" border="0" src="../../../../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for MLVcode\edges-master\toolbox-master\external\deprecated&nbsp;<img alt=">" border="0" src="../../../../../right.png"></a></td></tr></table>-->

<h1>apply_homography
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../../../up.png"></a></h2>
<div class="box"><strong>Applies the homography defined by H on the image I.</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../../../up.png"></a></h2>
<div class="box"><strong>function IR = apply_homography( I, H, method, bbox, show ) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../../../up.png"></a></h2>
<div class="fragment"><pre class="comment"> Applies the homography defined by H on the image I.

 Takes the center of the image as the origin, not the top left corner.
 Also, the coordinate system is row/ column format, so H must be also.

 The bounding box of the image is set by the BBOX argument, a string that
 can be 'loose' (default) or 'crop'. When BBOX is 'loose', IR includes the
 whole transformed image, which generally is larger than I. When BBOX is
 'crop' IR is cropped to include only the central portion of the
 transformed image and is the same size as I.  Preserves I's type.

 USAGE
  IR = apply_homography( I, H, [method], [bbox], [show] )

 INPUTS
  I       - input black and white image (2D double or unint8 array)
  H       - 3x3 nonsingular homography matrix
  method  - ['linear'] for interp2 'nearest','linear','spline','cubic'
  bbox    - ['loose'] see above for meaning of bbox 'loose','crop')
  show    - [0] figure to use for optional display

 OUTPUTS
  IR -  result of applying H to I.

 EXAMPLE
  load trees; I=X;
  R = rotationMatrix( pi/4 ); T = [1; 3]; H = [R T; 0 0 1];
  IR = apply_homography( I, H, [], 'crop', 1 );

 See also TEXTURE_MAP, <a href="imrotate2.html" class="code" title="function IR = imrotate2( I, angle, method, bbox )">IMROTATE2</a></pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../../../matlabicon.gif)">
</ul>
This function is called by:
<ul style="list-style-image:url(../../../../../matlabicon.gif)">
<li><a href="imrotate2.html" class="code" title="function IR = imrotate2( I, angle, method, bbox )">imrotate2</a>	Custom version of imrotate that demonstrates use of apply_homography.</li><li><a href="imtranslate.html" class="code" title="function IR = imtranslate( I, dx, dy, method, bbox )">imtranslate</a>	Translate an image to subpixel accuracy.</li></ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <span class="comment">% Applies the homography defined by H on the image I.</span>
0002 <span class="comment">%</span>
0003 <span class="comment">% Takes the center of the image as the origin, not the top left corner.</span>
0004 <span class="comment">% Also, the coordinate system is row/ column format, so H must be also.</span>
0005 <span class="comment">%</span>
0006 <span class="comment">% The bounding box of the image is set by the BBOX argument, a string that</span>
0007 <span class="comment">% can be 'loose' (default) or 'crop'. When BBOX is 'loose', IR includes the</span>
0008 <span class="comment">% whole transformed image, which generally is larger than I. When BBOX is</span>
0009 <span class="comment">% 'crop' IR is cropped to include only the central portion of the</span>
0010 <span class="comment">% transformed image and is the same size as I.  Preserves I's type.</span>
0011 <span class="comment">%</span>
0012 <span class="comment">% USAGE</span>
0013 <span class="comment">%  IR = apply_homography( I, H, [method], [bbox], [show] )</span>
0014 <span class="comment">%</span>
0015 <span class="comment">% INPUTS</span>
0016 <span class="comment">%  I       - input black and white image (2D double or unint8 array)</span>
0017 <span class="comment">%  H       - 3x3 nonsingular homography matrix</span>
0018 <span class="comment">%  method  - ['linear'] for interp2 'nearest','linear','spline','cubic'</span>
0019 <span class="comment">%  bbox    - ['loose'] see above for meaning of bbox 'loose','crop')</span>
0020 <span class="comment">%  show    - [0] figure to use for optional display</span>
0021 <span class="comment">%</span>
0022 <span class="comment">% OUTPUTS</span>
0023 <span class="comment">%  IR -  result of applying H to I.</span>
0024 <span class="comment">%</span>
0025 <span class="comment">% EXAMPLE</span>
0026 <span class="comment">%  load trees; I=X;</span>
0027 <span class="comment">%  R = rotationMatrix( pi/4 ); T = [1; 3]; H = [R T; 0 0 1];</span>
0028 <span class="comment">%  IR = apply_homography( I, H, [], 'crop', 1 );</span>
0029 <span class="comment">%</span>
0030 <span class="comment">% See also TEXTURE_MAP, IMROTATE2</span>
0031 
0032 <span class="comment">% Piotr's Image&amp;Video Toolbox      Version 1.5</span>
0033 <span class="comment">% Written and maintained by Piotr Dollar    pdollar-at-cs.ucsd.edu</span>
0034 <span class="comment">% Please email me if you find bugs, or have suggestions or questions!</span>
0035 
0036 <a name="_sub0" href="#_subfunctions" class="code">function IR = apply_homography( I, H, method, bbox, show )</a>
0037 
0038 <span class="keyword">if</span>( ndims(I)~=2 ); error(<span class="string">'I must a MxN array'</span>); <span class="keyword">end</span>;
0039 <span class="keyword">if</span>(any(size(H)~=[3 3])); error(<span class="string">'H must be 3 by 3'</span>); <span class="keyword">end</span>;
0040 <span class="keyword">if</span>(rank(H)~=3); error(<span class="string">'H must be full rank.'</span>); <span class="keyword">end</span>;
0041 <span class="keyword">if</span>( nargin&lt;3 || isempty(method)); method=<span class="string">'linear'</span>; <span class="keyword">end</span>;
0042 <span class="keyword">if</span>( nargin&lt;4 || isempty(bbox)); bbox=<span class="string">'loose'</span>; <span class="keyword">end</span>;
0043 <span class="keyword">if</span>( nargin&lt;5 || isempty(show)); show=0; <span class="keyword">end</span>;
0044 
0045 classname = class( I );
0046 <span class="keyword">if</span>(~strcmp(classname,<span class="string">'double'</span>)); I = double(I); <span class="keyword">end</span>
0047 I = padarray(I,[3,3],eps,<span class="string">'both'</span>);
0048 siz = size(I);
0049 
0050 <span class="comment">% set origin to be center of image</span>
0051 rstart = (-siz(1)+1)/2; rend = (siz(1)-1)/2;
0052 cstart = (-siz(2)+1)/2; cend = (siz(2)-1)/2;
0053 
0054 <span class="comment">% If 'bbox' then get bounds of resulting image. To do this project the</span>
0055 <span class="comment">% original points accoring to the homography and see the bounds.  Note</span>
0056 <span class="comment">% that since a homography maps a quadrilateral to a quadrilateral only</span>
0057 <span class="comment">% need to look at where the bounds of the quadrilateral are mapped to.</span>
0058 <span class="comment">% If 'same' then simply use the original image bounds.</span>
0059 <span class="keyword">if</span> (strcmp(bbox,<span class="string">'loose'</span>))
0060   pr = H * [rstart rend rstart rend; cstart cstart cend cend; 1 1 1 1];
0061   row_dest = pr(1,:) ./ pr(3,:);  col_dest = pr(2,:) ./ pr(3,:);
0062   minr = floor(min(row_dest(:)));  maxr = ceil(max(row_dest(:)));
0063   minc = floor(min(col_dest(:)));  maxc = ceil(max(col_dest(:)));
0064 <span class="keyword">elseif</span> (strcmp(bbox,<span class="string">'crop'</span>))
0065   minr = rstart; maxr = rend;
0066   minc = cstart; maxc = cend;
0067 <span class="keyword">else</span>
0068   error(<span class="string">'illegal value for bbox'</span>);
0069 <span class="keyword">end</span>;
0070 
0071 mrows = maxr-minr+1;
0072 ncols = maxc-minc+1;
0073 
0074 <span class="comment">% apply inverse homography on meshgrid in destination image</span>
0075 [col_dest_grid,row_dest_grid] = meshgrid( minc:maxc, minr:maxr );
0076 pr = inv(H) * [row_dest_grid(:)'; col_dest_grid(:)'; ones(1,mrows*ncols)];
0077 row_sample_locs = pr(1,:) ./ pr(3,:) + (siz(1)+1)/2;
0078 row_sample_locs = reshape(row_sample_locs,mrows,ncols);
0079 col_sample_locs = pr(2,:) ./ pr(3,:) + (siz(2)+1)/2;
0080 col_sample_locs = reshape(col_sample_locs,mrows,ncols);
0081 
0082 <span class="comment">% now texture map results</span>
0083 IR = interp2( I, col_sample_locs, row_sample_locs, method );
0084 IR(isnan(IR)) = 0;
0085 IR = arraycrop2dims( IR, size(IR)-6 ); <span class="comment">%undo extra padding</span>
0086 
0087 <span class="keyword">if</span>(~strcmp(classname,<span class="string">'double'</span>)); IR=feval(classname,IR );  <span class="keyword">end</span>
0088 
0089 <span class="comment">% optionally show</span>
0090 <span class="keyword">if</span> ( show)
0091   I = arraycrop2dims( I, size(IR)-2 );
0092   figure(show); clf; im(I);
0093   figure(show+1); clf; im(IR);
0094 <span class="keyword">end</span></pre></div>
<hr><address>Generated on Thu 05-May-2022 14:52:24 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>