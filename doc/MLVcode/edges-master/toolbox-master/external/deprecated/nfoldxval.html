<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of nfoldxval</title>
  <meta name="keywords" content="nfoldxval">
  <meta name="description" content="Runs n-fold cross validation on data with a given classifier.">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../../../../index.html">Home</a> &gt;  <a href="../../../../index.html">MLVcode</a> &gt; <a href="../../../index.html">edges-master</a> &gt; <a href="#">toolbox-master</a> &gt; <a href="../index.html">external</a> &gt; <a href="index.html">deprecated</a> &gt; nfoldxval.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../../../../index.html"><img alt="<" border="0" src="../../../../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for MLVcode\edges-master\toolbox-master\external\deprecated&nbsp;<img alt=">" border="0" src="../../../../../right.png"></a></td></tr></table>-->

<h1>nfoldxval
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../../../up.png"></a></h2>
<div class="box"><strong>Runs n-fold cross validation on data with a given classifier.</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../../../up.png"></a></h2>
<div class="box"><strong>function CM=nfoldxval( data, IDX, clfInit, clfparams,types, ignoreT, fname, show ) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../../../up.png"></a></h2>
<div class="fragment"><pre class="comment"> Runs n-fold cross validation on data with a given classifier.

 Given n separate labeled data sets, trains classifier using n-1 data
 sets, test on remaining one.  Average results over all n such runs.
 Shows overall results in average confusion matrix.

 The classifier is passed in as a parameter.  For this to work the
 classifier (clf) must follow certain conventions.  The conventions are:
  1) To initialize the clf ('p' is the dimension of the data):
     clf = clfInit( p, clfparams{:} )
  2) clf must point to 2 functions for training and applying it:
     clf.funTrain    and   clf.funFwd
  3) For training the following will be called:
     clf = clf.funTrain( clf, X, Y );
  4) For testing the following will be called:
     pred = clf.funFwd( clf, Xtest );
 The format for X is nxp where there are n data points and p is their
 dimension. The format for Y is nx1.

 Given data in a cell array, to string out into single array:
  IDX = cell2mat(permute(IDX,[2 1]));
  data = cell2mat(permute(data,[2 1]));
 For a simple, small dataset, can do leave one out clf as follows:
  [n,p]=size(data); IDX=mat2cell(IDX,ones(1,n),1);
  data=mat2cell(data,ones(1,n),p);
 Overall error can be calculated via:
   er = 1-sum(diag(CM))/sum(CM(:))
 Normalized confusion matrix can be calculated via:
   CMn = CM ./ repmat( sum(CM,2), [1 size(CM,2)] );

 USAGE
  CM=nfoldxval( data, IDX, clfInit, clfparams, ...
                [types], [ignoreT], [fname], [show] )
 INPUTS
  data        - cell array of (n x p) arrays each of n samples of dim p
  IDX         - cell array of (n x 1) arrays each of n labels
  clfInit     - classifier initialization function
  clfparams   - classifier parameters
  types       - [] cell array of string labels for types
  ignoreT     - [] array of types to ignore {eg: [1 4 5]}.
  fname       - [] specify a file to save CM to, as well as image
  show        - [] will display results in figure(show)

 OUTPUTS
  CM          - confusion matrix

 EXAMPLE
  load clfData;
  %%% 2 class
  nfoldxval( data, IDX, @clfLda,{'linear'}, [],[],[],1 );   % LDA
  nfoldxval( data, IDX, @clfKnn,{4},[],[],[],2 );           % 4 kNN
  nfoldxval( data, IDX, @clfSvm,{'poly',2},[],[],[],3 );    % poly SVM
  nfoldxval( data, IDX, @clfSvm,{'rbf',2^-12},[],[],[],4 ); % rbf SVM
  nfoldxval( data, IDX, @clfDecTree,{},[],[],[],5 );        % dec. tree
  %%% multiclass
  clfparams = {@clfSvm,{'rbf',2^-12},nclasses};
  nfoldxval( data, IDX, @clfEcoc,clfparams,[],[],[],6 );    % ECOC

 See also <a href="clfKnn.html" class="code" title="function clf = clfKnn( p, k, metric )">CLFKNN</a>, <a href="clfLda.html" class="code" title="function clf = clfLda( p, type, prior )">CLFLDA</a>, <a href="clfSvm.html" class="code" title="function net = clfSvm(varargin)">CLFSVM</a>, <a href="clfEcoc.html" class="code" title="function clf = clfEcoc(p,clfInit,clfparams,nclasses,use01targets)">CLFECOC</a>, <a href="clfDecTree.html" class="code" title="function clf = clfDecTree( p, varargin )">CLFDECTREE</a>, <a href="demoClassify.html" class="code" title="function demoClassify">DEMOCLASSIFY</a>

 Piotr's Image&amp;Video Toolbox      Version 2.30
 Copyright 2009 Piotr Dollar.  [pdollar-at-caltech.edu]
 Please email me if you find bugs, or have suggestions or questions!
 Licensed under the Lesser GPL [see external/lgpl.txt]</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../../../matlabicon.gif)">
</ul>
This function is called by:
<ul style="list-style-image:url(../../../../../matlabicon.gif)">
</ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function CM=nfoldxval( data, IDX, clfInit, clfparams, </a><span class="keyword">...</span>
0002   types, ignoreT, fname, show )
0003 <span class="comment">% Runs n-fold cross validation on data with a given classifier.</span>
0004 <span class="comment">%</span>
0005 <span class="comment">% Given n separate labeled data sets, trains classifier using n-1 data</span>
0006 <span class="comment">% sets, test on remaining one.  Average results over all n such runs.</span>
0007 <span class="comment">% Shows overall results in average confusion matrix.</span>
0008 <span class="comment">%</span>
0009 <span class="comment">% The classifier is passed in as a parameter.  For this to work the</span>
0010 <span class="comment">% classifier (clf) must follow certain conventions.  The conventions are:</span>
0011 <span class="comment">%  1) To initialize the clf ('p' is the dimension of the data):</span>
0012 <span class="comment">%     clf = clfInit( p, clfparams{:} )</span>
0013 <span class="comment">%  2) clf must point to 2 functions for training and applying it:</span>
0014 <span class="comment">%     clf.funTrain    and   clf.funFwd</span>
0015 <span class="comment">%  3) For training the following will be called:</span>
0016 <span class="comment">%     clf = clf.funTrain( clf, X, Y );</span>
0017 <span class="comment">%  4) For testing the following will be called:</span>
0018 <span class="comment">%     pred = clf.funFwd( clf, Xtest );</span>
0019 <span class="comment">% The format for X is nxp where there are n data points and p is their</span>
0020 <span class="comment">% dimension. The format for Y is nx1.</span>
0021 <span class="comment">%</span>
0022 <span class="comment">% Given data in a cell array, to string out into single array:</span>
0023 <span class="comment">%  IDX = cell2mat(permute(IDX,[2 1]));</span>
0024 <span class="comment">%  data = cell2mat(permute(data,[2 1]));</span>
0025 <span class="comment">% For a simple, small dataset, can do leave one out clf as follows:</span>
0026 <span class="comment">%  [n,p]=size(data); IDX=mat2cell(IDX,ones(1,n),1);</span>
0027 <span class="comment">%  data=mat2cell(data,ones(1,n),p);</span>
0028 <span class="comment">% Overall error can be calculated via:</span>
0029 <span class="comment">%   er = 1-sum(diag(CM))/sum(CM(:))</span>
0030 <span class="comment">% Normalized confusion matrix can be calculated via:</span>
0031 <span class="comment">%   CMn = CM ./ repmat( sum(CM,2), [1 size(CM,2)] );</span>
0032 <span class="comment">%</span>
0033 <span class="comment">% USAGE</span>
0034 <span class="comment">%  CM=nfoldxval( data, IDX, clfInit, clfparams, ...</span>
0035 <span class="comment">%                [types], [ignoreT], [fname], [show] )</span>
0036 <span class="comment">% INPUTS</span>
0037 <span class="comment">%  data        - cell array of (n x p) arrays each of n samples of dim p</span>
0038 <span class="comment">%  IDX         - cell array of (n x 1) arrays each of n labels</span>
0039 <span class="comment">%  clfInit     - classifier initialization function</span>
0040 <span class="comment">%  clfparams   - classifier parameters</span>
0041 <span class="comment">%  types       - [] cell array of string labels for types</span>
0042 <span class="comment">%  ignoreT     - [] array of types to ignore {eg: [1 4 5]}.</span>
0043 <span class="comment">%  fname       - [] specify a file to save CM to, as well as image</span>
0044 <span class="comment">%  show        - [] will display results in figure(show)</span>
0045 <span class="comment">%</span>
0046 <span class="comment">% OUTPUTS</span>
0047 <span class="comment">%  CM          - confusion matrix</span>
0048 <span class="comment">%</span>
0049 <span class="comment">% EXAMPLE</span>
0050 <span class="comment">%  load clfData;</span>
0051 <span class="comment">%  %%% 2 class</span>
0052 <span class="comment">%  nfoldxval( data, IDX, @clfLda,{'linear'}, [],[],[],1 );   % LDA</span>
0053 <span class="comment">%  nfoldxval( data, IDX, @clfKnn,{4},[],[],[],2 );           % 4 kNN</span>
0054 <span class="comment">%  nfoldxval( data, IDX, @clfSvm,{'poly',2},[],[],[],3 );    % poly SVM</span>
0055 <span class="comment">%  nfoldxval( data, IDX, @clfSvm,{'rbf',2^-12},[],[],[],4 ); % rbf SVM</span>
0056 <span class="comment">%  nfoldxval( data, IDX, @clfDecTree,{},[],[],[],5 );        % dec. tree</span>
0057 <span class="comment">%  %%% multiclass</span>
0058 <span class="comment">%  clfparams = {@clfSvm,{'rbf',2^-12},nclasses};</span>
0059 <span class="comment">%  nfoldxval( data, IDX, @clfEcoc,clfparams,[],[],[],6 );    % ECOC</span>
0060 <span class="comment">%</span>
0061 <span class="comment">% See also CLFKNN, CLFLDA, CLFSVM, CLFECOC, CLFDECTREE, DEMOCLASSIFY</span>
0062 <span class="comment">%</span>
0063 <span class="comment">% Piotr's Image&amp;Video Toolbox      Version 2.30</span>
0064 <span class="comment">% Copyright 2009 Piotr Dollar.  [pdollar-at-caltech.edu]</span>
0065 <span class="comment">% Please email me if you find bugs, or have suggestions or questions!</span>
0066 <span class="comment">% Licensed under the Lesser GPL [see external/lgpl.txt]</span>
0067 
0068 <span class="keyword">if</span>( nargin&lt;5 || isempty(types) ); types=[]; <span class="keyword">end</span>
0069 <span class="keyword">if</span>( nargin&lt;6 || isempty(ignoreT) ); ignoreT=[]; <span class="keyword">end</span>
0070 <span class="keyword">if</span>( nargin&lt;7 || isempty(fname) ); fname=[]; <span class="keyword">end</span>
0071 <span class="keyword">if</span>( nargin&lt;8 || isempty(show) ); show=[]; <span class="keyword">end</span>
0072 dispflag = 0;
0073 
0074 <span class="comment">%%% divide n data points into n different sets, perform nfoldxval on each</span>
0075 <span class="keyword">if</span>( ~iscell(data) &amp;&amp; ~iscell(IDX) )
0076   [n,p]=size(data);
0077   IDX=mat2cell(IDX,ones(1,n),1); <span class="comment">%#ok&lt;MMTC&gt;</span>
0078   data=mat2cell(data,ones(1,n),p);
0079 <span class="keyword">end</span>
0080 
0081 <span class="comment">%%% correct format</span>
0082 data={data{:}}; IDX={IDX{:}}; <span class="comment">%#ok&lt;CCAT&gt;</span>
0083 nsets = length( data );
0084 
0085 <span class="comment">%%% remove data points with type specified by ignoreT</span>
0086 <span class="keyword">if</span>( ~isempty(ignoreT) )
0087   <span class="keyword">if</span>(~isempty(types))
0088     keeptypes = setdiff( 1:length(types), ignoreT );
0089     types = types( keeptypes ); ntypes = length(types);  <span class="comment">%#ok&lt;NASGU&gt;</span>
0090   <span class="keyword">end</span>;
0091   ignoreT = sort(ignoreT);
0092   <span class="keyword">while</span>( ~isempty(ignoreT) )
0093     <span class="keyword">for</span> i=1:nsets
0094       keeplocs = (IDX{i}~=ignoreT(1));
0095       data{i} = data{i}(keeplocs,:);  IDXi = IDX{i}(keeplocs);
0096       big=IDXi&gt;ignoreT(1); IDXi(big)=IDXi(big)-1; IDX{i}=IDXi;
0097     <span class="keyword">end</span>;
0098     ignoreT=ignoreT(2:end)-1;
0099   <span class="keyword">end</span>;
0100 <span class="keyword">end</span>;
0101 
0102 <span class="comment">%%% for binary classes convert to most common form [-1/+1]</span>
0103 IDXall = cell2mat( permute( IDX, [2 1] ) );
0104 minIDX = min(IDXall);  maxIDX = max(IDXall);
0105 <span class="keyword">if</span>( minIDX==0 &amp;&amp; maxIDX==1 )
0106   <span class="keyword">for</span> i=1:nsets; IDX{i}(IDX{i}==0)=-1; <span class="keyword">end</span>
0107 <span class="keyword">elseif</span>( minIDX==1 &amp;&amp; maxIDX==2 )
0108   <span class="keyword">for</span> i=1:nsets; IDX{i}(IDX{i}==2)=-1; <span class="keyword">end</span>
0109 <span class="keyword">end</span>;
0110 
0111 <span class="comment">%%% create types string for display if not exist</span>
0112 <span class="keyword">if</span>( isempty(types) )
0113   types = unique(IDXall);
0114   types = int2str2( types );
0115 <span class="keyword">end</span>;
0116 ntypes = length(types);
0117 
0118 <span class="comment">%%% optionally visualize data by embedding in 3D space</span>
0119 <span class="keyword">if</span>( 0 )
0120   dataALL = cell2mat( permute( data, [2 1] ) );
0121   figure(show); show=show+1;
0122   visualizeData( dataALL, 3, IDXall+2, types );
0123 <span class="keyword">end</span>;
0124 
0125 <span class="comment">%%% train on n-1 of the sets, test on the remaining; repeat n times</span>
0126 CM = zeros(ntypes);
0127 <span class="keyword">for</span> testind = 1:nsets
0128 
0129   <span class="comment">% get training/testing data sets</span>
0130   allinds = true(1,nsets);
0131   traininds = allinds; traininds( testind ) = false;
0132   train = cell2mat( permute( {data{traininds}}, [2 1] ) );
0133   test = cell2mat( permute( {data{~traininds}}, [2 1] ) );
0134   trainIDX = cell2mat( permute( {IDX{traininds}}, [2 1] ) );
0135   testIDX = cell2mat( permute( {IDX{~traininds}}, [2 1] ) );
0136   nTrain=size(train,1);  [nTest p]=size(test);
0137 
0138   <span class="comment">% apply dim reduction [make sure data is well conditioned]</span>
0139   <span class="keyword">if</span>( 0 )
0140     [ U, mu ] = pca( train' );
0141     maxp = size(U,2) -6; <span class="comment">% -20; further reduce? -6</span>
0142     <span class="keyword">if</span>( maxp &lt; p )
0143       warning([<span class="string">'reducing dim of data from: '</span> <span class="keyword">...</span>
0144         int2str(p) <span class="string">' to '</span> int2str(maxp)]); <span class="comment">%#ok&lt;WNTAG&gt;</span>
0145       train = pcaApply( train', U, mu, maxp )';
0146       test  = pcaApply( test',  U, mu, maxp )';
0147       p = maxp;
0148     <span class="keyword">end</span>
0149   <span class="keyword">end</span>
0150 
0151   <span class="comment">% display update</span>
0152   <span class="keyword">if</span>( dispflag )
0153     msg = [<span class="string">'test set '</span> int2str(testind)];
0154     disp([msg <span class="string">'; nTrain='</span> num2str(nTrain) <span class="string">', nTest='</span> num2str(nTest)]);
0155   <span class="keyword">end</span>
0156   <span class="keyword">if</span>( nTest==0 ); <span class="keyword">if</span>(dispflag); disp(<span class="string">'no test data'</span>); <span class="keyword">end</span>; <span class="keyword">continue</span>; <span class="keyword">end</span>
0157 
0158   <span class="comment">% learn a classifier on train and classify test</span>
0159   clf = feval( clfInit, p, clfparams{:} );
0160   clf = feval( clf.funTrain, clf, train, trainIDX );
0161   testIDXpred = feval( clf.funFwd, clf, test );
0162   CMi = confMatrix( testIDX, testIDXpred, ntypes );
0163   CM = CM + CMi;
0164 <span class="keyword">end</span>
0165 
0166 <span class="comment">%%% show confusion matrix, optionally save image to file</span>
0167 <span class="keyword">if</span>( show )
0168   figure(show); <span class="comment">%show=show+1;</span>
0169   confMatrixShow( CM, types );
0170   <span class="keyword">if</span>( isempty(fname) )
0171     title( clf.type, <span class="string">'FontSize'</span>, 20 );
0172   <span class="keyword">else</span>
0173     title( fname, <span class="string">'FontSize'</span>, 20 );
0174     print( [fname <span class="string">'.jpg'</span>], <span class="string">'-djpeg'</span> );
0175   <span class="keyword">end</span>
0176 <span class="keyword">end</span>
0177 
0178 <span class="comment">%%% save data to file</span>
0179 <span class="keyword">if</span>( ~isempty(fname) )
0180   er = 1-sum(diag(CM))/sum(CM(:)); <span class="comment">%#ok&lt;NASGU&gt;</span>
0181   CMn = CM ./ repmat( sum(CM,2), [1 size(CM,2)] ); <span class="comment">%#ok&lt;NASGU&gt;</span>
0182   save( fname, <span class="string">'CM'</span>, <span class="string">'CMn'</span>, <span class="string">'er'</span> );
0183   <span class="keyword">if</span>( dispflag ); fprintf([<span class="string">'finished: '</span> fname <span class="string">'.\n\n\n'</span>]); <span class="keyword">end</span>
0184 <span class="keyword">else</span>
0185   <span class="keyword">if</span>( dispflag ); fprintf(<span class="string">'finished.\n\n\n'</span>); <span class="keyword">end</span>
0186 <span class="keyword">end</span></pre></div>
<hr><address>Generated on Thu 05-May-2022 15:20:21 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>