<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of imRectLite</title>
  <meta name="keywords" content="imRectLite">
  <meta name="description" content="A 'lite' version of imrect [OBSOLETE: use imrectRot].">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../../../../index.html">Home</a> &gt;  <a href="../../../../index.html">MLVcode</a> &gt; <a href="../../../index.html">edges-master</a> &gt; <a href="#">toolbox-master</a> &gt; <a href="../index.html">external</a> &gt; <a href="index.html">deprecated</a> &gt; imRectLite.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../../../../index.html"><img alt="<" border="0" src="../../../../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for MLVcode\edges-master\toolbox-master\external\deprecated&nbsp;<img alt=">" border="0" src="../../../../../right.png"></a></td></tr></table>-->

<h1>imRectLite
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../../../up.png"></a></h2>
<div class="box"><strong>A 'lite' version of imrect [OBSOLETE: use imrectRot].</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../../../up.png"></a></h2>
<div class="box"><strong>function [hRect,api] = imrectLite( hParent, pos, lims, ar, varargin ) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../../../up.png"></a></h2>
<div class="fragment"><pre class="comment"> A 'lite' version of imrect [OBSOLETE: use imrectRot].

 There are significant problems using imrect in a larger GUI, mostly
 due to the fact that imrect is such a heavy object.  This creates a
 simple, fast, and in some ways nicer version of imrect.

 The implementation uses two graphics object: a rectangle and a patch.
 The patch is just there to catch mouse clicks in case the rectangle does
 not have a face color.  Any valid property of the rectangle may be
 altered (such as 'FaceColor', 'Curvature', ... ), EXCEPT for its
 'ButtonDownFcn', 'DeleteFcn' and 'Position' properties.  To change the
 'Position' of the rectangle, use the output structure 'api' (described
 below).

 USAGE
  [hRect,api] = imrectLite( [hParent],[pos],[lims],[ar],[varargin] )

 INPUTS
  hParent    - [gca] object parent, typically an axes object (gca)
  pos        - [] initial pos vector [x y w h] or [] or [x0 y0]
  lims       - [] 2x2 matrix of [xMin xMax; yMin yMax]
  ar         - [0] aspect ratio (if positive w/h is constrained to ar)
  varargin   - [] parameters to RECTANGLE graphics object

 OUTPUTS
  hRect      - handle to rectangle, use to alter color etc.
  api        - interface allowing access to created object
  .getPos()       - get position - returns 4 elt pos
  .setPos(pos)    - set position (while respecting constraints)
  .setAr(ar)      - set aspect ratio to fixed value
  .setPosLock(b)  - if lock set (b==true), rectangle cannot change
  .setSizLock(b)  - if lock set (b==true), rectangle cannot change size
  .setPosChnCb(f) - whenever pos changes (even slightly), calls f(pos)
  .setPosSetCb(f) - whenever pos finished changing, calls f(pos)
  .uistack(...)   - calls 'uistack( [hRect hPatch], ... )', see uistack

 EXAMPLE
  figure(1), imshow cameraman.tif
  rectProp = {'EdgeColor','g','LineWidth',4,'Curvature',[.1 .1]};
  lims = [get(gca,'xLim'); get(gca,'yLim')];
  [h,api] = imrectLite( gca, [], lims, [],  rectProp{:} );
  api.setPosChnCb( @(pos) disp(['        ' num2str(pos)]) );
  api.setPosSetCb( @(pos) disp(['FINAL = ' num2str(pos)]) );

 See also IMRECT, RECTANGLE, PATCH

 Piotr's Image&amp;Video Toolbox      Version 2.35
 Copyright 2012 Piotr Dollar.  [pdollar-at-caltech.edu]
 Please email me if you find bugs, or have suggestions or questions!
 Licensed under the Simplified BSD License [see external/bsd.txt]</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../../../matlabicon.gif)">
</ul>
This function is called by:
<ul style="list-style-image:url(../../../../../matlabicon.gif)">
</ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../../../../../up.png"></a></h2>
<ul style="list-style-image:url(../../../../../matlabicon.gif)">
<li><a href="#_sub1" class="code">function setPos( posNew, varargin )</a></li><li><a href="#_sub2" class="code">function pos = constrainPos( pos, anchor, pos0 )</a></li><li><a href="#_sub3" class="code">function pos = shiftPos( anchor, pos0, del )</a></li><li><a href="#_sub4" class="code">function pnt = getCurPnt()</a></li><li><a href="#_sub5" class="code">function d = axisUnitsPerCentimeter()</a></li><li><a href="#_sub6" class="code">function [anchor,cursor] = getSide( pnt )</a></li><li><a href="#_sub7" class="code">function btnDwn( h, evnt, flag )</a></li><li><a href="#_sub8" class="code">function drag( h, evnt, flag, anchor, pos0 )</a></li><li><a href="#_sub9" class="code">function stopDrag( h, evnt )</a></li><li><a href="#_sub10" class="code">function deleteFcn( h, evnt )</a></li><li><a href="#_sub11" class="code">function pos0 = getPos(), pos0=pos; end</a></li><li><a href="#_sub12" class="code">function setAr( ar1 ), ar=ar1; setPos(pos); end</a></li><li><a href="#_sub13" class="code">function setPosChnCb( f ), posChnCb=f; end</a></li><li><a href="#_sub14" class="code">function setPosSetCb( f ), posSetCb=f; end</a></li><li><a href="#_sub15" class="code">function setPosLock( b ), posLock=b; end</a></li><li><a href="#_sub16" class="code">function setSizLock( b ), sizLock=b; end</a></li><li><a href="#_sub17" class="code">function uistack1( varargin )</a></li></ul>

<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function [hRect,api] = imrectLite( hParent, pos, lims, ar, varargin )</a>
0002 <span class="comment">% A 'lite' version of imrect [OBSOLETE: use imrectRot].</span>
0003 <span class="comment">%</span>
0004 <span class="comment">% There are significant problems using imrect in a larger GUI, mostly</span>
0005 <span class="comment">% due to the fact that imrect is such a heavy object.  This creates a</span>
0006 <span class="comment">% simple, fast, and in some ways nicer version of imrect.</span>
0007 <span class="comment">%</span>
0008 <span class="comment">% The implementation uses two graphics object: a rectangle and a patch.</span>
0009 <span class="comment">% The patch is just there to catch mouse clicks in case the rectangle does</span>
0010 <span class="comment">% not have a face color.  Any valid property of the rectangle may be</span>
0011 <span class="comment">% altered (such as 'FaceColor', 'Curvature', ... ), EXCEPT for its</span>
0012 <span class="comment">% 'ButtonDownFcn', 'DeleteFcn' and 'Position' properties.  To change the</span>
0013 <span class="comment">% 'Position' of the rectangle, use the output structure 'api' (described</span>
0014 <span class="comment">% below).</span>
0015 <span class="comment">%</span>
0016 <span class="comment">% USAGE</span>
0017 <span class="comment">%  [hRect,api] = imrectLite( [hParent],[pos],[lims],[ar],[varargin] )</span>
0018 <span class="comment">%</span>
0019 <span class="comment">% INPUTS</span>
0020 <span class="comment">%  hParent    - [gca] object parent, typically an axes object (gca)</span>
0021 <span class="comment">%  pos        - [] initial pos vector [x y w h] or [] or [x0 y0]</span>
0022 <span class="comment">%  lims       - [] 2x2 matrix of [xMin xMax; yMin yMax]</span>
0023 <span class="comment">%  ar         - [0] aspect ratio (if positive w/h is constrained to ar)</span>
0024 <span class="comment">%  varargin   - [] parameters to RECTANGLE graphics object</span>
0025 <span class="comment">%</span>
0026 <span class="comment">% OUTPUTS</span>
0027 <span class="comment">%  hRect      - handle to rectangle, use to alter color etc.</span>
0028 <span class="comment">%  api        - interface allowing access to created object</span>
0029 <span class="comment">%  .getPos()       - get position - returns 4 elt pos</span>
0030 <span class="comment">%  .setPos(pos)    - set position (while respecting constraints)</span>
0031 <span class="comment">%  .setAr(ar)      - set aspect ratio to fixed value</span>
0032 <span class="comment">%  .setPosLock(b)  - if lock set (b==true), rectangle cannot change</span>
0033 <span class="comment">%  .setSizLock(b)  - if lock set (b==true), rectangle cannot change size</span>
0034 <span class="comment">%  .setPosChnCb(f) - whenever pos changes (even slightly), calls f(pos)</span>
0035 <span class="comment">%  .setPosSetCb(f) - whenever pos finished changing, calls f(pos)</span>
0036 <span class="comment">%  .uistack(...)   - calls 'uistack( [hRect hPatch], ... )', see uistack</span>
0037 <span class="comment">%</span>
0038 <span class="comment">% EXAMPLE</span>
0039 <span class="comment">%  figure(1), imshow cameraman.tif</span>
0040 <span class="comment">%  rectProp = {'EdgeColor','g','LineWidth',4,'Curvature',[.1 .1]};</span>
0041 <span class="comment">%  lims = [get(gca,'xLim'); get(gca,'yLim')];</span>
0042 <span class="comment">%  [h,api] = imrectLite( gca, [], lims, [],  rectProp{:} );</span>
0043 <span class="comment">%  api.setPosChnCb( @(pos) disp(['        ' num2str(pos)]) );</span>
0044 <span class="comment">%  api.setPosSetCb( @(pos) disp(['FINAL = ' num2str(pos)]) );</span>
0045 <span class="comment">%</span>
0046 <span class="comment">% See also IMRECT, RECTANGLE, PATCH</span>
0047 <span class="comment">%</span>
0048 <span class="comment">% Piotr's Image&amp;Video Toolbox      Version 2.35</span>
0049 <span class="comment">% Copyright 2012 Piotr Dollar.  [pdollar-at-caltech.edu]</span>
0050 <span class="comment">% Please email me if you find bugs, or have suggestions or questions!</span>
0051 <span class="comment">% Licensed under the Simplified BSD License [see external/bsd.txt]</span>
0052 
0053 <span class="comment">% default arguments / globals</span>
0054 <span class="keyword">if</span>( nargin&lt;1 || isempty(hParent) ); hParent=gca; <span class="keyword">end</span>
0055 <span class="keyword">if</span>( nargin&lt;2 ); pos=[]; <span class="keyword">end</span>
0056 <span class="keyword">if</span>( nargin&lt;3 ); lims=[]; <span class="keyword">end</span>
0057 <span class="keyword">if</span>( nargin&lt;4 || isempty(ar) ); ar=0; <span class="keyword">end</span>
0058 [posChnCb,posSetCb]=deal([]);
0059 posLock=false; sizLock=false; minSiz=1;
0060 
0061 <span class="comment">% get figure and axes handles</span>
0062 hAx = ancestor(hParent,<span class="string">'axes'</span>); assert(~isempty(hAx));
0063 hFig = ancestor(hAx,<span class="string">'figure'</span>); assert(~isempty(hFig));
0064 set( hFig, <span class="string">'CurrentAxes'</span>, hAx );
0065 
0066 <span class="comment">% create rectangle as well as patch objects</span>
0067 <span class="keyword">if</span>(isempty(pos)); vis=<span class="string">'off'</span>; <span class="keyword">else</span> vis=<span class="string">'on'</span>; <span class="keyword">end</span>
0068 hPatch = patch(<span class="string">'FaceColor'</span>,<span class="string">'none'</span>,<span class="string">'EdgeColor'</span>,<span class="string">'none'</span>);
0069 hRect = rectangle(varargin{:},<span class="string">'Visible'</span>,vis);
0070 set([hRect hPatch],<span class="string">'ButtonDownFcn'</span>,{@<a href="#_sub7" class="code" title="subfunction btnDwn( h, evnt, flag )">btnDwn</a>,0},<span class="string">'DeleteFcn'</span>,@<a href="#_sub10" class="code" title="subfunction deleteFcn( h, evnt ) ">deleteFcn</a>);
0071 
0072 <span class="comment">% set / get position</span>
0073 <span class="keyword">if</span>(length(pos)==4), <a href="#_sub1" class="code" title="subfunction setPos( posNew, varargin )">setPos</a>(pos); <span class="keyword">else</span>
0074   <a href="#_sub7" class="code" title="subfunction btnDwn( h, evnt, flag )">btnDwn</a>([],[],-1); waitfor(hFig,<span class="string">'WindowButtonUpFcn'</span>,<span class="string">''</span>);
0075 <span class="keyword">end</span>
0076 
0077 <span class="comment">% create api</span>
0078 api = struct(<span class="string">'getPos'</span>,@<a href="#_sub11" class="code" title="subfunction pos0 = getPos(), pos0=pos; end">getPos</a>, <span class="string">'setPos'</span>,@<a href="#_sub1" class="code" title="subfunction setPos( posNew, varargin )">setPos</a>, <span class="keyword">...</span>
0079   <span class="string">'setPosChnCb'</span>,@setPosChnCb, <span class="string">'setPosSetCb'</span>,@setPosSetCb, <span class="keyword">...</span>
0080   <span class="string">'setPosLock'</span>,@setPosLock, <span class="string">'setSizLock'</span>,@setSizLock, <span class="keyword">...</span>
0081   <span class="string">'setAr'</span>,@setAr, <span class="string">'uistack'</span>,@<a href="#_sub17" class="code" title="subfunction uistack1( varargin )">uistack1</a> );
0082 
0083 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0084 
0085   <a name="_sub1" href="#_subfunctions" class="code">function setPos( posNew, varargin )</a>
0086     <span class="keyword">if</span>(isempty(hRect) || isempty(hPatch)); <span class="keyword">return</span>; <span class="keyword">end</span>
0087     <span class="comment">% constrain position to fall within lims</span>
0088     pos = <a href="#_sub2" class="code" title="subfunction pos = constrainPos( pos, anchor, pos0 )">constrainPos</a>( posNew, varargin{:} );
0089     <span class="comment">% compute rectangle vertices</span>
0090     xs = pos([1 1 1 1]); xs(2:3)=xs(2:3)+pos(3);
0091     ys = pos([2 2 2 2]); ys(3:4)=ys(3:4)+pos(4);
0092     vert = [xs' ys' [1;1;1;1]]; face=1:4;
0093     <span class="comment">% draw objects</span>
0094     set(hPatch,<span class="string">'Faces'</span>,face,<span class="string">'Vertices'</span>,vert);
0095     set(hRect,<span class="string">'Position'</span>,pos);
0096   <span class="keyword">end</span>
0097 
0098   <a name="_sub2" href="#_subfunctions" class="code">function pos = constrainPos( pos, anchor, pos0 )</a>
0099     <span class="comment">% constrain position to fall within lims</span>
0100     <span class="keyword">if</span>( ~isempty(lims) )
0101       posStr=pos(1:2);  posEnd=pos(1:2)+pos(3:4);
0102       posStr = min( max(posStr,lims(1:2)), lims(3:4)-minSiz );
0103       posEnd = max( min(posEnd,lims(3:4)), posStr+minSiz );
0104       pos = [posStr posEnd-posStr];
0105     <span class="keyword">end</span>
0106     
0107     <span class="comment">% now constrain for aspect ratio</span>
0108     <span class="keyword">if</span>( ar&lt;=0 ); <span class="keyword">return</span>; <span class="keyword">end</span>;
0109     w=pos(3); h=pos(4);
0110     <span class="keyword">if</span>( nargin&lt;3 )
0111       w = min( w, h*ar );
0112       h = min( h, w/ar );
0113       pos(3:4) = [w h];
0114     <span class="keyword">else</span>
0115       <span class="keyword">if</span>( isempty(lims) )
0116         <span class="keyword">if</span>( anchor(1)==0 ); w=h*ar; <span class="keyword">else</span> h=w/ar; <span class="keyword">end</span>;
0117       <span class="keyword">else</span>
0118         mid = pos(1:2) + pos(3:4)/2;
0119         lr=<span class="string">'MRL'</span>; lr=lr(sign(anchor(1)-pos(1))+2);
0120         tb=<span class="string">'MBT'</span>; tb=tb(sign(anchor(2)-pos(2))+2);
0121         <span class="keyword">if</span>( strcmp(tb,<span class="string">'M'</span>) )
0122           maxH=min(lims(4)-mid(2), mid(2)-lims(2))*2;
0123           <span class="keyword">switch</span> lr
0124             <span class="keyword">case</span> <span class="string">'L'</span>; maxW=min(lims(3)-pos(1),maxH*ar);
0125             <span class="keyword">case</span> <span class="string">'R'</span>; maxW=min(pos(1)+pos(3)-lims(1),maxH*ar);
0126           <span class="keyword">end</span>
0127           w=min(w,maxW); h=w/ar;
0128         <span class="keyword">else</span>
0129           <span class="keyword">switch</span> lr
0130             <span class="keyword">case</span> <span class="string">'L'</span>; maxW=pos(1)+pos(3)-lims(1);
0131             <span class="keyword">case</span> <span class="string">'M'</span>; maxW=min(lims(3)-mid(1), mid(1)-lims(1))*2;
0132             <span class="keyword">case</span> <span class="string">'R'</span>; maxW=lims(3)-pos(1);
0133           <span class="keyword">end</span>
0134           maxH=min(pos(2)+pos(4)-lims(2),maxW/ar);
0135         <span class="keyword">end</span>
0136         h=min(h,maxH); w=h*ar;
0137       <span class="keyword">end</span>
0138       <span class="keyword">if</span>( strcmp(lr,<span class="string">'M'</span>) )
0139         pos0(1)=pos0(1)-(w-pos0(3))/2; pos0(3)=w;
0140       <span class="keyword">elseif</span>( strcmp(tb,<span class="string">'M'</span>) )
0141         pos0(2)=pos0(2)-(h-pos0(4))/2; pos0(4)=h;
0142       <span class="keyword">end</span>
0143       sgnSiz = [w h] .* (2*(pos(1:2)==anchor)-1);
0144       pos = <a href="#_sub3" class="code" title="subfunction pos = shiftPos( anchor, pos0, del )">shiftPos</a>( anchor, pos0, sgnSiz );
0145     <span class="keyword">end</span>
0146   <span class="keyword">end</span>
0147 
0148   <a name="_sub3" href="#_subfunctions" class="code">function pos = shiftPos( anchor, pos0, del )</a>
0149     <span class="comment">% shift pos by del unless anchor(i)==0</span>
0150     pos = pos0;
0151     <span class="keyword">for</span> i=1:2, <span class="keyword">if</span>(anchor(i)==0), <span class="keyword">continue</span>; <span class="keyword">end</span>
0152       pos(i)=anchor(i); pos(i+2)=max(minSiz,abs(del(i)));
0153       <span class="keyword">if</span>(del(i)&lt;0); pos(i)=pos(i)-pos(i+2); <span class="keyword">end</span>;
0154     <span class="keyword">end</span>
0155   <span class="keyword">end</span>
0156 
0157 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0158 
0159   <a name="_sub4" href="#_subfunctions" class="code">function pnt = getCurPnt()</a>
0160     pnt = get(hAx,<span class="string">'CurrentPoint'</span>);
0161     pnt = pnt([1,3]);
0162   <span class="keyword">end</span>
0163 
0164   <a name="_sub5" href="#_subfunctions" class="code">function d = axisUnitsPerCentimeter()</a>
0165     <span class="comment">% approximage absolute axes size</span>
0166     units=get(hAx,<span class="string">'units'</span>);
0167     set(hAx,<span class="string">'units'</span>,<span class="string">'centimeters'</span>);
0168     cms = get(hAx,<span class="string">'Position'</span>);
0169     cms = max(cms(3:4));
0170     set(hAx,<span class="string">'units'</span>,units);
0171     <span class="comment">% axes size in axes units</span>
0172     xLim=get(gca,<span class="string">'xLim'</span>); yLim=get(gca,<span class="string">'yLim'</span>);
0173     sizInner = max([xLim(2)-xLim(1),yLim(2)-yLim(1)]);
0174     <span class="comment">% units per centemeter</span>
0175     d = sizInner/cms;
0176   <span class="keyword">end</span>
0177 
0178   <a name="_sub6" href="#_subfunctions" class="code">function [anchor,cursor] = getSide( pnt )</a>
0179     <span class="comment">% get pnt in coordintates of center of rectangle</span>
0180     rs=pos(3:4)/2; pnt=pnt-pos(1:2)-rs;
0181     <span class="comment">% side(i) -1=near lf/tp bnd; 0=in center; +1:near rt/bt bnd</span>
0182     t = <a href="#_sub5" class="code" title="subfunction d = axisUnitsPerCentimeter()">axisUnitsPerCentimeter</a>()*.15; side=[0 0];
0183     <span class="keyword">for</span> i=1:2
0184       ti = min(t,rs(i)/2);
0185       <span class="keyword">if</span>( pnt(i)&lt;-rs(i)+ti ), side(i)=-1; <span class="comment">% near lf/tp boundary</span>
0186       <span class="keyword">elseif</span>( pnt(i)&gt;rs(i)-ti), side(i)=1; <span class="comment">% near rt/bt boundary</span>
0187       <span class="keyword">end</span>
0188     <span class="keyword">end</span>
0189     <span class="comment">% compute anchor in orig coord system(opposite of selected side)</span>
0190     anchor=-side.*rs+pos(1:2)+rs; anchor(side==0)=0;
0191     <span class="comment">% select cursor based on position</span>
0192     cs={<span class="string">'bottom'</span>,<span class="string">'botr'</span>,<span class="string">'right'</span>,<span class="string">'topr'</span>,<span class="string">'top'</span>,<span class="string">'topl'</span>,<span class="string">'left'</span>,<span class="string">'botl'</span>};
0193     a=mod(round((atan2(side(1),side(2))/pi)*4),8)+1; cursor=cs{a};
0194   <span class="keyword">end</span>
0195 
0196   <a name="_sub7" href="#_subfunctions" class="code">function btnDwn( h, evnt, flag )</a>
0197     <span class="keyword">if</span>(isempty(hRect) || isempty(hPatch)); <span class="keyword">return</span>; <span class="keyword">end</span>;
0198     <span class="keyword">if</span>(posLock); <span class="keyword">return</span>; <span class="keyword">end</span>; <span class="keyword">if</span>(sizLock); flag=1; <span class="keyword">end</span>;
0199     <span class="keyword">if</span>( flag==-1 ) <span class="comment">% create new rectangle</span>
0200       <span class="keyword">if</span>(isempty(pos)), anchor=ginput(1); <span class="keyword">else</span> anchor=pos(1:2); <span class="keyword">end</span>
0201       <a href="#_sub1" class="code" title="subfunction setPos( posNew, varargin )">setPos</a>( [anchor 1 1] );
0202       set(hRect,<span class="string">'Visible'</span>,<span class="string">'on'</span>); cursor=<span class="string">'botr'</span>; flag=0;
0203     <span class="keyword">elseif</span>( flag==0 ) <span class="comment">% resize (or possibly drag) rectangle</span>
0204       pnt=<a href="#_sub4" class="code" title="subfunction pnt = getCurPnt()">getCurPnt</a>(); [anchor,cursor] = <a href="#_sub6" class="code" title="subfunction [anchor,cursor] = getSide( pnt )">getSide</a>( pnt );
0205       <span class="keyword">if</span>(all(anchor==0)), <a href="#_sub7" class="code" title="subfunction btnDwn( h, evnt, flag )">btnDwn</a>(h,evnt,1); <span class="keyword">return</span>; <span class="keyword">end</span>
0206     <span class="keyword">elseif</span>( flag==1 ) <span class="comment">% move rectangle</span>
0207       anchor=<a href="#_sub4" class="code" title="subfunction pnt = getCurPnt()">getCurPnt</a>(); cursor=<span class="string">'fleur'</span>;
0208     <span class="keyword">else</span>
0209       assert(false);
0210     <span class="keyword">end</span>
0211     set( hFig, <span class="string">'Pointer'</span>, cursor );
0212     set( hFig, <span class="string">'WindowButtonMotionFcn'</span>,{@<a href="#_sub8" class="code" title="subfunction drag( h, evnt, flag, anchor, pos0 ) ">drag</a>,flag,anchor,pos} );
0213     set( hFig, <span class="string">'WindowButtonUpFcn'</span>, @<a href="#_sub9" class="code" title="subfunction stopDrag( h, evnt ) ">stopDrag</a> );
0214   <span class="keyword">end</span>
0215 
0216   <a name="_sub8" href="#_subfunctions" class="code">function drag( h, evnt, flag, anchor, pos0 ) </a><span class="comment">%#ok&lt;INUSL&gt;</span>
0217     <span class="keyword">if</span>(isempty(hRect) || isempty(hPatch)); <span class="keyword">return</span>; <span class="keyword">end</span>;
0218     pnt = <a href="#_sub4" class="code" title="subfunction pnt = getCurPnt()">getCurPnt</a>(); del = pnt-anchor;
0219     <span class="keyword">if</span>( flag==1 ) <span class="comment">% shift rectangle by del</span>
0220       <a href="#_sub1" class="code" title="subfunction setPos( posNew, varargin )">setPos</a>( [pos0(1:2)+del pos0(3:4)] );
0221     <span class="keyword">else</span> <span class="comment">% resize rectangle</span>
0222       <a href="#_sub1" class="code" title="subfunction setPos( posNew, varargin )">setPos</a>(<a href="#_sub3" class="code" title="subfunction pos = shiftPos( anchor, pos0, del )">shiftPos</a>(anchor,pos0,del),anchor,pos0);
0223     <span class="keyword">end</span>
0224     drawnow
0225     <span class="keyword">if</span>(~isempty(posChnCb)); posChnCb(pos); <span class="keyword">end</span>;
0226   <span class="keyword">end</span>
0227 
0228   <a name="_sub9" href="#_subfunctions" class="code">function stopDrag( h, evnt ) </a><span class="comment">%#ok&lt;INUSD&gt;</span>
0229     set( hFig, <span class="string">'WindowButtonMotionFcn'</span>,<span class="string">''</span>);
0230     set( hFig, <span class="string">'WindowButtonUpFcn'</span>,<span class="string">''</span>);
0231     set( hFig, <span class="string">'Pointer'</span>, <span class="string">'arrow'</span> );
0232     <span class="keyword">if</span>(~isempty(posSetCb)); posSetCb(pos); <span class="keyword">end</span>;
0233   <span class="keyword">end</span>
0234 
0235   <a name="_sub10" href="#_subfunctions" class="code">function deleteFcn( h, evnt ) </a><span class="comment">%#ok&lt;INUSD&gt;</span>
0236     [posChnCb,posSetCb]=deal([]); hs=[hPatch hRect];
0237     <span class="keyword">for</span> i=1:length(hs), <span class="keyword">if</span>(ishandle(hs(i))); delete(hs(i)); <span class="keyword">end</span>; <span class="keyword">end</span>
0238     [hRect,hPatch]=deal([]);
0239   <span class="keyword">end</span>
0240 
0241 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0242 
0243   <a name="_sub11" href="#_subfunctions" class="code">function pos0 = getPos(), pos0=pos; end</a>
0244 
0245   <a name="_sub12" href="#_subfunctions" class="code">function setAr( ar1 ), ar=ar1; setPos(pos); end</a>
0246 
0247   <a name="_sub13" href="#_subfunctions" class="code">function setPosChnCb( f ), posChnCb=f; end</a>
0248 
0249   <a name="_sub14" href="#_subfunctions" class="code">function setPosSetCb( f ), posSetCb=f; end</a>
0250 
0251   <a name="_sub15" href="#_subfunctions" class="code">function setPosLock( b ), posLock=b; end</a>
0252 
0253   <a name="_sub16" href="#_subfunctions" class="code">function setSizLock( b ), sizLock=b; end</a>
0254 
0255   <a name="_sub17" href="#_subfunctions" class="code">function uistack1( varargin )</a>
0256     <span class="keyword">if</span>(isempty(hRect) || isempty(hPatch)); <span class="keyword">return</span>; <span class="keyword">end</span>;
0257     uistack( [hRect hPatch], varargin{:} );
0258   <span class="keyword">end</span>
0259 
0260 <span class="keyword">end</span></pre></div>
<hr><address>Generated on Thu 05-May-2022 14:52:24 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>