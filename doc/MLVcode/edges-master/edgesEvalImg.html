<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of edgesEvalImg</title>
  <meta name="keywords" content="edgesEvalImg">
  <meta name="description" content="Calculate edge precision/recall results for single edge image.">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../index.html">Home</a> &gt;  <a href="../index.html">MLVcode</a> &gt; <a href="index.html">edges-master</a> &gt; edgesEvalImg.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../index.html"><img alt="<" border="0" src="../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for MLVcode\edges-master&nbsp;<img alt=">" border="0" src="../../right.png"></a></td></tr></table>-->

<h1>edgesEvalImg
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>Calculate edge precision/recall results for single edge image.</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>function [thrs,cntR,sumR,cntP,sumP,V] = edgesEvalImg( E, G, varargin ) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre class="comment"> Calculate edge precision/recall results for single edge image.

 Enhanced replacement for evaluation_bdry_image() from BSDS500 code:
  http://www.eecs.berkeley.edu/Research/Projects/CS/vision/grouping/
 Uses same format and is fully compatible with evaluation_bdry_image.
 Given default prms results are *identical* to evaluation_bdry_image.

 In addition to performing the evaluation, this function can optionally
 create a visualization of the matches and errors for a given edge result.
 The visualization of edge matches V has the following color coding:
  green=true positive, blue=false positive, red=false negative
 If multiple ground truth labels are given the false negatives have
 varying strength (and true positives can match *any* ground truth).

 This function calls the mex file correspondPixels. Pre-compiled binaries
 for some systems are provided in /private, source for correspondPixels is
 available as part of the BSDS500 dataset (see link above). Note:
 correspondPixels is computationally expensive and very slow in practice.

 USAGE
  [thrs,cntR,sumR,cntP,sumP,V] = edgesEvalImg( E, G, [prms] )

 INPUTS
  E          - [h x w] edge probability map (may be a filename)
  G          - file containing a cell of ground truth boundaries
  prms       - parameters (struct or name/value pairs)
   .out        - [''] optional output file for writing results
   .thrs       - [99] number or vector of thresholds for evaluation
   .maxDist    - [.0075] maximum tolerance for edge match
   .thin       - [1] if true thin boundary maps

 OUTPUTS
  thrs       - [Kx1] vector of threshold values
  cntR,sumR  - [Kx1] ratios give recall per threshold
  cntP,sumP  - [Kx1] ratios give precision per threshold
  V          - [hxwx3xK] visualization of edge matches

 EXAMPLE

 See also <a href="edgesEvalDir.html" class="code" title="function varargout = edgesEvalDir( varargin )">edgesEvalDir</a>

 Structured Edge Detection Toolbox      Version 3.01
 Code written by Piotr Dollar, 2014.
 Licensed under the MSR-LA Full Rights License [see license.txt]</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../matlabicon.gif)">
</ul>
This function is called by:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="edgesEvalDir.html" class="code" title="function varargout = edgesEvalDir( varargin )">edgesEvalDir</a>	Calculate edge precision/recall results for directory of edge images.</li></ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function [thrs,cntR,sumR,cntP,sumP,V] = edgesEvalImg( E, G, varargin )</a>
0002 <span class="comment">% Calculate edge precision/recall results for single edge image.</span>
0003 <span class="comment">%</span>
0004 <span class="comment">% Enhanced replacement for evaluation_bdry_image() from BSDS500 code:</span>
0005 <span class="comment">%  http://www.eecs.berkeley.edu/Research/Projects/CS/vision/grouping/</span>
0006 <span class="comment">% Uses same format and is fully compatible with evaluation_bdry_image.</span>
0007 <span class="comment">% Given default prms results are *identical* to evaluation_bdry_image.</span>
0008 <span class="comment">%</span>
0009 <span class="comment">% In addition to performing the evaluation, this function can optionally</span>
0010 <span class="comment">% create a visualization of the matches and errors for a given edge result.</span>
0011 <span class="comment">% The visualization of edge matches V has the following color coding:</span>
0012 <span class="comment">%  green=true positive, blue=false positive, red=false negative</span>
0013 <span class="comment">% If multiple ground truth labels are given the false negatives have</span>
0014 <span class="comment">% varying strength (and true positives can match *any* ground truth).</span>
0015 <span class="comment">%</span>
0016 <span class="comment">% This function calls the mex file correspondPixels. Pre-compiled binaries</span>
0017 <span class="comment">% for some systems are provided in /private, source for correspondPixels is</span>
0018 <span class="comment">% available as part of the BSDS500 dataset (see link above). Note:</span>
0019 <span class="comment">% correspondPixels is computationally expensive and very slow in practice.</span>
0020 <span class="comment">%</span>
0021 <span class="comment">% USAGE</span>
0022 <span class="comment">%  [thrs,cntR,sumR,cntP,sumP,V] = edgesEvalImg( E, G, [prms] )</span>
0023 <span class="comment">%</span>
0024 <span class="comment">% INPUTS</span>
0025 <span class="comment">%  E          - [h x w] edge probability map (may be a filename)</span>
0026 <span class="comment">%  G          - file containing a cell of ground truth boundaries</span>
0027 <span class="comment">%  prms       - parameters (struct or name/value pairs)</span>
0028 <span class="comment">%   .out        - [''] optional output file for writing results</span>
0029 <span class="comment">%   .thrs       - [99] number or vector of thresholds for evaluation</span>
0030 <span class="comment">%   .maxDist    - [.0075] maximum tolerance for edge match</span>
0031 <span class="comment">%   .thin       - [1] if true thin boundary maps</span>
0032 <span class="comment">%</span>
0033 <span class="comment">% OUTPUTS</span>
0034 <span class="comment">%  thrs       - [Kx1] vector of threshold values</span>
0035 <span class="comment">%  cntR,sumR  - [Kx1] ratios give recall per threshold</span>
0036 <span class="comment">%  cntP,sumP  - [Kx1] ratios give precision per threshold</span>
0037 <span class="comment">%  V          - [hxwx3xK] visualization of edge matches</span>
0038 <span class="comment">%</span>
0039 <span class="comment">% EXAMPLE</span>
0040 <span class="comment">%</span>
0041 <span class="comment">% See also edgesEvalDir</span>
0042 <span class="comment">%</span>
0043 <span class="comment">% Structured Edge Detection Toolbox      Version 3.01</span>
0044 <span class="comment">% Code written by Piotr Dollar, 2014.</span>
0045 <span class="comment">% Licensed under the MSR-LA Full Rights License [see license.txt]</span>
0046 
0047 <span class="comment">% get additional parameters</span>
0048 dfs={ <span class="string">'out'</span>,<span class="string">''</span>, <span class="string">'thrs'</span>,99, <span class="string">'maxDist'</span>,.0075, <span class="string">'thin'</span>,1 };
0049 [out,thrs,maxDist,thin] = getPrmDflt(varargin,dfs,1);
0050 <span class="keyword">if</span>(any(mod(thrs,1)&gt;0)), K=length(thrs); thrs=thrs(:); <span class="keyword">else</span>
0051   K=thrs; thrs=linspace(1/(K+1),1-1/(K+1),K)'; <span class="keyword">end</span>
0052 
0053 <span class="comment">% load edges (E) and ground truth (G)</span>
0054 <span class="keyword">if</span>(all(ischar(E))), E=double(imread(E))/255; <span class="keyword">end</span>
0055 G=load(G); G=G.groundTruth; n=length(G);
0056 <span class="keyword">for</span> g=1:n, G{g}=double(G{g}.Boundaries); <span class="keyword">end</span>
0057 
0058 <span class="comment">% evaluate edge result at each threshold</span>
0059 Z=zeros(K,1); cntR=Z; sumR=Z; cntP=Z; sumP=Z;
0060 <span class="keyword">if</span>(nargout&gt;=6), V=zeros([size(E) 3 K]); <span class="keyword">end</span>
0061 <span class="keyword">for</span> k = 1:K
0062   <span class="comment">% threshhold and thin E</span>
0063   E1 = double(E&gt;=max(eps,thrs(k)));
0064   <span class="keyword">if</span>(thin), E1=double(bwmorph(E1,<span class="string">'thin'</span>,inf)); <span class="keyword">end</span>
0065   <span class="comment">% compare to each ground truth in turn and accumualte</span>
0066   Z=zeros(size(E)); matchE=Z; matchG=Z; allG=Z;
0067   <span class="keyword">for</span> g = 1:n
0068     [matchE1,matchG1] = correspondPixels(E1,G{g},maxDist);
0069     matchE = matchE | matchE1&gt;0;
0070     matchG = matchG + double(matchG1&gt;0);
0071     allG = allG + G{g};
0072   <span class="keyword">end</span>
0073   <span class="comment">% compute recall (summed over each gt image)</span>
0074   cntR(k) = sum(matchG(:)); sumR(k) = sum(allG(:));
0075   <span class="comment">% compute precision (edges can match any gt image)</span>
0076   cntP(k) = nnz(matchE); sumP(k) = nnz(E1);
0077   <span class="comment">% optinally create visualization of matches</span>
0078   <span class="keyword">if</span>(nargout&lt;6), <span class="keyword">continue</span>; <span class="keyword">end</span>; cs=[1 0 0; 0 .7 0; .7 .8 1]; cs=cs-1;
0079   FP=E1-matchE; TP=matchE; FN=(allG-matchG)/n;
0080   <span class="keyword">for</span> g=1:3, V(:,:,g,k)=max(0,1+FN*cs(1,g)+TP*cs(2,g)+FP*cs(3,g)); <span class="keyword">end</span>
0081   V(:,2:<span class="keyword">end</span>,:,k) = min(V(:,2:<span class="keyword">end</span>,:,k),V(:,1:end-1,:,k));
0082   V(2:<span class="keyword">end</span>,:,:,k) = min(V(2:<span class="keyword">end</span>,:,:,k),V(1:end-1,:,:,k));
0083 <span class="keyword">end</span>
0084 
0085 <span class="comment">% if output file specified write results to disk</span>
0086 <span class="keyword">if</span>(isempty(out)), <span class="keyword">return</span>; <span class="keyword">end</span>; fid=fopen(out,<span class="string">'w'</span>); assert(fid~=1);
0087 fprintf(fid,<span class="string">'%10g %10g %10g %10g %10g\n'</span>,[thrs cntR sumR cntP sumP]');
0088 fclose(fid);
0089 
0090 <span class="keyword">end</span></pre></div>
<hr><address>Generated on Thu 05-May-2022 15:20:21 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>