<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of edgeBoxes</title>
  <meta name="keywords" content="edgeBoxes">
  <meta name="description" content="Generate Edge Boxes object proposals in given image(s).">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../index.html">Home</a> &gt;  <a href="../index.html">MLVcode</a> &gt; <a href="index.html">edges-master</a> &gt; edgeBoxes.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../index.html"><img alt="<" border="0" src="../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for MLVcode\edges-master&nbsp;<img alt=">" border="0" src="../../right.png"></a></td></tr></table>-->

<h1>edgeBoxes
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>Generate Edge Boxes object proposals in given image(s).</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>function bbs = edgeBoxes( I, model, varargin ) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre class="comment"> Generate Edge Boxes object proposals in given image(s).

 Compute Edge Boxes object proposals as described in:
  C. Lawrence Zitnick and Piotr Doll치r
  &quot;Edge Boxes: Locating Object Proposals from Edges&quot;, ECCV 2014.
 The proposal boxes are fast to compute and give state-of-the-art recall.
 Please cite the above paper if you end up using the code.

 The most important params are alpha and beta. The defaults are optimized
 for detecting boxes at intersection over union (IoU) of 0.7. For other
 settings of alpha/beta see the ECCV paper. In general larger alpha/beta
 improve results at higher IoU (but using large alpha can be quite slow).
 minScore/maxBoxes control the number of boxes returned and impact speed.
 Finally, a number of additional params listed below are set to reasonable
 defaults and in most cases should not need to be altered.

 We recently introduced an adaptive variant of nms that results in better
 Average Recall (AR) and also better subsequent detection performance.
 This variant is described in Section 5.E of the following paper:
  Jan Hosang, Rodrigo Benenson, Piotr Doll치r, and Bernt Schiele
  &quot;What makes for effective detection proposals?&quot;, arXiv 2015.
 TL;DR: to get top AR for 1000 boxes set alpha=.65, beta=.90, eta=.9996.

 For a faster version the proposal code runs at ~10 fps on average use:
  model.opts.sharpen=0; opts.alpha=.625; opts.minScore=.02;

 The code uses the Structured Edge Detector to compute edge strength and
 orientation. See edgesDetect.m for details. Alternatively, the code could
 be altered to use any other edge detector such as Canny.

 The input 'I' can either be a single (color) image (or filename) or a
 cell array of images (or filenames). In the first case, the return is a
 set of bbs where each row has the format [x y w h score] and score is the
 confidence of detection. If the input is a cell array, the output is a
 cell array where each element is a set of bbs in the form above (in this
 case a parfor loop is used to speed execution).

 USAGE
  opts = edgeBoxes()
  bbs = edgeBoxes( I, model, opts )

 INPUTS
  I          - input image(s) of filename(s) of input image(s)
  model      - Structured Edge model trained with edgesTrain
  opts       - parameters (struct or name/value pairs)
   (1) main parameters, see above for details
   .name           - [] target filename (if specified return is 1)
   .alpha          - [.65] step size of sliding window search
   .beta           - [.75] nms threshold for object proposals
   .eta            - [1.0] adaptation rate for nms threshold (see arXiv15)
   .minScore       - [.01] min score of boxes to detect
   .maxBoxes       - [1e4] max number of boxes to detect
   (2) additional parameters, safe to ignore and leave at default vals
   .edgeMinMag     - [.1] increase to trade off accuracy for speed
   .edgeMergeThr   - [.5] increase to trade off accuracy for speed
   .clusterMinMag  - [.5] increase to trade off accuracy for speed
   .maxAspectRatio - [3] max aspect ratio of boxes
   .minBoxArea     - [1000] minimum area of boxes
   .gamma          - [2] affinity sensitivity, see equation 1 in paper
   .kappa          - [1.5] scale sensitivity, see equation 3 in paper

 OUTPUTS
  bbs        - [nx5] array containing proposal bbs [x y w h score]

 EXAMPLE

 See also <a href="edgeBoxesDemo.html" class="code" title="">edgeBoxesDemo</a>, <a href="edgesDetect.html" class="code" title="function [E,O,inds,segs] = edgesDetect( I, model )">edgesDetect</a>

 Structured Edge Detection Toolbox      Version 3.01
 Code written by Piotr Dollar and Larry Zitnick, 2014.
 Licensed under the MSR-LA Full Rights License [see license.txt]</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="edgesDetect.html" class="code" title="function [E,O,inds,segs] = edgesDetect( I, model )">edgesDetect</a>	Detect edges in image.</li></ul>
This function is called by:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="edgeBoxesDemo.html" class="code" title="">edgeBoxesDemo</a>	Demo for Edge Boxes (please see readme.txt first).</li><li><a href="edgeBoxesSweeps.html" class="code" title="function edgeBoxesSweeps()">edgeBoxesSweeps</a>	Parameter sweeps for Edges Boxes object proposals.</li></ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="#_sub1" class="code">function bbs = edgeBoxesImg( I, model, o )</a></li></ul>

<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function bbs = edgeBoxes( I, model, varargin )</a>
0002 <span class="comment">% Generate Edge Boxes object proposals in given image(s).</span>
0003 <span class="comment">%</span>
0004 <span class="comment">% Compute Edge Boxes object proposals as described in:</span>
0005 <span class="comment">%  C. Lawrence Zitnick and Piotr Doll치r</span>
0006 <span class="comment">%  &quot;Edge Boxes: Locating Object Proposals from Edges&quot;, ECCV 2014.</span>
0007 <span class="comment">% The proposal boxes are fast to compute and give state-of-the-art recall.</span>
0008 <span class="comment">% Please cite the above paper if you end up using the code.</span>
0009 <span class="comment">%</span>
0010 <span class="comment">% The most important params are alpha and beta. The defaults are optimized</span>
0011 <span class="comment">% for detecting boxes at intersection over union (IoU) of 0.7. For other</span>
0012 <span class="comment">% settings of alpha/beta see the ECCV paper. In general larger alpha/beta</span>
0013 <span class="comment">% improve results at higher IoU (but using large alpha can be quite slow).</span>
0014 <span class="comment">% minScore/maxBoxes control the number of boxes returned and impact speed.</span>
0015 <span class="comment">% Finally, a number of additional params listed below are set to reasonable</span>
0016 <span class="comment">% defaults and in most cases should not need to be altered.</span>
0017 <span class="comment">%</span>
0018 <span class="comment">% We recently introduced an adaptive variant of nms that results in better</span>
0019 <span class="comment">% Average Recall (AR) and also better subsequent detection performance.</span>
0020 <span class="comment">% This variant is described in Section 5.E of the following paper:</span>
0021 <span class="comment">%  Jan Hosang, Rodrigo Benenson, Piotr Doll치r, and Bernt Schiele</span>
0022 <span class="comment">%  &quot;What makes for effective detection proposals?&quot;, arXiv 2015.</span>
0023 <span class="comment">% TL;DR: to get top AR for 1000 boxes set alpha=.65, beta=.90, eta=.9996.</span>
0024 <span class="comment">%</span>
0025 <span class="comment">% For a faster version the proposal code runs at ~10 fps on average use:</span>
0026 <span class="comment">%  model.opts.sharpen=0; opts.alpha=.625; opts.minScore=.02;</span>
0027 <span class="comment">%</span>
0028 <span class="comment">% The code uses the Structured Edge Detector to compute edge strength and</span>
0029 <span class="comment">% orientation. See edgesDetect.m for details. Alternatively, the code could</span>
0030 <span class="comment">% be altered to use any other edge detector such as Canny.</span>
0031 <span class="comment">%</span>
0032 <span class="comment">% The input 'I' can either be a single (color) image (or filename) or a</span>
0033 <span class="comment">% cell array of images (or filenames). In the first case, the return is a</span>
0034 <span class="comment">% set of bbs where each row has the format [x y w h score] and score is the</span>
0035 <span class="comment">% confidence of detection. If the input is a cell array, the output is a</span>
0036 <span class="comment">% cell array where each element is a set of bbs in the form above (in this</span>
0037 <span class="comment">% case a parfor loop is used to speed execution).</span>
0038 <span class="comment">%</span>
0039 <span class="comment">% USAGE</span>
0040 <span class="comment">%  opts = edgeBoxes()</span>
0041 <span class="comment">%  bbs = edgeBoxes( I, model, opts )</span>
0042 <span class="comment">%</span>
0043 <span class="comment">% INPUTS</span>
0044 <span class="comment">%  I          - input image(s) of filename(s) of input image(s)</span>
0045 <span class="comment">%  model      - Structured Edge model trained with edgesTrain</span>
0046 <span class="comment">%  opts       - parameters (struct or name/value pairs)</span>
0047 <span class="comment">%   (1) main parameters, see above for details</span>
0048 <span class="comment">%   .name           - [] target filename (if specified return is 1)</span>
0049 <span class="comment">%   .alpha          - [.65] step size of sliding window search</span>
0050 <span class="comment">%   .beta           - [.75] nms threshold for object proposals</span>
0051 <span class="comment">%   .eta            - [1.0] adaptation rate for nms threshold (see arXiv15)</span>
0052 <span class="comment">%   .minScore       - [.01] min score of boxes to detect</span>
0053 <span class="comment">%   .maxBoxes       - [1e4] max number of boxes to detect</span>
0054 <span class="comment">%   (2) additional parameters, safe to ignore and leave at default vals</span>
0055 <span class="comment">%   .edgeMinMag     - [.1] increase to trade off accuracy for speed</span>
0056 <span class="comment">%   .edgeMergeThr   - [.5] increase to trade off accuracy for speed</span>
0057 <span class="comment">%   .clusterMinMag  - [.5] increase to trade off accuracy for speed</span>
0058 <span class="comment">%   .maxAspectRatio - [3] max aspect ratio of boxes</span>
0059 <span class="comment">%   .minBoxArea     - [1000] minimum area of boxes</span>
0060 <span class="comment">%   .gamma          - [2] affinity sensitivity, see equation 1 in paper</span>
0061 <span class="comment">%   .kappa          - [1.5] scale sensitivity, see equation 3 in paper</span>
0062 <span class="comment">%</span>
0063 <span class="comment">% OUTPUTS</span>
0064 <span class="comment">%  bbs        - [nx5] array containing proposal bbs [x y w h score]</span>
0065 <span class="comment">%</span>
0066 <span class="comment">% EXAMPLE</span>
0067 <span class="comment">%</span>
0068 <span class="comment">% See also edgeBoxesDemo, edgesDetect</span>
0069 <span class="comment">%</span>
0070 <span class="comment">% Structured Edge Detection Toolbox      Version 3.01</span>
0071 <span class="comment">% Code written by Piotr Dollar and Larry Zitnick, 2014.</span>
0072 <span class="comment">% Licensed under the MSR-LA Full Rights License [see license.txt]</span>
0073 
0074 <span class="comment">% get default parameters (unimportant parameters are undocumented)</span>
0075 dfs={<span class="string">'name'</span>,<span class="string">''</span>, <span class="string">'alpha'</span>,.65, <span class="string">'beta'</span>,.75, <span class="string">'eta'</span>,1, <span class="string">'minScore'</span>,.01, <span class="keyword">...</span>
0076   <span class="string">'maxBoxes'</span>,1e4, <span class="string">'edgeMinMag'</span>,.1, <span class="string">'edgeMergeThr'</span>,.5,<span class="string">'clusterMinMag'</span>,.5,<span class="keyword">...</span>
0077   <span class="string">'maxAspectRatio'</span>,3, <span class="string">'minBoxArea'</span>,1000, <span class="string">'gamma'</span>,2, <span class="string">'kappa'</span>,1.5 };
0078 o=getPrmDflt(varargin,dfs,1); <span class="keyword">if</span>(nargin==0), bbs=o; <span class="keyword">return</span>; <span class="keyword">end</span>
0079 
0080 <span class="comment">% run detector possibly over multiple images and optionally save results</span>
0081 f=o.name; <span class="keyword">if</span>(~isempty(f) &amp;&amp; exist(f,<span class="string">'file'</span>)), bbs=1; <span class="keyword">return</span>; <span class="keyword">end</span>
0082 <span class="keyword">if</span>(~iscell(I)), bbs=<a href="#_sub1" class="code" title="subfunction bbs = edgeBoxesImg( I, model, o )">edgeBoxesImg</a>(I,model,o); <span class="keyword">else</span> n=length(I);
0083   bbs=cell(n,1); parfor i=1:n, bbs{i}=<a href="#_sub1" class="code" title="subfunction bbs = edgeBoxesImg( I, model, o )">edgeBoxesImg</a>(I{i},model,o); <span class="keyword">end</span>; <span class="keyword">end</span>
0084 d=fileparts(f); <span class="keyword">if</span>(~isempty(d)&amp;&amp;~exist(d,<span class="string">'dir'</span>)), mkdir(d); <span class="keyword">end</span>
0085 <span class="keyword">if</span>(~isempty(f)), save(f,<span class="string">'bbs'</span>); bbs=1; <span class="keyword">end</span>
0086 
0087 <span class="keyword">end</span>
0088 
0089 <a name="_sub1" href="#_subfunctions" class="code">function bbs = edgeBoxesImg( I, model, o )</a>
0090 <span class="comment">% Generate Edge Boxes object proposals in single image.</span>
0091 <span class="keyword">if</span>(all(ischar(I))), I=imread(I); <span class="keyword">end</span>
0092 model.opts.nms=0; [E,O]=<a href="edgesDetect.html" class="code" title="function [E,O,inds,segs] = edgesDetect( I, model )">edgesDetect</a>(I,model);
0093 <span class="keyword">if</span>(0), E=gradientMag(convTri(single(I),4)); E=E/max(E(:)); <span class="keyword">end</span>
0094 E=edgesNmsMex(E,O,2,0,1,model.opts.nThreads);
0095 bbs=edgeBoxesMex(E,O,o.alpha,o.beta,o.eta,o.minScore,o.maxBoxes,<span class="keyword">...</span>
0096   o.edgeMinMag,o.edgeMergeThr,o.clusterMinMag,<span class="keyword">...</span>
0097   o.maxAspectRatio,o.minBoxArea,o.gamma,o.kappa);
0098 <span class="keyword">end</span></pre></div>
<hr><address>Generated on Thu 05-May-2022 15:20:21 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>