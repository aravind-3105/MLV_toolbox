<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of boxesEval</title>
  <meta name="keywords" content="boxesEval">
  <meta name="description" content="Perform object proposal bounding box evaluation and plot results.">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../index.html">Home</a> &gt;  <a href="../index.html">MLVcode</a> &gt; <a href="index.html">edges-master</a> &gt; boxesEval.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../index.html"><img alt="<" border="0" src="../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for MLVcode\edges-master&nbsp;<img alt=">" border="0" src="../../right.png"></a></td></tr></table>-->

<h1>boxesEval
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>Perform object proposal bounding box evaluation and plot results.</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>function recall = boxesEval( varargin ) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre class="comment"> Perform object proposal bounding box evaluation and plot results.

 boxesEval evaluates a set bounding box object proposals on the dataset
 specified by the 'data' parameter (which is generated by boxesData.m).
 The methods are specified by the vector 'names'. For each method the
 boxes must be stored in the file [resDir '/' name '-' data.split]. Each
 file should contain a single cell array 'bbs' of length n, with one set
 of bbs per image, where each matrix row has the format [x y w h score].
 Here score is the confidence of detection but if the boxes are sorted the
 score may be the same for every box. edgeBoxes.m stores results in this
 format by default, other methods can easily be converted to this format.

 For every method, evaluation is performed at every threshold in 'thrs'
 and every proposal count in 'cnts'. Two plots may be generated. If
 |cnts|&gt;1 creates a plot with count on x-axis (and plots a separate set of
 curves for each threshold if necessary). If |thrs|&gt;1 creates a plot with
 thresholds on x-axis (and plots a separate set of curves for each count).

 USAGE
  recall = boxesEval( opts )

 INPUTS
  opts       - parameters (struct or name/value pairs)
   .data       - ['REQ'] data on which to evaluate (see boxesData.m)
   .names      - ['REQ'] string cell array of object proposal methods
   .resDir     - ['boxes/'] location for results and evaluation
   .thrs       - [.7] IoU threshold(s) to use for evaluation
   .cnts       - [...] propsal count(s) to use for evaluation
   .maxn       - [inf] maximum number of images to use for evaluation
   .show       - [1] figure for plotting results
   .fName      - [''] optional filename for saving plots/recall to disk
   .col        - [...] color(s) for plotting each method's results

 OUTPUTS
  recall     - [MxTxK] recall for each count/threshold/method

 EXAMPLE

 See also <a href="edgeBoxesDemo.html" class="code" title="">edgeBoxesDemo</a>, <a href="edgeBoxes.html" class="code" title="function bbs = edgeBoxes( I, model, varargin )">edgeBoxes</a>, <a href="boxesData.html" class="code" title="function data = boxesData( varargin )">boxesData</a>, bbGt

 Structured Edge Detection Toolbox      Version 3.01
 Code written by Piotr Dollar and Larry Zitnick, 2014.
 Licensed under the MSR-LA Full Rights License [see license.txt]</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../matlabicon.gif)">
</ul>
This function is called by:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="edgeBoxesDemo.html" class="code" title="">edgeBoxesDemo</a>	Demo for Edge Boxes (please see readme.txt first).</li><li><a href="edgeBoxesSweeps.html" class="code" title="function edgeBoxesSweeps()">edgeBoxesSweeps</a>	Parameter sweeps for Edges Boxes object proposals.</li></ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="#_sub1" class="code">function recall = boxesEvalAll( o )</a></li><li><a href="#_sub2" class="code">function plotResult( recall, o )</a></li></ul>

<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function recall = boxesEval( varargin )</a>
0002 <span class="comment">% Perform object proposal bounding box evaluation and plot results.</span>
0003 <span class="comment">%</span>
0004 <span class="comment">% boxesEval evaluates a set bounding box object proposals on the dataset</span>
0005 <span class="comment">% specified by the 'data' parameter (which is generated by boxesData.m).</span>
0006 <span class="comment">% The methods are specified by the vector 'names'. For each method the</span>
0007 <span class="comment">% boxes must be stored in the file [resDir '/' name '-' data.split]. Each</span>
0008 <span class="comment">% file should contain a single cell array 'bbs' of length n, with one set</span>
0009 <span class="comment">% of bbs per image, where each matrix row has the format [x y w h score].</span>
0010 <span class="comment">% Here score is the confidence of detection but if the boxes are sorted the</span>
0011 <span class="comment">% score may be the same for every box. edgeBoxes.m stores results in this</span>
0012 <span class="comment">% format by default, other methods can easily be converted to this format.</span>
0013 <span class="comment">%</span>
0014 <span class="comment">% For every method, evaluation is performed at every threshold in 'thrs'</span>
0015 <span class="comment">% and every proposal count in 'cnts'. Two plots may be generated. If</span>
0016 <span class="comment">% |cnts|&gt;1 creates a plot with count on x-axis (and plots a separate set of</span>
0017 <span class="comment">% curves for each threshold if necessary). If |thrs|&gt;1 creates a plot with</span>
0018 <span class="comment">% thresholds on x-axis (and plots a separate set of curves for each count).</span>
0019 <span class="comment">%</span>
0020 <span class="comment">% USAGE</span>
0021 <span class="comment">%  recall = boxesEval( opts )</span>
0022 <span class="comment">%</span>
0023 <span class="comment">% INPUTS</span>
0024 <span class="comment">%  opts       - parameters (struct or name/value pairs)</span>
0025 <span class="comment">%   .data       - ['REQ'] data on which to evaluate (see boxesData.m)</span>
0026 <span class="comment">%   .names      - ['REQ'] string cell array of object proposal methods</span>
0027 <span class="comment">%   .resDir     - ['boxes/'] location for results and evaluation</span>
0028 <span class="comment">%   .thrs       - [.7] IoU threshold(s) to use for evaluation</span>
0029 <span class="comment">%   .cnts       - [...] propsal count(s) to use for evaluation</span>
0030 <span class="comment">%   .maxn       - [inf] maximum number of images to use for evaluation</span>
0031 <span class="comment">%   .show       - [1] figure for plotting results</span>
0032 <span class="comment">%   .fName      - [''] optional filename for saving plots/recall to disk</span>
0033 <span class="comment">%   .col        - [...] color(s) for plotting each method's results</span>
0034 <span class="comment">%</span>
0035 <span class="comment">% OUTPUTS</span>
0036 <span class="comment">%  recall     - [MxTxK] recall for each count/threshold/method</span>
0037 <span class="comment">%</span>
0038 <span class="comment">% EXAMPLE</span>
0039 <span class="comment">%</span>
0040 <span class="comment">% See also edgeBoxesDemo, edgeBoxes, boxesData, bbGt</span>
0041 <span class="comment">%</span>
0042 <span class="comment">% Structured Edge Detection Toolbox      Version 3.01</span>
0043 <span class="comment">% Code written by Piotr Dollar and Larry Zitnick, 2014.</span>
0044 <span class="comment">% Licensed under the MSR-LA Full Rights License [see license.txt]</span>
0045 
0046 cnts=[1 2 5 10 20 50 100 200 500 1000 2000 5000]; col=cell(100,1);
0047 <span class="keyword">for</span> i=1:100, col{i}=max(.3,mod([.3 .47 .16]*(i+1),1)); <span class="keyword">end</span>
0048 dfs={ <span class="string">'data'</span>,<span class="string">'REQ'</span>, <span class="string">'names'</span>,<span class="string">'REQ'</span>, <span class="string">'resDir'</span>,<span class="string">'boxes/'</span>, <span class="string">'thrs'</span>,.7, <span class="keyword">...</span>
0049   <span class="string">'cnts'</span>,cnts, <span class="string">'maxn'</span>,inf, <span class="string">'show'</span>,1, <span class="string">'fName'</span>,<span class="string">''</span>, <span class="string">'col'</span>,col };
0050 o=getPrmDflt(varargin,dfs,1); <span class="keyword">if</span>(~iscell(o.names)), o.names={o.names}; <span class="keyword">end</span>
0051 recall=<a href="#_sub1" class="code" title="subfunction recall = boxesEvalAll( o )">boxesEvalAll</a>(o); <span class="keyword">if</span>(o.show), <a href="#_sub2" class="code" title="subfunction plotResult( recall, o )">plotResult</a>(recall,o); <span class="keyword">end</span>
0052 
0053 <span class="keyword">end</span>
0054 
0055 <a name="_sub1" href="#_subfunctions" class="code">function recall = boxesEvalAll( o )</a>
0056 <span class="comment">% compute and gather all results (caches individual results to disk)</span>
0057 M=length(o.cnts); T=length(o.thrs); K=length(o.names);
0058 gt=o.data.gt; n=min(o.maxn,o.data.n); gt=gt(1:n);
0059 recall=zeros(M,T,K); [ms,ts,ks]=ndgrid(1:M,1:T,1:K);
0060 parfor i=1:M*T*K, m=ms(i); t=ts(i); k=ks(i);
0061   <span class="comment">% if evaluation result exists simply load it</span>
0062   rdir=[o.resDir <span class="string">'/eval/'</span> o.names{k} <span class="string">'/'</span> o.data.split <span class="string">'/'</span>];
0063   rnm=[rdir <span class="string">'N'</span> int2str2(n,5) <span class="string">'-W'</span> int2str2(o.cnts(m),5) <span class="keyword">...</span>
0064     <span class="string">'-T'</span> int2str2(round(o.thrs(t)*100),2) <span class="string">'.txt'</span>]; <span class="comment">%#ok&lt;*PFBNS&gt;</span>
0065   <span class="keyword">if</span>(exist(rnm,<span class="string">'file'</span>)), recall(i)=load(rnm,<span class="string">'-ascii'</span>); <span class="keyword">continue</span>; <span class="keyword">end</span>
0066   <span class="comment">% perform evaluation if result does not exist</span>
0067   bbs=load([o.resDir <span class="string">'/'</span> o.names{k} <span class="string">'-'</span> o.data.split]); bbs=bbs.bbs;
0068   bbs1=bbs(1:n); <span class="keyword">for</span> j=1:n, bbs1{j}=bbs1{j}(1:min(<span class="keyword">end</span>,o.cnts(m)),:); <span class="keyword">end</span>
0069   [gt1,bbs1]=bbGt(<span class="string">'evalRes'</span>,gt,bbs1,o.thrs(t));
0070   [~,r]=bbGt(<span class="string">'compRoc'</span>,gt1,bbs1,1); r=max(r); recall(i)=r;
0071   <span class="keyword">if</span>(~exist(rdir,<span class="string">'dir'</span>)), mkdir(rdir); <span class="keyword">end</span>; dlmwrite(rnm,r);
0072 <span class="keyword">end</span>
0073 <span class="comment">% display summary statistics</span>
0074 [ts,ks]=ndgrid(1:T,1:K); ms=log(o.cnts); rt=.75;
0075 <span class="keyword">for</span> i=1:T*K, t=ts(i); k=ks(i); r=recall(:,t,k)'; <span class="keyword">if</span>(M==1), <span class="keyword">continue</span>; <span class="keyword">end</span>
0076   a=find(rt&lt;=r); <span class="keyword">if</span>(isempty(a)), m=inf; <span class="keyword">else</span> a=a(1); b=a-1;
0077     m=round(exp((rt-r(b))/(r(a)-r(b))*(ms(a)-ms(b))+ms(b))); <span class="keyword">end</span>
0078   auc=sum(diff(ms/ms(end)).*(r(1:end-1)+r(2:end))/2);
0079   fprintf(<span class="string">'%15s  T=%.2f  A=%.2f  M=%4i  R=%.2f\n'</span>,<span class="keyword">...</span>
0080     o.names{k},o.thrs(t),auc,m,max(r));
0081 <span class="keyword">end</span>
0082 <span class="comment">% optionally save results to text file</span>
0083 <span class="keyword">if</span>(isempty(o.fName)), <span class="keyword">return</span>; <span class="keyword">end</span>
0084 d=[o.resDir <span class="string">'/plots/'</span>]; <span class="keyword">if</span>(~exist(d,<span class="string">'dir'</span>)), mkdir(d); <span class="keyword">end</span>
0085 dlmwrite([d o.fName <span class="string">'-'</span> o.data.split <span class="string">'.txt'</span>],squeeze(recall));
0086 <span class="keyword">end</span>
0087 
0088 <a name="_sub2" href="#_subfunctions" class="code">function plotResult( recall, o )</a>
0089 <span class="comment">% plot results</span>
0090 [M,T,K]=size(recall); fSiz={<span class="string">'FontSize'</span>,12}; f=o.show;
0091 <span class="keyword">for</span> type=1:2
0092   <span class="keyword">if</span>(type==1), xs=o.cnts; <span class="keyword">else</span> xs=o.thrs; <span class="keyword">end</span>;
0093   <span class="keyword">if</span>(length(xs)==1), <span class="keyword">continue</span>; <span class="keyword">end</span>; s=[T,M]; M=s(type);
0094   R=recall; <span class="keyword">if</span>(type==2), R=permute(R,[2 1 3]); <span class="keyword">end</span>
0095   figure(f); f=f+1; clf; hold on; hs=zeros(M,K);
0096   <span class="keyword">for</span> i=1:M, <span class="keyword">for</span> k=1:K, hs(i,k)=plot(xs,R(:,i,k),<span class="keyword">...</span>
0097         <span class="string">'Color'</span>,o.col{k},<span class="string">'LineWidth'</span>,3); <span class="keyword">end</span>; <span class="keyword">end</span>
0098   s={<span class="string">'# of proposals'</span>,<span class="string">'IoU'</span>}; xlabel(s{type},fSiz{:});
0099   s={<span class="string">'log'</span>,<span class="string">'linear'</span>}; set(gca,<span class="string">'XScale'</span>,s{type});
0100   ylabel(<span class="string">'Detection Rate'</span>,fSiz{:}); set(gca,<span class="string">'YTick'</span>,0:.2:1);
0101   hold off; axis([min(xs) max(xs) 0 1]); grid on; set(gca,fSiz{:});
0102   set(gca,<span class="string">'XMinorGrid'</span>,<span class="string">'off'</span>,<span class="string">'XMinorTic'</span>,<span class="string">'off'</span>);
0103   set(gca,<span class="string">'YMinorGrid'</span>,<span class="string">'off'</span>,<span class="string">'YMinorTic'</span>,<span class="string">'off'</span>);
0104   s={<span class="string">'nw'</span>,<span class="string">'ne'</span>}; legend(hs(1,:),o.names,<span class="string">'Location'</span>,s{type});
0105   <span class="keyword">if</span>(isempty(o.fName)), <span class="keyword">continue</span>; <span class="keyword">end</span>; s={<span class="string">'Cnt'</span>,<span class="string">'IoU'</span>};
0106   savefig([o.resDir <span class="string">'/plots/'</span> s{type} <span class="string">'-'</span> o.data.split <span class="string">'-'</span> o.fName],<span class="string">'png'</span>);
0107 <span class="keyword">end</span>
0108 <span class="keyword">end</span></pre></div>
<hr><address>Generated on Thu 05-May-2022 15:20:21 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>